<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="preconnect" href="https://www.googletagmanager.com">
    <link rel="dns-prefetch" href="https://www.googletagmanager.com">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salary Converter 2026 — Compare Salaries by Neighborhood, for Singles & Families</title>

    <!-- SEO Meta Tags -->
    <meta name="description" content="The only salary tool that compares 2,000+ neighborhoods, not just cities. Single or family mode with dual incomes, childcare & scaled expenses. Taxes, rent, groceries — all factored in. Free.">
    <meta name="keywords" content="salary converter, salary comparison, cost of living, salary calculator, relocation, city comparison, neighborhood cost, currency converter, expat salary">
    <meta name="author" content="salary:converter">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://salary-converter.com/">

    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="manifest" href="/manifest.json">
    <link rel="icon" type="image/x-icon" href="/favicon.svg">

    <!-- Open Graph (Facebook, LinkedIn, WhatsApp) -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://salary-converter.com/">
    <meta property="og:title" content="Salary Converter 2026 — Compare Salaries by Neighborhood, for Singles & Families">
    <meta property="og:description" content="The only salary tool that compares 2,000+ neighborhoods, not just cities. Single or family mode with dual incomes, childcare & scaled expenses. Free.">
    <meta property="og:image" content="https://salary-converter.com/og-image.svg">
    <meta property="og:image:alt" content="Salary Converter - Compare cost of living and salaries between cities">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="salary:converter">
    <meta property="og:locale" content="en_US">

    <!-- Twitter/X Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Salary Converter 2026 — Compare Salaries by Neighborhood, for Singles & Families">
    <meta name="twitter:description" content="The only salary tool that compares 2,000+ neighborhoods, not just cities. Single or family mode with dual incomes, childcare & scaled expenses. Free.">
    <meta name="twitter:image" content="https://salary-converter.com/og-image.svg">

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Salary Converter",
        "alternateName": "salary:converter",
        "url": "https://salary-converter.com",
        "description": "Compare salaries across 100+ cities and 2,000+ neighborhoods worldwide with cost of living adjustments, tax estimation, and real-time currency conversion.",
        "applicationCategory": "FinanceApplication",
        "operatingSystem": "Any",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD"
        },
        "creator": {
            "@type": "Organization",
            "name": "salary:converter",
            "url": "https://salary-converter.com"
        },
        "featureList": [
            "Compare salaries across 100 global cities",
            "2,000+ neighborhood-level cost adjustments",
            "Real-time currency conversion for 40+ currencies",
            "Cost of living index comparison",
            "Free embeddable widget"
        ],
        "screenshot": "https://salary-converter.com/og-image.svg"
    }
    </script>
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "HowTo",
        "name": "How to Calculate Your True Equivalent Salary",
        "description": "Use the Salary Converter to find out what you'd need to earn in another city to maintain your current lifestyle.",
        "step": [
            {"@type": "HowToStep", "position": 1, "text": "Enter your current city, neighborhood, and salary"},
            {"@type": "HowToStep", "position": 2, "text": "Select a target city and neighborhood you'd like to move to"},
            {"@type": "HowToStep", "position": 3, "text": "Optionally enter a job offer salary to compare against the true equivalent"},
            {"@type": "HowToStep", "position": 4, "text": "View your true equivalent salary with a full breakdown of taxes, rent, and living expenses"}
        ]
    }
    </script>

    <!-- Google Consent Mode v2 — deny by default for GDPR/CCPA/equivalent regions -->
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}

        // Deny consent by default for regions with privacy laws (GDPR, CCPA, LGPD, POPIA, PDPA, etc.)
        gtag('consent', 'default', {
            'ad_storage': 'denied',
            'ad_user_data': 'denied',
            'ad_personalization': 'denied',
            'analytics_storage': 'denied',
            'regions': ['AT','BE','BG','HR','CY','CZ','DK','EE','FI','FR','DE','GR','HU','IE','IT','LV','LT','LU','MT','NL','PL','PT','RO','SK','SI','ES','SE','IS','LI','NO','GB','CH','US-CA','US-VA','US-CO','US-CT','US-UT','US-TX','US-OR','US-MT','US-IA','US-IN','US-TN','US-DE','US-NH','US-NJ','US-NE','US-MN','US-MD','US-KY','US-RI','BR','KR','JP','ZA','CA','AU','NZ','AR','IL','TR','TH','SG','IN','PH','KE','NG','AE','QA','BH','EG','CL','CO','PE','UY']
        });

        // Deny consent by default for all other regions
        gtag('consent', 'default', {
            'ad_storage': 'denied',
            'ad_user_data': 'denied',
            'ad_personalization': 'denied',
            'analytics_storage': 'denied'
        });
    </script>
    <!-- End Consent Mode — add your cookie banner script below -->

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-MMZSM2Z96B"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-MMZSM2Z96B');
    </script>
    <style>
        :root {
            --bg: #f5f5f7;
            --card-bg: #ffffff;
            --text-primary: #1d1d1f;
            --text-secondary: #86868b;
            --text-body: #4a4a4c;
            --accent: #2563eb;
            --accent-hover: #1d4ed8;
            --accent-light: #2563eb;
            --shadow: 0 2px 20px rgba(0,0,0,0.06);
            --border: #e5e5ea;
            --border-light: #f0f0f2;
            --border-mid: #d2d2d7;
            --border-section: #e8e8ed;
            --table-stripe: #f9f9fb;
            --tag-bg: #f0f0f2;
            --stat-card-bg: #f5f5f7;
            --input-bg: #ffffff;
            --input-border: #d2d2d7;
            --input-placeholder: #c7c7cc;
            --dropdown-bg: #ffffff;
            --dropdown-hover: #f5f5f7;
            --nav-burger-bg: #f5f5f7;
            --nav-burger-hover: #e8e8ed;
            --result-breakdown-bg: rgba(0, 0, 0, 0.04);
            --comparison-note-bg: rgba(0, 0, 0, 0.03);
            --comparison-note-text: #1d1d1f;
            --explanation-step-color: #48484a;
            --footer-border: rgba(0, 0, 0, 0.06);
            --meta-color: #aeaeb2;
            --section-subtitle-color: #999;
            --error-bg: #fef2f2;
            --error-color: #dc2626;
            --error-border: #fecaca;
            --blog-card-bg: #f5f5f7;
            --blog-card-hover: #ededf0;
            --blog-cta-bg: rgba(37, 99, 235, 0.08);
            --blog-cta-hover: rgba(37, 99, 235, 0.15);
            --sidebar-mobile-bg: #f5f5f7;
            --info-text-color: #86868b;
            --modifier-high-color: #dc2626;
            --modifier-high-bg: rgba(220, 38, 38, 0.08);
            --modifier-low-color: #16a34a;
            --modifier-low-bg: rgba(22, 163, 74, 0.08);
            --modifier-avg-color: #86868b;
            --modifier-avg-bg: rgba(134, 134, 139, 0.08);
            --optional-tag-color: #2563eb;
            --optional-tag-bg: rgba(37, 99, 235, 0.08);
            --focus-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
            --range-bar-bg: #e5e5ea;
            --quick-btn-hover-bg: #f0f4ff;
        }
        [data-theme="dark"] {
            --bg: #000000;
            --card-bg: #1c1c1e;
            --text-primary: #f5f5f7;
            --text-secondary: #98989f;
            --text-body: #b0b0b5;
            --accent: #3b82f6;
            --accent-hover: #2563eb;
            --accent-light: #5b9aff;
            --shadow: 0 2px 20px rgba(0,0,0,0.3);
            --border: #38383a;
            --border-light: #2c2c2e;
            --border-mid: #38383a;
            --border-section: #38383a;
            --table-stripe: #2c2c2e;
            --tag-bg: #2c2c2e;
            --stat-card-bg: #2c2c2e;
            --input-bg: #2c2c2e;
            --input-border: #38383a;
            --input-placeholder: #636366;
            --dropdown-bg: #2c2c2e;
            --dropdown-hover: #3a3a3c;
            --nav-burger-bg: #2c2c2e;
            --nav-burger-hover: #3a3a3c;
            --result-breakdown-bg: rgba(255, 255, 255, 0.06);
            --comparison-note-bg: rgba(255, 255, 255, 0.04);
            --comparison-note-text: #e5e5e7;
            --explanation-step-color: #a1a1a6;
            --footer-border: #38383a;
            --meta-color: #636366;
            --section-subtitle-color: #636366;
            --error-bg: #3a1c1c;
            --error-color: #f87171;
            --error-border: #5c2020;
            --blog-card-bg: #2c2c2e;
            --blog-card-hover: #3a3a3c;
            --blog-cta-bg: rgba(91, 154, 255, 0.1);
            --blog-cta-hover: rgba(91, 154, 255, 0.18);
            --sidebar-mobile-bg: #000000;
            --info-text-color: #636366;
            --modifier-high-color: #f87171;
            --modifier-high-bg: rgba(248, 113, 113, 0.12);
            --modifier-low-color: #4ade80;
            --modifier-low-bg: rgba(74, 222, 128, 0.12);
            --modifier-avg-color: #636366;
            --modifier-avg-bg: rgba(99, 99, 102, 0.12);
            --optional-tag-color: #3b82f6;
            --optional-tag-bg: rgba(59, 130, 246, 0.12);
            --focus-shadow: 0 0 0 4px rgba(59, 130, 246, 0.15);
            --range-bar-bg: #38383a;
            --quick-btn-hover-bg: #3a3a3c;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg);
            min-height: 100vh;
            padding: 20px 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            transition: background 0.3s, color 0.3s;
        }

        .page-layout {
            display: flex;
            gap: 16px;
            max-width: 1200px;
            width: 100%;
            align-items: flex-start;
        }

        .container {
            background: var(--card-bg);
            border-radius: 24px;
            box-shadow: var(--shadow);
            max-width: 860px;
            width: 100%;
            padding: 32px 28px;
            align-self: flex-start;
            flex: 1;
            min-width: 0;
        }

        /* Sidebar */
        .sidebar {
            width: 300px;
            flex-shrink: 0;
            position: sticky;
            top: 40px;
            max-height: calc(100vh - 80px);
            overflow-y: auto;
            scrollbar-width: none;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .sidebar::-webkit-scrollbar {
            width: 0;
        }

        .sidebar-card {
            background: var(--card-bg);
            border-radius: 20px;
            box-shadow: var(--shadow);
            padding: 24px;
        }

        .sidebar-card h3 {
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: var(--text-primary);
            margin-bottom: 16px;
        }

        .sidebar-salary-link {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 9px 12px;
            background: var(--stat-card-bg, #f5f5f7);
            border-radius: 10px;
            text-decoration: none;
            color: var(--text-primary);
            font-size: 0.84rem;
            font-weight: 500;
            transition: background 0.2s, transform 0.15s;
        }
        .sidebar-salary-link:hover {
            background: var(--accent);
            color: #fff;
            transform: translateX(3px);
        }
        .sidebar-salary-link span {
            font-size: 0.78rem;
            font-weight: 500;
            color: var(--text-secondary);
            opacity: 0;
            transition: opacity 0.2s;
        }
        .sidebar-salary-link:hover span {
            opacity: 1;
            color: #fff;
        }

        .sidebar-explore-link {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 12px;
            background: var(--stat-card-bg, #f5f5f7);
            border-radius: 10px;
            text-decoration: none;
            color: var(--text-primary);
            font-size: 0.85rem;
            font-weight: 500;
            transition: background 0.2s;
        }
        .sidebar-explore-link:hover {
            background: var(--accent);
            color: #fff;
        }
        .sidebar-nhood-pill {
            display: inline-block;
            padding: 4px 10px;
            background: var(--stat-card-bg, #f5f5f7);
            border-radius: 100px;
            text-decoration: none;
            color: var(--text-primary);
            font-size: 0.75rem;
            font-weight: 500;
            transition: background 0.2s, color 0.2s;
            border: 1px solid var(--border-light, #f0f0f2);
        }
        .sidebar-nhood-pill:hover {
            background: var(--accent);
            color: #fff;
            border-color: var(--accent);
        }

        /* Cost of Living Rankings */
        /* Currency Ticker */

        .header {
            text-align: center;
            margin-bottom: 32px;
        }

        .header h1 {
            color: var(--text-primary);
            font-size: 2.8rem;
            font-weight: 700;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.15rem;
            font-weight: 400;
        }

        .blog-link {
            display: none;
            position: absolute;
            top: 0;
            left: -10px;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--accent-light);
            text-decoration: none;
            transition: opacity 0.2s;
        }

        .blog-link:hover {
            opacity: 0.7;
        }

        .widget-link {
            display: none;
            position: absolute;
            top: 18px;
            left: -10px;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--accent-light);
            text-decoration: none;
            transition: opacity 0.2s;
        }

        .widget-link:hover {
            opacity: 0.7;
        }

        /* Nav burger menu — visible on all screen sizes */
        .nav-burger {
            display: flex;
            position: absolute;
            top: 0;
            left: -10px;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border: none;
            border-radius: 10px;
            background: var(--nav-burger-bg);
            color: var(--text-primary);
            cursor: pointer;
            font-size: 1.1rem;
            z-index: 100;
            transition: background 0.2s;
        }

        .nav-burger:hover {
            background: var(--nav-burger-hover);
        }

        .nav-dropdown {
            display: none;
            position: absolute;
            top: 42px;
            left: -10px;
            background: var(--dropdown-bg);
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.12);
            padding: 6px;
            z-index: 100;
            min-width: 160px;
            animation: dropIn 0.2s ease-out;
        }

        .nav-dropdown.open {
            display: block;
        }

        @keyframes dropIn {
            from { opacity: 0; transform: translateY(-6px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .nav-dropdown a {
            display: flex;
            align-items: center;
            padding: 10px 14px;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-primary);
            text-decoration: none;
            border-radius: 8px;
            transition: background 0.15s;
        }

        .nav-dropdown a:hover {
            background: var(--dropdown-hover);
        }

        .nav-dropdown a span {
            display: inline-flex;
            width: 20px;
            margin-right: 8px;
            justify-content: center;
            flex-shrink: 0;
        }

        .blog-article-card {
            display: block;
            text-decoration: none;
            padding: 16px;
            border-radius: 14px;
            background: var(--blog-card-bg);
            transition: all 0.2s;
        }

        .blog-article-card:hover {
            background: var(--blog-card-hover);
            transform: translateY(-2px);
        }

        .blog-article-tag {
            font-size: 0.6rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--accent-light);
            margin-bottom: 6px;
        }

        .blog-article-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-primary);
            line-height: 1.35;
            margin-bottom: 6px;
        }

        .blog-article-excerpt {
            font-size: 0.75rem;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 10px;
        }

        .blog-article-meta {
            font-size: 0.65rem;
            color: var(--meta-color);
        }

        .blog-card-cta {
            display: block;
            text-align: center;
            margin-top: 14px;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--accent-light);
            text-decoration: none;
            padding: 9px 16px;
            border-radius: 10px;
            background: var(--blog-cta-bg);
            transition: all 0.2s;
        }

        .blog-card-cta:hover {
            background: var(--blog-cta-hover);
        }

        /* SEO Internal Linking Sections */
        /* Compact footer link grid (SEO internal links) */
        .footer-links-grid {
            max-width: 1200px; width: 100%; margin: 0 auto;
            padding: 24px 24px 0;
            display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 24px;
        }
        .footer-links-col h4 {
            font-size: 0.72rem; font-weight: 700; text-transform: uppercase;
            letter-spacing: 0.5px; color: var(--text-secondary);
            margin-bottom: 8px;
        }
        .footer-links-col a {
            display: block; font-size: 0.75rem; color: var(--text-secondary);
            text-decoration: none; padding: 2px 0; line-height: 1.6;
            transition: color 0.15s;
        }
        .footer-links-col a:hover { color: var(--accent); }
        @media (max-width: 600px) {
            .footer-links-grid { grid-template-columns: repeat(2, 1fr); gap: 16px; }
        }

        /* Footer */
        .site-footer {
            max-width: 1200px;
            width: 100%;
            margin: 40px auto 0;
            padding: 32px 24px;
            border-top: 1px solid var(--footer-border);
            text-align: center;
        }

        .site-footer-logo {
            font-size: 1.1rem;
            font-weight: 700;
            letter-spacing: -0.5px;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .site-footer-logo span {
            color: var(--accent);
        }

        .site-footer-text {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 14px;
        }

        .site-footer-links {
            display: flex;
            justify-content: center;
            gap: 24px;
        }

        .site-footer-links a {
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--text-secondary);
            text-decoration: none;
            transition: color 0.2s;
        }

        .site-footer-links a:hover {
            color: var(--text-primary);
        }

        .form-section {
            margin-bottom: 12px;
            padding-bottom: 32px;
        }

        .form-section + .form-section {
            border-top: 1px solid var(--border-section);
            padding-top: 32px;
        }

        .form-section h2 {
            color: var(--text-primary);
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 22px;
            display: flex;
            align-items: baseline;
            gap: 8px;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            flex-wrap: wrap;
        }

        .section-subtitle {
            text-transform: none;
            font-weight: 400;
            font-size: 0.8rem;
            color: var(--section-subtitle-color);
            letter-spacing: 0;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: var(--text-secondary);
            font-weight: 500;
            margin-bottom: 8px;
            font-size: 0.875rem;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid var(--input-border);
            border-radius: 12px;
            font-size: 1rem;
            color: var(--text-primary);
            background: var(--input-bg);
            transition: border-color 0.2s, box-shadow 0.2s;
            font-family: inherit;
            appearance: none;
            -webkit-appearance: none;
        }

        .form-group select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath fill='%2386868b' d='M1.41 0L6 4.58 10.59 0 12 1.41l-6 6-6-6z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 16px center;
            padding-right: 40px;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: var(--focus-shadow);
        }

        .form-group input::placeholder {
            color: var(--input-placeholder);
        }

        .quick-select {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 14px;
            margin-bottom: 22px;
        }

        .quick-btn {
            padding: 7px 18px;
            border: 1px solid var(--input-border);
            background: var(--input-bg);
            border-radius: 100px;
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 500;
            color: var(--text-primary);
            transition: all 0.2s;
            text-align: center;
            white-space: nowrap;
        }

        .quick-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
            background: var(--quick-btn-hover-bg);
        }

        .quick-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 36px;
            padding-top: 32px;
            border-top: 1px solid var(--border-section);
        }

        .btn {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 14px;
            font-size: 1.05rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }

        .btn-calculate {
            background: var(--accent);
            color: white;
        }

        .btn-calculate:hover {
            background: var(--accent-hover);
        }

        .btn-reset {
            background: transparent;
            color: var(--accent);
            border: 1px solid var(--input-border);
        }

        .btn-reset:hover {
            background: var(--stat-card-bg);
        }

        .btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        .result-box {
            background: var(--stat-card-bg);
            color: var(--text-primary);
            padding: 36px;
            border-radius: 20px;
            margin-top: 32px;
            display: none;
            border: 1px solid var(--border-section);
            overflow-x: hidden;
        }

        .result-box.show {
            display: block;
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(8px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .result-title {
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.8px;
        }

        .result-amount {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 8px;
            word-break: break-word;
            letter-spacing: -0.5px;
            color: var(--text-primary);
        }

        .coli-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            border-radius: 100px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 20px;
        }
        .coli-badge.badge-cheaper {
            background: rgba(34, 197, 94, 0.1);
            color: #16a34a;
        }
        .coli-badge.badge-pricier {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
        }
        .coli-badge.badge-similar {
            background: var(--result-breakdown-bg);
            color: var(--text-secondary);
        }
        [data-theme="dark"] .coli-badge.badge-cheaper {
            background: rgba(34, 197, 94, 0.15);
            color: #4ade80;
        }
        [data-theme="dark"] .coli-badge.badge-pricier {
            background: rgba(239, 68, 68, 0.15);
            color: #f87171;
        }

        .result-breakdown {
            background: var(--result-breakdown-bg);
            padding: 20px 24px;
            border-radius: 14px;
            margin-top: 24px;
        }

        .breakdown-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 14px;
            font-size: 0.95rem;
        }

        .breakdown-item:last-child {
            margin-bottom: 0;
        }

        .breakdown-label {
            font-weight: 400;
            color: var(--text-secondary);
        }

        .breakdown-value {
            font-weight: 600;
            font-variant-numeric: tabular-nums;
            color: var(--text-primary);
        }

        .error-message {
            color: var(--error-color);
            background: var(--error-bg);
            border: 1px solid var(--error-border);
            padding: 14px 18px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: none;
            font-size: 0.95rem;
            font-weight: 500;
        }

        .error-message.show {
            display: block;
        }

        .info-text {
            font-size: 0.85rem;
            color: var(--info-text-color);
            margin-top: 6px;
        }

        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        @media (max-width: 768px) {
            body {
                padding: 0;
                background: var(--card-bg);
            }

            .page-layout {
                flex-direction: column;
                gap: 0;
            }

            .sidebar {
                width: 100%;
                position: static;
                max-height: none;
                overflow-y: visible;
                padding: 0 16px 16px;
            }

            .sidebar-card {
                border-radius: 16px;
            }

            .container {
                padding: 56px 16px 20px;
                border-radius: 0;
                box-shadow: none;
            }

            .header h1 {
                font-size: 2.2rem;
            }

            .header p {
                font-size: 1rem;
            }

            .nav-burger {
                position: fixed;
                top: 16px;
                left: 16px;
                z-index: 10000;
            }

            .nav-dropdown {
                position: fixed;
                top: 58px;
                left: 16px;
                z-index: 10000;
            }

            .section-subtitle {
                display: block;
                width: 100%;
                font-size: 0.75rem;
                margin-top: -2px;
            }

            .two-column {
                grid-template-columns: 1fr;
            }

            .button-group {
                flex-direction: column;
            }

            .quick-select {
                gap: 6px;
            }

            .quick-btn {
                padding: 6px 14px;
                font-size: 0.8rem;
            }

            .result-amount {
                font-size: 2.4rem;
            }

            .result-box {
                padding: 28px 24px;
            }

            .ranges-list {
                grid-template-columns: 1fr;
            }

            .chart-bar-label {
                width: 80px;
                font-size: 0.72rem;
            }

            .chart-bar-fill {
                font-size: 0.68rem;
                padding-right: 6px;
            }

        }

        .comparison-note {
            background: var(--comparison-note-bg);
            border-left: 3px solid var(--accent);
            padding: 16px 20px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 0.95rem;
            color: var(--comparison-note-text);
            line-height: 1.6;
        }

        .offer-comparison {
            margin-top: 12px;
            padding: 12px 16px;
            background: var(--stat-card-bg);
            border-radius: 10px;
            font-size: 0.88rem;
            line-height: 1.5;
            color: var(--text-body);
        }
        .offer-comparison .offer-above { color: #22c55e; font-weight: 600; }
        .offer-comparison .offer-below { color: #ef4444; font-weight: 600; }
        .offer-comparison .offer-match { color: #f59e0b; font-weight: 600; }

        .explanation-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid var(--footer-border);
        }

        .explanation-title {
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: var(--text-secondary);
            margin-bottom: 14px;
        }

        .explanation-step {
            display: flex;
            gap: 12px;
            margin-bottom: 14px;
            font-size: 0.9rem;
            line-height: 1.5;
            color: var(--explanation-step-color);
        }

        .explanation-step:last-child {
            margin-bottom: 0;
        }

        .step-number {
            flex-shrink: 0;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--accent);
            color: white;
            font-size: 0.75rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .step-text strong {
            color: var(--text-primary);
        }

        /* === TAX ESTIMATION SECTION === */
        .rent-section {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid var(--border);
        }

        .rent-title {
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        .rent-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .rent-card {
            background: var(--stat-card-bg);
            border-radius: 14px;
            padding: 20px 16px;
            text-align: center;
        }

        .rent-card-city {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .rent-card-amount {
            font-size: 1.4rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 4px;
        }

        .rent-card-usd {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 2px;
        }

        .rent-card-label {
            font-size: 0.72rem;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .rent-note {
            font-size: 0.7rem;
            color: var(--text-secondary);
            margin-top: 8px;
            line-height: 1.4;
        }

        .affordability-section {
            margin-top: 28px;
            padding-top: 24px;
            border-top: 1px solid var(--border);
        }

        .afford-title {
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        .afford-verdict {
            border-radius: 14px;
            padding: 16px 20px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 0.95rem;
            font-weight: 600;
            line-height: 1.4;
        }

        .afford-verdict.better {
            background: rgba(34, 197, 94, 0.1);
            color: #16a34a;
            border: 1px solid rgba(34, 197, 94, 0.2);
        }

        .afford-verdict.similar {
            background: rgba(245, 158, 11, 0.1);
            color: #d97706;
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .afford-verdict.worse {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        [data-theme="dark"] .afford-verdict.better {
            background: rgba(34, 197, 94, 0.12);
            color: #4ade80;
            border-color: rgba(34, 197, 94, 0.25);
        }

        [data-theme="dark"] .afford-verdict.similar {
            background: rgba(245, 158, 11, 0.12);
            color: #fbbf24;
            border-color: rgba(245, 158, 11, 0.25);
        }

        [data-theme="dark"] .afford-verdict.worse {
            background: rgba(239, 68, 68, 0.12);
            color: #f87171;
            border-color: rgba(239, 68, 68, 0.25);
        }

        .afford-verdict-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .afford-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .afford-card {
            background: var(--stat-card-bg);
            border-radius: 14px;
            padding: 16px;
        }

        .afford-card-city {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
        }

        .afford-card-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 0;
            font-size: 0.82rem;
            color: var(--text-body);
        }

        .afford-card-row.total {
            border-top: 1px solid var(--border);
            margin-top: 6px;
            padding-top: 10px;
        }

        .afford-card-row.total .afford-card-val {
            font-size: 1.15rem;
            font-weight: 700;
        }

        .afford-card-row.total .afford-card-val.positive {
            color: #22c55e;
        }

        .afford-card-row.total .afford-card-val.negative {
            color: #ef4444;
        }

        .afford-card-val {
            font-weight: 600;
            color: var(--text-primary);
        }

        /* Household Section */
        .household-section { text-align: center; padding-bottom: 12px; margin-bottom: 0; }
        .household-section + .form-section { padding-top: 16px; }
        .household-mode-toggle {
            display: inline-flex;
            gap: 0;
            background: var(--stat-card-bg);
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 16px;
        }
        .mode-btn {
            padding: 10px 32px;
            border: none;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            background: transparent;
            color: var(--text-secondary);
            transition: all 0.2s;
            font-family: inherit;
        }
        .mode-btn.active {
            background: var(--card-bg);
            color: var(--text-primary);
            box-shadow: 0 1px 4px rgba(0,0,0,0.08);
        }
        .mode-btn:hover:not(.active) { color: var(--text-primary); }
        .family-options {
            display: flex;
            gap: 32px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 8px;
        }
        .chip-group label {
            display: block;
            font-size: 0.82rem;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }
        .chips { display: flex; gap: 6px; justify-content: center; }
        .chip {
            padding: 8px 18px;
            border: 1px solid var(--input-border);
            border-radius: 10px;
            background: var(--input-bg);
            color: var(--text-body);
            font-size: 0.88rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
        }
        .chip.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }
        .chip:hover:not(.active) {
            border-color: var(--accent);
            color: var(--accent);
        }

        /* Remote worker toggle */
        .remote-toggle { margin-top: 14px; }
        .remote-label {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            color: var(--text-primary);
        }
        .remote-label input { display: none; }
        .remote-check {
            width: 20px; height: 20px;
            border: 2px solid var(--input-border);
            border-radius: 6px;
            background: var(--input-bg);
            position: relative;
            flex-shrink: 0;
            transition: all 0.15s;
        }
        .remote-label input:checked + .remote-check {
            background: var(--accent);
            border-color: var(--accent);
        }
        .remote-label input:checked + .remote-check::after {
            content: '\2713';
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            color: #fff;
            font-size: 14px;
            font-weight: 700;
        }

        /* Citation Sources */
        .citation-sources { margin-top: 12px; padding-top: 12px; border-top: 1px solid var(--border); }
        .citation-sources strong { font-size: 0.78rem; color: var(--text-primary); }
        .citation-sources ul { list-style: none; padding: 0; margin: 6px 0 0; }
        .citation-sources li { font-size: 0.75rem; color: var(--text-secondary); padding: 2px 0; line-height: 1.5; }
        .citation-sources li a { color: var(--accent); text-decoration: none; }
        .citation-sources li a:hover { text-decoration: underline; }
        .citation-sources sup, .fbc-section-label sup, .fbc-row sup { color: var(--accent); font-weight: 600; font-size: 0.6rem; margin-left: 2px; }

        /* Contact Modal */
        .contact-overlay {
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5);
            z-index: 9999; align-items: center; justify-content: center;
            backdrop-filter: blur(4px); -webkit-backdrop-filter: blur(4px);
        }
        .contact-overlay.open { display: flex; animation: fadeIn 0.2s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .contact-modal {
            background: var(--card-bg); border-radius: 16px; padding: 32px 28px;
            max-width: 520px; width: 90%; max-height: 90vh; overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3); position: relative;
            animation: modalSlideUp 0.25s ease-out;
        }
        @keyframes modalSlideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .contact-modal-close {
            position: absolute; top: 12px; right: 12px; width: 32px; height: 32px;
            border: none; border-radius: 8px; background: var(--stat-card-bg);
            color: var(--text-secondary); cursor: pointer; font-size: 1.1rem;
            display: flex; align-items: center; justify-content: center; transition: background 0.15s;
        }
        .contact-modal-close:hover { background: var(--input-border); }
        .contact-modal h2 { font-size: 1.3rem; font-weight: 700; color: var(--text-primary); margin-bottom: 8px; }
        .contact-subtitle { font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 24px; }
        .contact-form { text-align: left; }
        .contact-form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
        @media (max-width: 768px) { .contact-form-grid { grid-template-columns: 1fr; } }
        .contact-form textarea {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid var(--input-border);
            border-radius: 12px;
            font-size: 1rem;
            background: var(--input-bg);
            color: var(--text-primary);
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.2s;
            box-sizing: border-box;
        }
        .contact-form textarea:focus { outline: none; border-color: var(--accent); box-shadow: var(--focus-shadow); }
        .contact-form .btn { width: 100%; margin-top: 8px; }
        .contact-success { padding: 20px; background: var(--stat-card-bg); border-radius: 12px; color: var(--text-primary); font-weight: 500; font-size: 0.95rem; text-align: center; }

        .afford-card-row.separator {
            border-top: 1px dashed var(--border);
            margin-top: 4px;
            padding-top: 4px;
        }

        .afford-card-row .afford-card-val.deduction {
            color: var(--text-secondary);
        }

        .afford-local {
            font-size: 0.7rem;
            font-weight: 400;
            color: var(--text-secondary);
            white-space: nowrap;
        }

        .afford-note {
            font-size: 0.7rem;
            color: var(--text-secondary);
            margin-top: 10px;
            line-height: 1.4;
        }
        .afford-note a {
            color: var(--accent);
            text-decoration: underline;
            text-decoration-style: dotted;
            text-underline-offset: 2px;
        }
        .afford-note a:hover {
            text-decoration-style: solid;
        }

        /* Result subtitle */
        .result-subtitle {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 8px;
            line-height: 1.5;
            max-width: 480px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Verdict Banner */
        .verdict-banner {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 14px 18px;
            border-radius: 12px;
            margin: 16px 0;
            font-size: 0.92rem;
            font-weight: 500;
            line-height: 1.4;
        }
        .verdict-banner.better {
            background: #dcfce7;
            border: 1px solid #86efac;
            color: #166534;
        }
        .verdict-banner.worse {
            background: #fef2f2;
            border: 1px solid #fca5a5;
            color: #991b1b;
        }
        .verdict-banner.similar {
            background: #fefce8;
            border: 1px solid #fde68a;
            color: #854d0e;
        }
        .verdict-banner.neutral {
            background: #f0f4ff;
            border: 1px solid #bfdbfe;
            color: #1e40af;
        }
        [data-theme="dark"] .verdict-banner.better {
            background: rgba(34, 197, 94, 0.15);
            border-color: rgba(34, 197, 94, 0.3);
            color: #86efac;
        }
        [data-theme="dark"] .verdict-banner.worse {
            background: rgba(239, 68, 68, 0.15);
            border-color: rgba(239, 68, 68, 0.3);
            color: #fca5a5;
        }
        [data-theme="dark"] .verdict-banner.similar {
            background: rgba(234, 179, 8, 0.15);
            border-color: rgba(234, 179, 8, 0.3);
            color: #fde68a;
        }
        [data-theme="dark"] .verdict-banner.neutral {
            background: rgba(59, 130, 246, 0.15);
            border-color: rgba(59, 130, 246, 0.3);
            color: #93c5fd;
        }
        .verdict-icon {
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        /* Full Breakdown Section */
        .full-breakdown-section {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid var(--border);
        }
        .breakdown-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 16px;
            color: var(--text-primary);
        }
        .breakdown-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }
        @media (max-width: 768px) {
            .breakdown-cards {
                grid-template-columns: 1fr;
            }
        }
        .breakdown-note {
            font-size: 0.7rem;
            color: var(--text-secondary);
            margin-top: 12px;
            line-height: 1.4;
        }
        .breakdown-note a {
            color: var(--accent);
            text-decoration: underline;
            text-decoration-style: dotted;
            text-underline-offset: 2px;
        }

        /* Full Breakdown Card */
        .full-breakdown-card {
            background: var(--stat-card-bg, #f9fafb);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px;
            text-align: left;
        }
        .fbc-city {
            font-size: 0.85rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border);
        }
        .fbc-section-label {
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
            margin-top: 12px;
            margin-bottom: 6px;
        }
        .fbc-row {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            padding: 4px 0;
            font-size: 0.82rem;
            color: var(--text-body);
        }
        .fbc-row.gross {
            font-weight: 600;
            font-size: 0.9rem;
            color: var(--text-primary);
        }
        .fbc-row.subtotal {
            font-weight: 600;
            padding-top: 8px;
            margin-top: 4px;
            border-top: 1px solid var(--border);
        }
        .fbc-row.total {
            font-weight: 700;
            font-size: 0.95rem;
            padding-top: 10px;
            margin-top: 6px;
            border-top: 2px solid var(--border);
        }
        .fbc-val {
            text-align: right;
            white-space: nowrap;
        }
        .fbc-val.negative {
            color: #ef4444;
        }
        .fbc-row.total .fbc-val.positive {
            color: #22c55e;
        }
        .fbc-row.total .fbc-val.negative {
            color: #ef4444;
        }

        /* Expense % difference badges */
        .exp-pct {
            display: inline-block;
            padding: 1px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            margin-left: 6px;
            vertical-align: middle;
        }
        .exp-pct.pct-cheaper {
            background: rgba(34, 197, 94, 0.1);
            color: #16a34a;
        }
        .exp-pct.pct-pricier {
            background: rgba(239, 68, 68, 0.1);
            color: #dc2626;
        }
        .exp-pct.pct-similar {
            background: rgba(156, 163, 175, 0.1);
            color: var(--text-secondary);
        }
        [data-theme="dark"] .exp-pct.pct-cheaper {
            background: rgba(34, 197, 94, 0.15);
            color: #4ade80;
        }
        [data-theme="dark"] .exp-pct.pct-pricier {
            background: rgba(239, 68, 68, 0.15);
            color: #f87171;
        }

        /* COLI Reference (demoted) */
        .coli-reference {
            margin-top: 20px;
            padding: 14px;
            background: var(--stat-card-bg, #f9fafb);
            border: 1px dashed var(--border);
            border-radius: 10px;
            text-align: center;
        }
        .coli-ref-label {
            font-size: 0.72rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--text-secondary);
            font-weight: 500;
        }
        .coli-ref-amount {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 6px 0;
        }
        .coli-ref-note {
            font-size: 0.7rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }


        .ded-take-home-equiv {
            font-size: 0.78rem;
            color: var(--text-secondary);
            text-align: right;
            margin-top: 2px;
        }

        .tax-section {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid var(--border);
        }

        .tax-title, .chart-title, .ranges-title {
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            color: var(--text-secondary);
            margin-bottom: 16px;
        }

        .tax-comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .tax-card {
            background: var(--stat-card-bg);
            border-radius: 14px;
            padding: 16px;
            text-align: center;
        }

        .tax-card-city {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .tax-card-gross {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 4px;
        }

        .tax-card-rate {
            font-size: 0.8rem;
            color: #ff9500;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .tax-card-net {
            font-size: 1.3rem;
            font-weight: 700;
            color: #22c55e;
        }

        .tax-card-net-label {
            font-size: 0.72rem;
            color: var(--text-secondary);
            margin-top: 2px;
        }

        .expat-toggle-track {
            width: 42px;
            height: 22px;
            background: var(--border);
            border-radius: 11px;
            cursor: pointer;
            position: relative;
            transition: background 0.2s;
        }
        .ded-bar-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }
        .ded-bar-label {
            width: 180px;
            font-size: 0.8rem;
            font-weight: 500;
            color: var(--text-body);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .ded-bar-track {
            flex: 1;
            background: var(--border-light);
            border-radius: 5px;
            height: 10px;
            overflow: hidden;
        }
        .ded-bar-fill {
            height: 100%;
            border-radius: 5px;
            transition: width 0.3s ease;
        }
        .ded-bar-pct {
            width: 42px;
            text-align: right;
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        .ded-total-row {
            border-top: 1px solid var(--border);
            margin-top: 12px;
            padding-top: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .ded-total-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        .ded-take-home {
            font-size: 1.1rem;
            font-weight: 700;
            color: #22c55e;
        }
        @media (max-width: 768px) {
            .ded-bar-label {
                width: 120px;
                font-size: 0.75rem;
            }
            .afford-cards {
                grid-template-columns: 1fr;
            }
            .afford-verdict {
                font-size: 0.85rem;
                padding: 14px 16px;
            }
            .tax-comparison {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            .rent-comparison {
                grid-template-columns: 1fr;
                gap: 12px;
            }
            .comparison-note {
                font-size: 0.85rem;
                padding: 14px 16px;
            }
            .offer-comparison {
                font-size: 0.8rem;
                padding: 10px 14px;
            }
            .result-breakdown {
                padding: 16px;
            }
            .breakdown-item {
                font-size: 0.85rem;
            }
        }

        .tax-note {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-align: center;
            margin-top: 12px;
            font-style: italic;
        }


        /* === SALARY RANGES SECTION === */
        .salary-ranges-section {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid var(--border);
        }

        .ranges-subtitle {
            font-size: 0.82rem;
            color: var(--text-secondary);
            margin-top: -12px;
            margin-bottom: 16px;
        }

        .ranges-list {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .range-item {
            background: var(--stat-card-bg);
            border-radius: 12px;
            padding: 12px 14px;
        }

        .range-item-title {
            font-size: 0.82rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 6px;
        }

        .range-item-bar {
            height: 6px;
            background: var(--range-bar-bg);
            border-radius: 3px;
            position: relative;
            margin-bottom: 6px;
        }

        .range-item-bar-fill {
            position: absolute;
            height: 100%;
            border-radius: 3px;
            background: linear-gradient(90deg, #2563eb, #8b5cf6);
        }

        .range-item-values {
            display: flex;
            justify-content: space-between;
            font-size: 0.72rem;
            color: var(--text-secondary);
        }

        .range-item-mid {
            font-size: 0.82rem;
            font-weight: 600;
            color: var(--accent);
            text-align: center;
        }

        .ranges-toggle {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            margin-top: 12px;
            padding: 10px;
            background: var(--stat-card-bg);
            border: 1px solid var(--border);
            border-radius: 10px;
            font-size: 0.82rem;
            font-weight: 500;
            color: var(--accent);
            cursor: pointer;
            transition: background 0.2s;
        }
        .ranges-toggle:hover {
            background: var(--hover-bg, rgba(0,0,0,0.04));
        }
        .ranges-toggle .toggle-arrow {
            transition: transform 0.3s;
        }
        .ranges-toggle.expanded .toggle-arrow {
            transform: rotate(180deg);
        }

        .currency-hint {
            font-size: 0.8rem;
            color: var(--accent);
            margin-top: 6px;
            font-weight: 500;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .currency-hint.show {
            opacity: 1;
        }

        /* Neighborhood styles */
        .neighborhood-group {
            margin-bottom: 20px;
            animation: fadeSlideIn 0.3s ease-out;
        }

        @keyframes fadeSlideIn {
            from {
                opacity: 0;
                transform: translateY(-8px);
                max-height: 0;
            }
            to {
                opacity: 1;
                transform: translateY(0);
                max-height: 120px;
            }
        }

        .neighborhood-hint {
            font-size: 0.8rem;
            color: var(--info-text-color);
            margin-top: 6px;
            font-weight: 400;
            font-style: italic;
        }

        .optional-tag {
            font-size: 0.7rem;
            font-weight: 500;
            color: var(--optional-tag-color);
            background: var(--optional-tag-bg);
            padding: 2px 8px;
            border-radius: 100px;
            margin-left: 6px;
            vertical-align: middle;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .neighborhood-modifier {
            display: inline-block;
            font-size: 0.75rem;
            font-weight: 600;
            padding: 2px 8px;
            border-radius: 100px;
            margin-left: 4px;
        }

        .modifier-high {
            color: var(--modifier-high-color);
            background: var(--modifier-high-bg);
        }

        .modifier-low {
            color: var(--modifier-low-color);
            background: var(--modifier-low-bg);
        }

        .modifier-avg {
            color: var(--modifier-avg-color);
            background: var(--modifier-avg-bg);
        }

        /* Dark mode toggle */
        .theme-toggle {
            position: absolute;
            top: 0;
            right: 0;
            display: inline-flex;
            align-items: center;
            width: 38px;
            height: 22px;
            background: var(--border);
            border: none;
            border-radius: 11px;
            cursor: pointer;
            padding: 0;
            transition: background 0.3s;
            flex-shrink: 0;
            z-index: 10001;
        }
        .theme-toggle:hover {
            background: var(--text-secondary);
        }
        .theme-toggle .toggle-thumb {
            position: absolute;
            left: 2px;
            width: 18px;
            height: 18px;
            background: var(--card-bg);
            border-radius: 50%;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.15);
        }
        [data-theme="dark"] .theme-toggle {
            background: #3b82f6;
        }
        [data-theme="dark"] .theme-toggle:hover {
            background: #60a5fa;
        }
        [data-theme="dark"] .theme-toggle .toggle-thumb {
            transform: translateX(16px);
            box-shadow: 0 0 0 2px #93c5fd, 0 1px 3px rgba(0,0,0,0.2);
        }
        .theme-toggle .toggle-icon {
            width: 11px;
            height: 11px;
        }
        .theme-toggle .icon-sun {
            color: #f59e0b;
        }
        .theme-toggle .icon-moon {
            display: none;
            color: #3b82f6;
        }
        [data-theme="dark"] .theme-toggle .icon-sun {
            display: none;
        }
        [data-theme="dark"] .theme-toggle .icon-moon {
            display: block;
            color: #3b82f6;
        }

        .header {
            position: relative;
        }

        /* Dark mode — data-theme specifics for SVG/inline overrides */
        [data-theme="dark"] .form-group select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='8' viewBox='0 0 12 8'%3E%3Cpath fill='%2398989f' d='M1.41 0L6 4.58 10.59 0 12 1.41l-6 6-6-6z'/%3E%3C/svg%3E");
        }

        [data-theme="dark"] .form-group select option {
            background: var(--input-bg);
            color: var(--text-primary);
        }

        [data-theme="dark"] .nav-dropdown {
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
        }

        [data-theme="dark"] .form-section h2 span {
            color: var(--section-subtitle-color) !important;
        }

        [data-theme="dark"] .logo-text {
            color: var(--text-primary) !important;
        }

        [data-theme="dark"] .logo-option svg {
            color: var(--text-primary);
        }

        /* Burger button — hidden on desktop, shown on mobile */
        .sidebar-burger {
            display: none;
        }

        .sidebar-overlay {
            display: none;
        }

        @media (max-width: 768px) {
            .theme-toggle {
                position: fixed !important;
                top: 23px !important;
                right: 16px !important;
                z-index: 10001 !important;
            }

            .sidebar-burger {
                display: none !important;
            }

            .sidebar-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0, 0, 0, 0.4);
                z-index: 9997;
                opacity: 0;
                transition: opacity 0.3s;
            }

            .sidebar-overlay.show {
                display: block;
                opacity: 1;
            }

            .sidebar {
                position: fixed !important;
                top: 0 !important;
                right: -320px;
                bottom: 0;
                width: 300px !important;
                max-height: 100vh !important;
                padding: 20px;
                background: var(--sidebar-mobile-bg);
                z-index: 9998;
                transition: right 0.3s ease;
                overflow-y: auto !important;
                border-radius: 0 !important;
                gap: 16px;
            }

            .sidebar.open {
                right: 0;
            }
        }

        .share-bar {
            display: flex; align-items: center; gap: 8px;
            margin: 16px 0 0; padding: 12px 16px;
            background: var(--stat-card-bg, #f5f5f7); border-radius: 12px;
        }
        .share-bar-label {
            font-size: 0.75rem; font-weight: 600; color: var(--text-secondary);
            text-transform: uppercase; letter-spacing: 0.5px; margin-right: 4px;
        }
        .share-btn {
            display: flex; align-items: center; justify-content: center;
            width: 34px; height: 34px; border-radius: 50%;
            border: 1px solid var(--border, #e5e5ea); background: var(--card-bg, #fff);
            color: var(--text-secondary, #86868b); cursor: pointer; transition: all 0.2s;
            padding: 0;
        }
        .share-btn:hover { color: var(--accent); border-color: var(--accent); transform: scale(1.08); }
        .share-btn.copied { color: #22c55e; border-color: #22c55e; }

    </style>
    <script>/* early-theme-detect */(function(){var t=localStorage.getItem("theme");if(t){document.documentElement.setAttribute("data-theme",t)}else if(window.matchMedia("(prefers-color-scheme:dark)").matches){document.documentElement.setAttribute("data-theme","dark")}})();</script>
</head>
<body>
    <button class="sidebar-burger" id="sidebarBurger" aria-label="Toggle stats panel">
        <span class="burger-icon">📊</span>
    </button>
    <div class="sidebar-overlay" id="sidebarOverlay"></div>
    <div class="page-layout">
    <div class="container">
        <div class="header">
            <a href="/city/" class="blog-link" style="left: 80px;">Cities</a>
            <a href="/compare/" class="blog-link" style="left: 150px;">City Comparisons</a>
            <a href="/blog/" class="blog-link" style="left: 235px;">Blog</a>
            <a href="https://salary-converter.com/widget" class="widget-link">Widget</a>
            <button class="nav-burger" id="navBurger" aria-label="Menu">☰</button>
            <div class="nav-dropdown" id="navDropdown">
                <a href="/city/"><span>🏙️</span>Browse Cities</a>
                <a href="/compare/"><span>⚖️</span>Compare Cities</a>
                <a href="/salary-needed/"><span>💰</span>Salary Needed</a>
                <a href="/blog/"><span>📝</span>Read our Blog</a>
                <a href="https://salary-converter.com/widget"><span>🧩</span>Free Widget</a>
                <a href="#" onclick="openContactModal(); return false;"><span>📩</span>Contact Us</a>
            </div>
            <button class="theme-toggle" id="themeToggle" aria-label="Toggle dark mode" type="button">
                <span class="toggle-thumb">
                    <svg class="toggle-icon icon-sun" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
                    <svg class="toggle-icon icon-moon" viewBox="0 0 24 24" fill="currentColor"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
                </span>
            </button>
            <div style="margin-bottom: 8px;">
                <h1 style="font-size: 2.5rem; font-weight: 700; letter-spacing: -1px; color: #1d1d1f; line-height: 1; margin: 0;" class="logo-text">
                    salary<span style="color: #2563eb;">:</span>converter
                </h1>
                <div style="width: 40px; height: 3px; background: #2563eb; border-radius: 2px; margin: 10px auto 0;"></div>
            </div>
            <p style="color: #86868b; font-size: 1.15rem; font-weight: 400; margin-top: 14px;" id="hero-subtitle">Compare salaries across 100 cities and over 2,000 neighborhoods worldwide.</p>
        </div>

        <div class="error-message" id="error"></div>

        <div class="form-section household-section" id="householdSection">
            <h2>👥 Household</h2>
            <div class="household-mode-toggle" id="householdModeToggle">
                <button class="mode-btn active" data-mode="single" type="button">Single</button>
                <button class="mode-btn" data-mode="family" type="button">Family</button>
            </div>
            <div class="family-options" id="familyOptions" style="display:none;">
                <div class="chip-group">
                    <label>Working Adults</label>
                    <div class="chips" id="adultsChips">
                        <button class="chip" data-value="1" type="button">1</button>
                        <button class="chip active" data-value="2" type="button">2</button>
                    </div>
                </div>
                <div class="chip-group">
                    <label>Children</label>
                    <div class="chips" id="childrenChips">
                        <button class="chip" data-value="0" type="button">0</button>
                        <button class="chip active" data-value="1" type="button">1</button>
                        <button class="chip" data-value="2" type="button">2</button>
                        <button class="chip" data-value="3" type="button">3</button>
                        <button class="chip" data-value="4" type="button">4</button>
                    </div>
                </div>
            </div>
            <div class="remote-toggle" id="remoteToggle">
                <label class="remote-label">
                    <input type="checkbox" id="remoteCheckbox">
                    <span class="remote-check"></span>
                    <span>I work remotely <span style="color:var(--text-secondary);font-weight:400;">— compare my purchasing power</span></span>
                </label>
            </div>
        </div>

        <div class="form-section">
            <h2>📍 Current Location</h2>
            <div id="singleSalaryRow">
            <div class="two-column">
                <div class="form-group">
                    <label for="currentSalary" id="salaryLabel">Your Salary</label>
                    <input type="text" id="currentSalary" placeholder="e.g. $60,000">
                </div>
                <div class="form-group">
                    <label for="currentCity">Current City</label>
                    <select id="currentCity">
                        <option value="">Select a city...</option>
                    </select>
                </div>
            </div>
            </div><!-- /singleSalaryRow -->
            <div id="familySalaryInputs" style="display:none;">
                <div class="two-column">
                    <div class="form-group">
                        <label for="adult1Salary">Adult 1 Salary</label>
                        <input type="text" id="adult1Salary" placeholder="e.g. 80,000" inputmode="numeric">
                    </div>
                    <div class="form-group">
                        <label for="adult2Salary">Adult 2 Salary</label>
                        <input type="text" id="adult2Salary" placeholder="e.g. 45,000" inputmode="numeric">
                    </div>
                </div>
                <div class="form-group">
                    <label for="familyCity">Current City</label>
                    <select id="familyCity">
                        <option value="">Select a city...</option>
                    </select>
                </div>
            </div>
            <div class="quick-select" id="currentCityQuick"></div>
            <div class="neighborhood-group" id="currentNeighborhoodGroup" style="display: none;">
                <div class="form-group">
                    <label for="currentNeighborhood">Neighborhood</label>
                    <select id="currentNeighborhood">
                        <option value="">Select a neighborhood...</option>
                    </select>
                    <div class="neighborhood-hint" id="currentNeighborhoodHint">Select a neighborhood for more accurate cost of living and local tax rates</div>
                </div>
            </div>
            <div class="two-column">
                <div class="form-group">
                    <label for="currentCurrency">Current Currency</label>
                    <select id="currentCurrency">
                        <option value="">Select currency...</option>
                    </select>
                    <div class="currency-hint" id="currentCurrencyHint"></div>
                </div>
            </div>
            <p class="info-text">ℹ️ Select or type to choose your current location</p>
        </div>

        <div class="form-section">
            <h2>✈️ Comparable Location <span class="section-subtitle">(what if I were to move to this city?)</span></h2>
            <div class="two-column">
                <div class="form-group">
                    <label for="targetCity">Target City</label>
                    <select id="targetCity">
                        <option value="">Select a city...</option>
                    </select>
                </div>
            </div>
            <div class="quick-select" id="targetCityQuick"></div>
            <div class="neighborhood-group" id="targetNeighborhoodGroup" style="display: none;">
                <div class="form-group">
                    <label for="targetNeighborhood">Neighborhood</label>
                    <select id="targetNeighborhood">
                        <option value="">Select a neighborhood...</option>
                    </select>
                    <div class="neighborhood-hint" id="targetNeighborhoodHint">Select a neighborhood for more accurate cost of living and local tax rates</div>
                </div>
            </div>
            <div class="two-column">
                <div class="form-group">
                    <label for="targetCurrency">Target Currency</label>
                    <select id="targetCurrency">
                        <option value="">Select currency...</option>
                    </select>
                    <div class="currency-hint" id="targetCurrencyHint"></div>
                </div>
            </div>
            <div id="singleOfferRow">
                <div class="form-group" style="margin-top: 8px;">
                    <label for="targetSalary">Target City Salary <span style="font-weight:400;color:var(--text-secondary);">(optional)</span></label>
                    <div style="position:relative;">
                        <span id="offerCurrencyBadge" style="position:absolute;left:12px;top:50%;transform:translateY(-50%);font-size:0.85rem;color:var(--text-secondary);pointer-events:none;display:none;"></span>
                        <input type="text" id="targetSalary" placeholder="e.g. 45,000" inputmode="numeric">
                    </div>
                    <div style="font-size:0.75rem;color:var(--text-secondary);margin-top:4px;">
                        Have a target salary or offer? Enter it for a personalized comparison.
                    </div>
                </div>
            </div>
            <div id="familyOfferInputs" style="display:none;">
                <div class="two-column" style="margin-top: 8px;">
                    <div class="form-group">
                        <label for="offer1Salary">Adult 1 Target Salary <span style="font-weight:400;color:var(--text-secondary);">(optional)</span></label>
                        <input type="text" id="offer1Salary" placeholder="e.g. 80,000" inputmode="numeric">
                    </div>
                    <div class="form-group">
                        <label for="offer2Salary">Adult 2 Target Salary <span style="font-weight:400;color:var(--text-secondary);">(optional)</span></label>
                        <input type="text" id="offer2Salary" placeholder="e.g. 45,000" inputmode="numeric">
                    </div>
                </div>
                <div id="familyOfferCurrencyHint" style="font-size:0.75rem;color:var(--text-secondary);margin-top:4px;">
                    Have target salaries or offers? Enter them for a personalized comparison.
                </div>
            </div>
            <p class="info-text">ℹ️ Choose where you'd like to compare your salary</p>
        </div>

        <div class="button-group">
            <button class="btn btn-calculate" id="calculateBtn">Calculate True Equivalent</button>
            <button class="btn btn-reset" id="resetBtn">Reset</button>
        </div>

        <div class="result-box" id="resultBox">
            <!-- 1. Headline -->
            <div class="result-title" id="resultTitle">Your True Equivalent Salary</div>
            <div class="result-amount" id="resultAmount"></div>
            <div class="result-subtitle" id="resultSubtitle"></div>

            <!-- 2. Target Salary Comparison (is your target salary enough?) -->
            <div class="offer-comparison" id="offerComparison" style="display: none;"></div>

            <!-- 3. Verdict Banner (affordable + take-home comparison) -->
            <div class="verdict-banner" id="verdictBanner" style="display: none;">
                <span class="verdict-icon" id="verdictIcon"></span>
                <span id="verdictText"></span>
            </div>

            <!-- 4. Full Breakdown Cards -->
            <div class="full-breakdown-section" id="fullBreakdownSection" style="display: none;">
                <div class="breakdown-title">Full Breakdown: Gross to Disposable</div>
                <div class="breakdown-cards" id="breakdownCards"></div>
                <div class="breakdown-note" id="breakdownNote"></div>
            </div>


            <!-- 7. How We Calculated This -->
            <div class="explanation-section" id="explanationSection"></div>

            <!-- 8. COLI Reference (demoted) -->
            <div class="coli-reference" id="coliReference" style="display: none;">
                <div class="coli-ref-label">For reference: COLI-only equivalent</div>
                <div class="coli-ref-amount" id="coliRefAmount"></div>
                <div class="coli-ref-note">This simpler number only adjusts for cost-of-living index and exchange rate, without accounting for taxes or specific expenses.</div>
            </div>

            <!-- Salary Ranges by Job Title -->
            <div class="salary-ranges-section" id="salaryRangesSection" style="display: none;">
                <div class="ranges-title">Salary Ranges by Role</div>
                <div class="ranges-subtitle">Adjusted for cost of living in your target city</div>
                <div class="ranges-list" id="rangesList"></div>
                <div class="ranges-toggle" id="rangesToggle" onclick="toggleSalaryRanges()" style="display: none;">
                    <span id="rangesToggleText">Show all roles</span>
                    <span class="toggle-arrow">▼</span>
                </div>
            </div>

            <!-- Share Bar (shown after calculation) -->
            <div class="share-bar" id="resultShareBar" data-share-text="" data-share-url="">
                <span class="share-bar-label">Share</span>
                <button class="share-btn" data-platform="twitter" aria-label="Share on X" type="button"><svg viewBox="0 0 24 24" width="16" height="16"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z" fill="currentColor"/></svg></button>
                <button class="share-btn" data-platform="linkedin" aria-label="Share on LinkedIn" type="button"><svg viewBox="0 0 24 24" width="16" height="16"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" fill="currentColor"/></svg></button>
                <button class="share-btn" data-platform="whatsapp" aria-label="Share on WhatsApp" type="button"><svg viewBox="0 0 24 24" width="16" height="16"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z" fill="currentColor"/></svg></button>
                <button class="share-btn" data-platform="copy" aria-label="Copy link" type="button"><svg viewBox="0 0 24 24" width="16" height="16"><path d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
                <button class="share-btn" data-platform="email" aria-label="Share via email" type="button"><svg viewBox="0 0 24 24" width="16" height="16"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><polyline points="22,6 12,13 2,6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg></button>
            </div>
        </div>
    </div>

    <aside class="sidebar">
        <div class="sidebar-card">
            <h3>💰 What Salary Do You Need?</h3>
            <p style="font-size: 0.82rem; color: var(--text-body); margin-bottom: 14px; line-height: 1.5;">Find the minimum salary to live comfortably — with neighborhood-level breakdowns.</p>
            <div style="display: flex; flex-direction: column; gap: 6px;">
                <a href="/salary-needed/new-york" class="sidebar-salary-link">🇺🇸 New York <span>Find out →</span></a>
                <a href="/salary-needed/london" class="sidebar-salary-link">🇬🇧 London <span>Find out →</span></a>
                <a href="/salary-needed/dubai" class="sidebar-salary-link">🇦🇪 Dubai <span>Find out →</span></a>
                <a href="/salary-needed/singapore" class="sidebar-salary-link">🇸🇬 Singapore <span>Find out →</span></a>
                <a href="/salary-needed/tokyo" class="sidebar-salary-link">🇯🇵 Tokyo <span>Find out →</span></a>
                <a href="/salary-needed/berlin" class="sidebar-salary-link">🇩🇪 Berlin <span>Find out →</span></a>
            </div>
            <a href="/salary-needed/" style="display: block; text-align: center; margin-top: 14px; font-size: 0.82rem; font-weight: 600; color: var(--accent); text-decoration: none;">Browse all 100+ cities →</a>
        </div>

        <div class="sidebar-card">
            <h3>📝 From the Blog</h3>
            <div id="blogArticlesList" style="display: flex; flex-direction: column; gap: 10px;">
                <!-- All 14 articles — JS will randomly show 3 on each page load -->
                <a href="/blog/articles/how-cost-of-living-affects-your-salary" class="blog-article-card" data-blog-article data-tag="Featured" data-title="How Cost of Living Actually Affects Your Salary" data-meta="10 min read · Feb 2026">
                    <div class="blog-article-tag">Featured</div>
                    <div class="blog-article-title">How Cost of Living Actually Affects Your Salary</div>
                    <div class="blog-article-meta">10 min read · Feb 2026</div>
                </a>
                <a href="/blog/articles/top-10-cities-for-remote-workers-2026" class="blog-article-card" data-blog-article data-tag="Remote Work" data-title="Top 10 Cities for Remote Workers in 2026" data-meta="7 min read · Feb 2026">
                    <div class="blog-article-tag">Remote Work</div>
                    <div class="blog-article-title">Top 10 Cities for Remote Workers in 2026</div>
                    <div class="blog-article-meta">7 min read · Feb 2026</div>
                </a>
                <a href="/blog/articles/salary-negotiation-when-relocating-abroad" class="blog-article-card" data-blog-article data-tag="Career" data-title="How to Negotiate Your Salary When Relocating Abroad" data-meta="8 min read · Feb 2026">
                    <div class="blog-article-tag">Career</div>
                    <div class="blog-article-title">How to Negotiate Your Salary When Relocating Abroad</div>
                    <div class="blog-article-meta">8 min read · Feb 2026</div>
                </a>
                <a href="/blog/articles/london-vs-new-york-true-cost-comparison" class="blog-article-card" data-blog-article data-tag="City Guide" data-title="London vs New York: True Cost Comparison" data-meta="9 min read · Feb 2026">
                    <div class="blog-article-tag">City Guide</div>
                    <div class="blog-article-title">London vs New York: True Cost Comparison</div>
                    <div class="blog-article-meta">9 min read · Feb 2026</div>
                </a>
                <a href="/blog/articles/most-expensive-cities-in-the-world-2026" class="blog-article-card" data-blog-article data-tag="Data" data-title="Most Expensive Cities in the World 2026" data-meta="12 min read · Feb 2026">
                    <div class="blog-article-tag">Data</div>
                    <div class="blog-article-title">Most Expensive Cities in the World 2026</div>
                    <div class="blog-article-meta">12 min read · Feb 2026</div>
                </a>
                <a href="/blog/articles/what-is-a-good-salary-by-city-2026" class="blog-article-card" data-blog-article data-tag="Guide" data-title="What Is a Good Salary in Your City? 2026 Guide" data-meta="15 min read · Feb 2026">
                    <div class="blog-article-tag">Guide</div>
                    <div class="blog-article-title">What Is a Good Salary in Your City? 2026 Guide</div>
                    <div class="blog-article-meta">15 min read · Feb 2026</div>
                </a>
                <a href="/blog/articles/cost-of-living-adjustment-cola-guide-2026" class="blog-article-card" data-blog-article data-tag="Finance" data-title="Cost of Living Adjustment (COLA): 2026 Guide" data-meta="10 min read · Feb 2026">
                    <div class="blog-article-tag">Finance</div>
                    <div class="blog-article-title">Cost of Living Adjustment (COLA): 2026 Guide</div>
                    <div class="blog-article-meta">10 min read · Feb 2026</div>
                </a>
                <a href="/blog/articles/geographic-pay-differentials-remote-workers-2026" class="blog-article-card" data-blog-article data-tag="Remote Work" data-title="Geographic Pay Differentials for Remote Workers" data-meta="9 min read · Feb 2026">
                    <div class="blog-article-tag">Remote Work</div>
                    <div class="blog-article-title">Geographic Pay Differentials for Remote Workers</div>
                    <div class="blog-article-meta">9 min read · Feb 2026</div>
                </a>
                <a href="/blog/articles/purchasing-power-parity-explained" class="blog-article-card" data-blog-article data-tag="Economics" data-title="Purchasing Power Parity (PPP) Explained" data-meta="11 min read · Feb 2026">
                    <div class="blog-article-tag">Economics</div>
                    <div class="blog-article-title">Purchasing Power Parity (PPP) Explained</div>
                    <div class="blog-article-meta">11 min read · Feb 2026</div>
                </a>
                <a href="/blog/articles/affordable-cities-in-europe-for-americans-2026" class="blog-article-card" data-blog-article data-tag="Expat Life" data-title="Affordable Cities in Europe for Americans 2026" data-meta="11 min read · Feb 2026">
                    <div class="blog-article-tag">Expat Life</div>
                    <div class="blog-article-title">Affordable Cities in Europe for Americans 2026</div>
                    <div class="blog-article-meta">11 min read · Feb 2026</div>
                </a>
                <a href="/blog/articles/tech-salary-comparison-by-city-2026" class="blog-article-card" data-blog-article data-tag="Tech" data-title="Tech Salary by City 2026 (Adjusted for Cost of Living)" data-meta="10 min read · Feb 2026">
                    <div class="blog-article-tag">Tech</div>
                    <div class="blog-article-title">Tech Salary by City 2026 (Adjusted for Cost of Living)</div>
                    <div class="blog-article-meta">10 min read · Feb 2026</div>
                </a>
                <a href="/blog/articles/dubai-vs-singapore-expat-comparison" class="blog-article-card" data-blog-article data-tag="City Guide" data-title="Dubai vs Singapore: Expat Salary &amp; Cost Comparison" data-meta="9 min read · Feb 2026">
                    <div class="blog-article-tag">City Guide</div>
                    <div class="blog-article-title">Dubai vs Singapore: Expat Salary &amp; Cost Comparison</div>
                    <div class="blog-article-meta">9 min read · Feb 2026</div>
                </a>
                <a href="/blog/articles/how-to-retire-abroad-cost-of-living-guide" class="blog-article-card" data-blog-article data-tag="Retirement" data-title="How to Retire Abroad on a U.S. Salary" data-meta="12 min read · Feb 2026">
                    <div class="blog-article-tag">Retirement</div>
                    <div class="blog-article-title">How to Retire Abroad on a U.S. Salary</div>
                    <div class="blog-article-meta">12 min read · Feb 2026</div>
                </a>
                <a href="/blog/articles/average-salary-by-city-2026-global-comparison" class="blog-article-card" data-blog-article data-tag="Data" data-title="Average Salary by City 2026: 100-City Comparison" data-meta="14 min read · Feb 2026">
                    <div class="blog-article-tag">Data</div>
                    <div class="blog-article-title">Average Salary by City 2026: 100-City Comparison</div>
                    <div class="blog-article-meta">14 min read · Feb 2026</div>
                </a>
            </div>
            <a href="/blog/" class="blog-card-cta">View All Articles →</a>
        </div>

        <!-- Neighborhoods Card -->
        <div class="sidebar-card">
            <h3>🏘️ Neighborhoods</h3>
            <div style="display: flex; flex-direction: column; gap: 12px;">
                <div>
                    <div style="font-size: 0.78rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 6px;">🇬🇧 London</div>
                    <div style="display: flex; flex-wrap: wrap; gap: 4px;">
                        <a href="/city/london/mayfair" class="sidebar-nhood-pill">Mayfair</a>
                        <a href="/city/london/shoreditch" class="sidebar-nhood-pill">Shoreditch</a>
                        <a href="/city/london/brixton" class="sidebar-nhood-pill">Brixton</a>
                    </div>
                </div>
                <div>
                    <div style="font-size: 0.78rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 6px;">🇺🇸 New York</div>
                    <div style="display: flex; flex-wrap: wrap; gap: 4px;">
                        <a href="/city/new-york/manhattan-midtown" class="sidebar-nhood-pill">Midtown</a>
                        <a href="/city/new-york/brooklyn-williamsburg" class="sidebar-nhood-pill">Williamsburg</a>
                        <a href="/city/new-york/harlem" class="sidebar-nhood-pill">Harlem</a>
                    </div>
                </div>
                <div>
                    <div style="font-size: 0.78rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 6px;">🇩🇪 Berlin</div>
                    <div style="display: flex; flex-wrap: wrap; gap: 4px;">
                        <a href="/city/berlin/mitte" class="sidebar-nhood-pill">Mitte</a>
                        <a href="/city/berlin/kreuzberg" class="sidebar-nhood-pill">Kreuzberg</a>
                        <a href="/city/berlin/neukolln" class="sidebar-nhood-pill">Neukölln</a>
                    </div>
                </div>
                <div>
                    <div style="font-size: 0.78rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 6px;">🇯🇵 Tokyo</div>
                    <div style="display: flex; flex-wrap: wrap; gap: 4px;">
                        <a href="/city/tokyo/shibuya" class="sidebar-nhood-pill">Shibuya</a>
                        <a href="/city/tokyo/shinjuku" class="sidebar-nhood-pill">Shinjuku</a>
                        <a href="/city/tokyo/minato" class="sidebar-nhood-pill">Minato</a>
                    </div>
                </div>
                <div>
                    <div style="font-size: 0.78rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 6px;">🇦🇪 Dubai</div>
                    <div style="display: flex; flex-wrap: wrap; gap: 4px;">
                        <a href="/city/dubai/downtown-dubai" class="sidebar-nhood-pill">Downtown</a>
                        <a href="/city/dubai/dubai-marina" class="sidebar-nhood-pill">Marina</a>
                        <a href="/city/dubai/deira" class="sidebar-nhood-pill">Deira</a>
                    </div>
                </div>
                <div>
                    <div style="font-size: 0.78rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 6px;">🇸🇬 Singapore</div>
                    <div style="display: flex; flex-wrap: wrap; gap: 4px;">
                        <a href="/city/singapore/orchard-road" class="sidebar-nhood-pill">Orchard Road</a>
                        <a href="/city/singapore/marina-bay" class="sidebar-nhood-pill">Marina Bay</a>
                        <a href="/city/singapore/jurong" class="sidebar-nhood-pill">Jurong</a>
                    </div>
                </div>
            </div>
            <a href="/city/" style="display: block; text-align: center; font-size: 0.78rem; color: var(--accent); text-decoration: none; font-weight: 600; margin-top: 12px; padding-top: 10px; border-top: 1px solid var(--border);">Browse all 2,100+ neighborhoods →</a>
        </div>
    </aside>
    </div>

    <!-- Compact footer link grid (SEO internal links) -->
    <nav class="footer-links-grid" aria-label="Explore">
        <div class="footer-links-col">
            <h4>Cities</h4>
            <a href="/city/london">London</a>
            <a href="/city/new-york">New York</a>
            <a href="/city/dubai">Dubai</a>
            <a href="/city/singapore">Singapore</a>
            <a href="/city/berlin">Berlin</a>
            <a href="/city/tokyo">Tokyo</a>
            <a href="/city/paris">Paris</a>
            <a href="/city/amsterdam">Amsterdam</a>
            <a href="/city/san-francisco">San Francisco</a>
            <a href="/city/sydney">Sydney</a>
            <a href="/city/toronto">Toronto</a>
            <a href="/city/lisbon">Lisbon</a>
            <a href="/city/bangkok">Bangkok</a>
            <a href="/city/barcelona">Barcelona</a>
            <a href="/city/hong-kong">Hong Kong</a>
            <a href="/city/munich">Munich</a>
            <a href="/city/buenos-aires">Buenos Aires</a>
            <a href="/city/zurich">Zurich</a>
        </div>
        <div class="footer-links-col">
            <h4>Comparisons</h4>
            <a href="/compare/london-vs-new-york">London vs New York</a>
            <a href="/compare/dubai-vs-singapore">Dubai vs Singapore</a>
            <a href="/compare/berlin-vs-london">London vs Berlin</a>
            <a href="/compare/new-york-vs-san-francisco">SF vs New York</a>
            <a href="/compare/london-vs-paris">London vs Paris</a>
            <a href="/compare/singapore-vs-tokyo">Tokyo vs Singapore</a>
            <a href="/compare/melbourne-vs-sydney">Sydney vs Melbourne</a>
            <a href="/compare/amsterdam-vs-berlin">Amsterdam vs Berlin</a>
            <a href="/compare/barcelona-vs-lisbon">Lisbon vs Barcelona</a>
            <a href="/compare/los-angeles-vs-new-york">NY vs Los Angeles</a>
            <a href="/compare/bangkok-vs-ho-chi-minh-city">Bangkok vs HCMC</a>
            <a href="/compare/toronto-vs-vancouver">Toronto vs Vancouver</a>
        </div>
        <div class="footer-links-col">
            <h4>Salary Needed</h4>
            <a href="/salary-needed/london">London</a>
            <a href="/salary-needed/new-york">New York</a>
            <a href="/salary-needed/berlin">Berlin</a>
            <a href="/salary-needed/dubai">Dubai</a>
            <a href="/salary-needed/singapore">Singapore</a>
            <a href="/salary-needed/tokyo">Tokyo</a>
            <a href="/salary-needed/paris">Paris</a>
            <a href="/salary-needed/amsterdam">Amsterdam</a>
            <a href="/salary-needed/sydney">Sydney</a>
            <a href="/salary-needed/lisbon">Lisbon</a>
            <a href="/salary-needed/barcelona">Barcelona</a>
            <a href="/salary-needed/toronto">Toronto</a>
        </div>
        <div class="footer-links-col">
            <h4>Neighborhoods</h4>
            <a href="/city/london/mayfair">London: Mayfair</a>
            <a href="/city/london/marylebone">London: Marylebone</a>
            <a href="/city/london/shoreditch">London: Shoreditch</a>
            <a href="/city/london/brixton">London: Brixton</a>
            <a href="/city/new-york/manhattan-midtown">NY: Midtown</a>
            <a href="/city/new-york/brooklyn-williamsburg">NY: Williamsburg</a>
            <a href="/city/new-york/manhattan-upper-east-side">NY: Upper East Side</a>
            <a href="/city/new-york/harlem">NY: Harlem</a>
            <a href="/city/berlin/mitte">Berlin: Mitte</a>
            <a href="/city/berlin/kreuzberg">Berlin: Kreuzberg</a>
            <a href="/city/tokyo/shibuya">Tokyo: Shibuya</a>
            <a href="/city/tokyo/minato">Tokyo: Minato</a>
            <a href="/city/dubai/downtown-dubai">Dubai: Downtown</a>
            <a href="/city/dubai/dubai-marina">Dubai: Marina</a>
            <a href="/city/singapore/orchard-road">SG: Orchard Road</a>
            <a href="/city/singapore/marina-bay">SG: Marina Bay</a>
        </div>
        <div class="footer-links-col">
            <h4>Guides</h4>
            <a href="/blog/articles/how-cost-of-living-affects-your-salary">How Cost of Living Affects Salary</a>
            <a href="/blog/articles/top-10-cities-for-remote-workers-2026">Top 10 Cities for Remote Workers</a>
            <a href="/blog/articles/london-vs-new-york-true-cost-comparison">London vs New York Deep Dive</a>
            <a href="/blog/articles/tech-salary-comparison-by-city-2026">Tech Salary by City 2026</a>
            <a href="/blog/articles/salary-negotiation-when-relocating-abroad">Salary Negotiation Abroad</a>
            <a href="/blog/articles/affordable-cities-in-europe-for-americans-2026">Affordable European Cities</a>
        </div>
    </nav>

    <div class="contact-overlay" id="contactOverlay">
        <div class="contact-modal">
            <button class="contact-modal-close" onclick="closeContactModal()" aria-label="Close">&times;</button>
            <h2>Contact Us</h2>
            <p class="contact-subtitle">Have feedback, found a data error, or want to suggest a feature?</p>
            <form id="contactForm" class="contact-form">
                <input type="hidden" name="access_key" value="YOUR_WEB3FORMS_KEY">
                <input type="hidden" name="subject" value="salary-converter.com Contact Form">
                <div class="contact-form-grid">
                    <div class="form-group">
                        <label for="contactName">Name</label>
                        <input type="text" id="contactName" name="name" placeholder="Your name" required>
                    </div>
                    <div class="form-group">
                        <label for="contactEmail">Email</label>
                        <input type="email" id="contactEmail" name="email" placeholder="your@email.com" required>
                    </div>
                </div>
                <div class="form-group" style="margin-top: 8px;">
                    <label for="contactMessage">Message</label>
                    <textarea id="contactMessage" name="message" rows="4" placeholder="Your message..." required></textarea>
                </div>
                <button type="submit" class="btn btn-calculate" style="margin-top: 12px;">Send Message</button>
            </form>
            <div id="contactSuccess" style="display:none;" class="contact-success">
                Thank you! We'll get back to you soon.
            </div>
        </div>
    </div>

    <footer class="site-footer">
        <div class="site-footer-logo">salary<span>:</span>converter</div>
        <div class="site-footer-text" id="footer-subtitle">Compare salaries across 100 cities and over 2,000 neighborhoods worldwide.</div>
        <div class="site-footer-links">
            <a href="https://salary-converter.com">Salary Tool</a>
            <a href="/city/">Cities</a>
            <a href="/compare/">City Comparisons</a>
            <a href="/salary-needed/">Salary Needed</a>
            <a href="/blog/">Blog</a>
            <a href="/widget">Widget</a>
            <a href="#" onclick="openContactModal(); return false;">Contact</a>
        </div>
    </footer>

    <script>
        // 2026 Data - Cost of Living Index (New York = 100)
        const coliData = {
            // North America
            'New York': 100,
            'San Francisco': 97.6,
            'Los Angeles': 76.3,
            'Chicago': 73.2,
            'Miami': 80.1,
            'Austin': 64.8,
            'Seattle': 79.5,
            'Denver': 65.7,
            'Boston': 82.4,
            'Washington DC': 79.8,
            'Houston': 60.2,
            'Toronto': 62.3,
            'Vancouver': 65.4,
            'Montreal': 52.1,
            'Mexico City': 32.5,
            'Cancún': 35.8,
            'Panama City': 42.3,

            // Europe - Western
            'London': 87.5,
            'Paris': 46.9,
            'Amsterdam': 82.6,
            'Berlin': 51.2,
            'Munich': 61.5,
            'Dublin': 72.8,
            'Brussels': 50.3,
            'Luxembourg City': 68.4,
            'Zurich': 122.4,
            'Geneva': 118.6,
            'Edinburgh': 62.1,
            'Nice': 52.7,

            // Europe - Southern
            'Madrid': 38.0,
            'Barcelona': 42.1,
            'Valencia': 33.5,
            'Málaga': 31.2,
            'Lisbon': 34.7,
            'Porto': 30.1,
            'Rome': 49.3,
            'Milan': 57.8,
            'Athens': 30.6,
            'Split': 31.8,

            // Europe - Northern
            'Stockholm': 64.3,
            'Copenhagen': 85.7,
            'Helsinki': 58.2,
            'Oslo': 78.5,
            'Vienna': 48.2,

            // Europe - Eastern
            'Prague': 30.6,
            'Budapest': 26.1,
            'Warsaw': 28.4,
            'Krakow': 23.8,
            'Bucharest': 22.5,
            'Tallinn': 28.9,
            'Riga': 25.3,
            'Istanbul': 23.1,

            // Asia - East
            'Tokyo': 77.3,
            'Osaka': 62.8,
            'Fukuoka': 51.4,
            'Seoul': 68.9,
            'Hong Kong': 73.6,
            'Taipei': 44.8,
            'Shanghai': 46.2,
            'Beijing': 43.5,
            'Shenzhen': 41.9,
            'Guangzhou': 38.7,

            // Asia - Southeast
            'Singapore': 87.7,
            'Bangkok': 37.2,
            'Chiang Mai': 22.6,
            'Phuket': 30.5,
            'Kuala Lumpur': 32.8,
            'Ho Chi Minh City': 26.4,
            'Hanoi': 24.1,
            'Manila': 26.8,
            'Jakarta': 24.5,
            'Bali (Denpasar)': 25.3,
            'Phnom Penh': 24.8,

            // Asia - South
            'Mumbai': 22.3,
            'Bangalore': 20.8,
            'Delhi': 19.5,
            'Chennai': 18.9,

            // Oceania
            'Sydney': 74.5,
            'Melbourne': 68.2,
            'Perth': 63.5,
            'Auckland': 60.8,

            // Middle East
            'Dubai': 72.4,
            'Abu Dhabi': 67.8,
            'Doha': 69.5,
            'Riyadh': 42.6,
            'Tel Aviv': 81.3,

            // Africa
            'Cape Town': 28.4,
            'Nairobi': 24.7,
            'Lagos': 27.3,
            'Cairo': 16.8,
            'Marrakech': 19.2,
            'Casablanca': 22.1,

            // South America
            'São Paulo': 41.8,
            'Buenos Aires': 25.6,
            'Bogotá': 22.9,
            'Lima': 25.8,
            'Santiago': 33.2,
            'Medellín': 20.4,
            'Montevideo': 32.5,
            'San José (CR)': 31.2,
            'Playa del Carmen': 30.8
        };

        // 2026 Exchange Rates (vs GBP)
        const exchangeRates = {
            'GBP': 1.0,
            'USD': 1.328,
            'EUR': 1.126,
            'SGD': 1.73,
            'JPY': 205.72,
            'AED': 4.811,
            'THB': 41.157,
            'AUD': 1.887,
            'CAD': 1.798,
            'CHF': 1.076,
            'CNY': 8.94,
            'HKD': 10.4,
            'INR': 110.5,
            'MYR': 5.4,
            'NZD': 2.14,
            'SEK': 12.09,
            'NOK': 13.34,
            'DKK': 8.43,
            'CZK': 30.6,
            'HUF': 477,
            'PLN': 5.2,
            'TRY': 42.5,
            'BRL': 6.7,
            'MXN': 22.5,
            'ZAR': 24.2,
            'KRW': 1686,
            'TWD': 42.0,
            'IDR': 20500,
            'VND': 33200,
            'PHP': 74.5,
            'ILS': 4.78,
            'EGP': 64.8,
            'KES': 171.5,
            'NGN': 2100,
            'MAD': 12.9,
            'ARS': 1480,
            'COP': 5520,
            'PEN': 4.92,
            'CLP': 1245,
            'UYU': 55.8,
            'CRC': 672,
            'QAR': 4.84,
            'SAR': 4.98,
            'PAB': 1.328,
            'RON': 5.62
        };

        // City to default currency mapping
        const cityToCurrency = {
            // North America
            'New York': 'USD', 'San Francisco': 'USD', 'Los Angeles': 'USD',
            'Chicago': 'USD', 'Miami': 'USD', 'Austin': 'USD', 'Seattle': 'USD',
            'Denver': 'USD', 'Boston': 'USD', 'Washington DC': 'USD', 'Houston': 'USD',
            'Toronto': 'CAD', 'Vancouver': 'CAD', 'Montreal': 'CAD',
            'Mexico City': 'MXN', 'Cancún': 'MXN', 'Panama City': 'USD',
            // Europe - Western
            'London': 'GBP', 'Edinburgh': 'GBP',
            'Paris': 'EUR', 'Amsterdam': 'EUR', 'Berlin': 'EUR', 'Munich': 'EUR',
            'Dublin': 'EUR', 'Brussels': 'EUR', 'Luxembourg City': 'EUR', 'Nice': 'EUR',
            'Zurich': 'CHF', 'Geneva': 'CHF',
            // Europe - Southern
            'Madrid': 'EUR', 'Barcelona': 'EUR', 'Valencia': 'EUR', 'Málaga': 'EUR',
            'Lisbon': 'EUR', 'Porto': 'EUR', 'Rome': 'EUR', 'Milan': 'EUR',
            'Athens': 'EUR', 'Split': 'EUR',
            // Europe - Northern
            'Stockholm': 'SEK', 'Copenhagen': 'DKK', 'Helsinki': 'EUR',
            'Oslo': 'NOK', 'Vienna': 'EUR',
            // Europe - Eastern
            'Prague': 'CZK', 'Budapest': 'HUF', 'Warsaw': 'PLN', 'Krakow': 'PLN',
            'Bucharest': 'RON', 'Tallinn': 'EUR', 'Riga': 'EUR', 'Istanbul': 'TRY',
            // Asia - East
            'Tokyo': 'JPY', 'Osaka': 'JPY', 'Fukuoka': 'JPY',
            'Seoul': 'KRW', 'Hong Kong': 'HKD', 'Taipei': 'TWD',
            'Shanghai': 'CNY', 'Beijing': 'CNY', 'Shenzhen': 'CNY', 'Guangzhou': 'CNY',
            // Asia - Southeast
            'Singapore': 'SGD',
            'Bangkok': 'THB', 'Chiang Mai': 'THB', 'Phuket': 'THB',
            'Kuala Lumpur': 'MYR',
            'Ho Chi Minh City': 'VND', 'Hanoi': 'VND',
            'Manila': 'PHP', 'Jakarta': 'IDR', 'Bali (Denpasar)': 'IDR',
            'Phnom Penh': 'USD',
            // Asia - South
            'Mumbai': 'INR', 'Bangalore': 'INR', 'Delhi': 'INR', 'Chennai': 'INR',
            // Oceania
            'Sydney': 'AUD', 'Melbourne': 'AUD', 'Perth': 'AUD', 'Auckland': 'NZD',
            // Middle East
            'Dubai': 'AED', 'Abu Dhabi': 'AED', 'Doha': 'QAR',
            'Riyadh': 'SAR', 'Tel Aviv': 'ILS',
            // Africa
            'Cape Town': 'ZAR', 'Nairobi': 'KES', 'Lagos': 'NGN',
            'Cairo': 'EGP', 'Marrakech': 'MAD', 'Casablanca': 'MAD',
            // South America
            'São Paulo': 'BRL', 'Buenos Aires': 'ARS',
            'Bogotá': 'COP', 'Medellín': 'COP',
            'Lima': 'PEN', 'Santiago': 'CLP', 'Montevideo': 'UYU',
            'San José (CR)': 'CRC', 'Playa del Carmen': 'MXN'
        };

        // City to country mapping
        const cityToCountry = {
            'New York': 'US', 'San Francisco': 'US', 'Los Angeles': 'US',
            'Chicago': 'US', 'Miami': 'US', 'Austin': 'US', 'Seattle': 'US',
            'Denver': 'US', 'Boston': 'US', 'Washington DC': 'US', 'Houston': 'US',
            'Toronto': 'CA', 'Vancouver': 'CA', 'Montreal': 'CA',
            'Mexico City': 'MX', 'Cancún': 'MX', 'Panama City': 'PA',
            'London': 'GB', 'Edinburgh': 'GB',
            'Paris': 'FR', 'Nice': 'FR',
            'Amsterdam': 'NL', 'Berlin': 'DE', 'Munich': 'DE',
            'Dublin': 'IE', 'Brussels': 'BE', 'Luxembourg City': 'LU',
            'Zurich': 'CH', 'Geneva': 'CH',
            'Madrid': 'ES', 'Barcelona': 'ES', 'Valencia': 'ES', 'Málaga': 'ES',
            'Lisbon': 'PT', 'Porto': 'PT', 'Rome': 'IT', 'Milan': 'IT',
            'Athens': 'GR', 'Split': 'HR',
            'Stockholm': 'SE', 'Copenhagen': 'DK', 'Helsinki': 'FI', 'Oslo': 'NO', 'Vienna': 'AT',
            'Prague': 'CZ', 'Budapest': 'HU', 'Warsaw': 'PL', 'Krakow': 'PL',
            'Bucharest': 'RO', 'Tallinn': 'EE', 'Riga': 'LV', 'Istanbul': 'TR',
            'Tokyo': 'JP', 'Osaka': 'JP', 'Fukuoka': 'JP',
            'Seoul': 'KR', 'Hong Kong': 'HK', 'Taipei': 'TW',
            'Shanghai': 'CN', 'Beijing': 'CN', 'Shenzhen': 'CN', 'Guangzhou': 'CN',
            'Singapore': 'SG', 'Bangkok': 'TH', 'Chiang Mai': 'TH', 'Phuket': 'TH',
            'Kuala Lumpur': 'MY', 'Ho Chi Minh City': 'VN', 'Hanoi': 'VN',
            'Manila': 'PH', 'Jakarta': 'ID', 'Bali (Denpasar)': 'ID', 'Phnom Penh': 'KH',
            'Mumbai': 'IN', 'Bangalore': 'IN', 'Delhi': 'IN', 'Chennai': 'IN',
            'Sydney': 'AU', 'Melbourne': 'AU', 'Perth': 'AU', 'Auckland': 'NZ',
            'Dubai': 'AE', 'Abu Dhabi': 'AE', 'Doha': 'QA', 'Riyadh': 'SA', 'Tel Aviv': 'IL',
            'Cape Town': 'ZA', 'Nairobi': 'KE', 'Lagos': 'NG', 'Cairo': 'EG',
            'Marrakech': 'MA', 'Casablanca': 'MA',
            'São Paulo': 'BR', 'Buenos Aires': 'AR', 'Bogotá': 'CO', 'Medellín': 'CO',
            'Lima': 'PE', 'Santiago': 'CL', 'Montevideo': 'UY',
            'San José (CR)': 'CR', 'Playa del Carmen': 'MX'
        };

        // Progressive income tax brackets by country [[upperBound, marginalRate%], ...]
        // Brackets in local currency, annual. Tax computed progressively on each slice.
        const taxBrackets = {
            // Tax-free
            'AE': [], 'QA': [], 'SA': [], 'KH': [],
            // Americas
            'US': [[11600,10],[47150,12],[100525,22],[191950,24],[243725,32],[609350,35],[Infinity,37]],
            'CA': [[55867,15],[111733,20.5],[154906,26],[220000,29],[Infinity,33]],
            'MX': [[8952,1.92],[75985,6.4],[133536,10.88],[155230,16],[185853,17.92],[374838,21.36],[590797,23.52],[1127927,30],[1503902,32],[4511707,34],[Infinity,35]],
            'PA': [[11000,0],[50000,15],[Infinity,25]],
            'BR': [[24512,0],[33920,7.5],[45013,15],[55976,22.5],[Infinity,27.5]],
            'AR': [[419254,5],[838508,9],[1257762,12],[1677016,15],[2516524,19],[3356032,23],[5034048,27],[6712063,31],[Infinity,35]],
            'CO': [[46229000,0],[72066000,19],[163386000,28],[368076000,33],[624096000,35],[969456000,37],[Infinity,39]],
            'PE': [[29050,0],[54250,8],[81375,14],[116250,17],[232500,20],[Infinity,30]],
            'CL': [[8775702,0],[19501560,4],[32502600,8],[45503640,13.5],[58504680,23],[78006240,30.4],[101508120,35],[Infinity,40]],
            'UY': [[468720,0],[670320,10],[1005480,15],[1536000,24],[2421600,25],[3643200,27],[5685600,31],[Infinity,36]],
            'CR': [[11160000,0],[16380000,10],[Infinity,15]],
            // UK (Income Tax only — NI adds ~8-12% but varies by earnings; this covers income tax brackets)
            'GB': [[12570,0],[50270,20],[125140,40],[Infinity,45]],
            // Europe
            'FR': [[11294,0],[28797,11],[82341,30],[177106,41],[Infinity,45]],
            'NL': [[38098,9.32],[75518,36.97],[Infinity,49.50]],
            'DE': [[11604,0],[17005,14],[66760,24],[277826,42],[Infinity,45]],
            'IE': [[42000,20],[Infinity,40]],
            'BE': [[15200,0],[28730,25],[40580,40],[Infinity,50]],
            'LU': [[11265,0],[25000,14],[50000,30],[100000,38],[200000,41],[Infinity,42]],
            'CH': [[14500,0],[50000,10],[100000,16],[200000,22],[Infinity,22]],
            'ES': [[12450,19],[20200,24],[35200,30],[60000,37],[300000,45],[Infinity,47]],
            'PT': [[7703,13.25],[11623,18],[16472,23],[21321,26],[27146,32.75],[39791,37],[51997,43.5],[81199,45],[Infinity,48]],
            'IT': [[15000,23],[28000,25],[50000,35],[Infinity,43]],
            'GR': [[10000,9],[20000,22],[30000,28],[40000,36],[Infinity,44]],
            'HR': [[50400,20],[Infinity,30]],
            'SE': [[614942,32],[Infinity,52]],
            'DK': [[46700,0],[588900,37],[Infinity,52]],
            'FI': [[19900,0],[29700,32.64],[49000,37.4],[85800,41.25],[Infinity,51.25]],
            'NO': [[198350,22],[279150,23.7],[642950,26],[926800,35.4],[1500000,38.4],[Infinity,39.4]],
            'AT': [[12816,0],[21816,20],[35016,30],[68016,40],[103816,48],[1000000,50],[Infinity,55]],
            'CZ': [[1935552,15],[Infinity,23]],
            'HU': [[Infinity,15]],
            'PL': [[30000,0],[120000,12],[Infinity,32]],
            'RO': [[Infinity,10]],
            'EE': [[7848,0],[Infinity,20]],
            'LV': [[20004,20],[78100,23],[Infinity,31]],
            'TR': [[110000,15],[230000,20],[580000,27],[3000000,35],[Infinity,40]],
            // Asia
            'JP': [[1950000,5],[3300000,10],[6950000,20],[9000000,23],[18000000,33],[40000000,40],[Infinity,45]],
            'KR': [[14000000,6],[50000000,15],[88000000,24],[150000000,35],[300000000,38],[500000000,40],[1000000000,42],[Infinity,45]],
            'HK': [[50000,2],[100000,6],[150000,10],[200000,14],[Infinity,17]],
            'TW': [[560000,5],[1260000,12],[2520000,20],[4720000,30],[Infinity,40]],
            'CN': [[36000,3],[144000,10],[300000,20],[420000,25],[660000,30],[960000,35],[Infinity,45]],
            'SG': [[20000,0],[30000,2],[40000,3.5],[80000,7],[120000,11.5],[160000,15],[200000,18],[240000,19],[280000,19.5],[320000,20],[500000,22],[1000000,23],[Infinity,24]],
            'TH': [[150000,0],[300000,5],[500000,10],[750000,15],[1000000,20],[2000000,25],[5000000,30],[Infinity,35]],
            'MY': [[5000,0],[20000,1],[35000,3],[50000,6],[70000,11],[100000,19],[400000,25],[600000,26],[2000000,28],[Infinity,30]],
            'VN': [[60000000,5],[120000000,10],[216000000,15],[384000000,20],[624000000,25],[960000000,30],[Infinity,35]],
            'PH': [[250000,0],[400000,15],[800000,20],[2000000,25],[8000000,30],[Infinity,35]],
            'ID': [[60000000,5],[250000000,15],[500000000,25],[5000000000,30],[Infinity,35]],
            'IN': [[300000,0],[700000,5],[1000000,10],[1200000,15],[1500000,20],[Infinity,30]],
            // Oceania
            'AU': [[18200,0],[45000,16],[135000,30],[190000,37],[Infinity,45]],
            'NZ': [[14000,10.5],[48000,17.5],[70000,30],[180000,33],[Infinity,39]],
            // Middle East & Africa
            'IL': [[84120,10],[120720,14],[193800,20],[269280,31],[560280,35],[721560,47],[Infinity,50]],
            'ZA': [[237100,18],[370500,26],[512800,31],[673000,36],[857900,39],[1817000,41],[Infinity,45]],
            'KE': [[288000,10],[388000,25],[6000000,30],[9600000,32.5],[Infinity,35]],
            'NG': [[300000,7],[600000,11],[1100000,15],[1600000,19],[3200000,21],[Infinity,24]],
            'EG': [[40000,0],[55000,10],[70000,15],[200000,20],[400000,22.5],[Infinity,25]],
            'MA': [[30000,0],[50000,10],[60000,20],[80000,30],[180000,34],[Infinity,38]]
        };

        // Calculate progressive tax: returns { tax, effectiveRate, net }
        function calculateTax(income, countryCode) {
            const brackets = taxBrackets[countryCode];
            if (!brackets || brackets.length === 0) return { tax: 0, effectiveRate: 0, net: income };
            let tax = 0, prev = 0;
            for (const [limit, rate] of brackets) {
                if (income <= prev) break;
                tax += (Math.min(income, limit) - prev) * (rate / 100);
                prev = limit;
            }
            const effectiveRate = income > 0 ? Math.round((tax / income) * 100) : 0;
            return { tax, effectiveRate, net: income - tax };
        }

        // Social security & mandatory deductions by country (ISO codes)
        // Each: social_security = {local: %, expat: %, cap: amount|null, label, reduced_rate?}
        const countryDeductions = {
            'AE': {}, 'QA': {}, 'KH': {},
            'SA': {social_security: {local: 9.75, expat: 0, cap: null, label: 'GOSI'}},
            'US': {social_security: {local: 7.65, expat: 7.65, cap: 168600, label: 'Social Security + Medicare (FICA)'}},
            'CA': {social_security: {local: 6.8, expat: 0, cap: 68500, label: 'CPP + EI'}},
            'MX': {social_security: {local: 2.78, expat: 0, cap: null, label: 'IMSS'}},
            'PA': {social_security: {local: 9.75, expat: 0, cap: null, label: 'CSS'}},
            'BR': {social_security: {local: 14, expat: 0, cap: 105432, label: 'INSS'}},
            'AR': {social_security: {local: 17, expat: 0, cap: null, label: 'Social Security'}},
            'CO': {social_security: {local: 8, expat: 0, cap: null, label: 'Health + Pension'}},
            'PE': {social_security: {local: 13, expat: 0, cap: null, label: 'ONP/AFP + EsSalud'}},
            'CL': {social_security: {local: 19.5, expat: 0, cap: null, label: 'AFP + Health + Unemployment'}},
            'UY': {social_security: {local: 18.1, expat: 0, cap: null, label: 'BPS Contributions'}},
            'CR': {social_security: {local: 10.67, expat: 0, cap: null, label: 'CCSS + Worker Risks'}},
            'GB': {social_security: {local: 8, expat: 0, cap: 50270, reduced_rate: 2, label: 'National Insurance (NI)'}},
            'FR': {social_security: {local: 22, expat: 0, cap: null, label: 'Social Charges (CSG/CRDS)'}},
            'NL': {social_security: {local: 27.65, expat: 0, cap: 38098, label: 'Social Premiums'}},
            'DE': {social_security: {local: 20.2, expat: 20.2, cap: 90600, label: 'Social Security (Pension+Health+Unemp+Care)'}, solidarity: {rate: 5.5, of: 'income_tax', label: 'Solidarity Surcharge'}},
            'IE': {social_security: {local: 4, expat: 0, cap: null, label: 'PRSI'}},
            'BE': {social_security: {local: 13.07, expat: 0, cap: null, label: 'Social Security'}},
            'LU': {social_security: {local: 12.45, expat: 12.45, cap: null, label: 'Social Security'}},
            'CH': {social_security: {local: 6.4, expat: 6.4, cap: null, label: 'AHV/IV/EO + ALV'}},
            'ES': {social_security: {local: 6.35, expat: 0, cap: 56646, label: 'Social Security'}},
            'PT': {social_security: {local: 11, expat: 0, cap: null, label: 'Social Security'}},
            'IT': {social_security: {local: 9.19, expat: 0, cap: 119650, label: 'INPS Contributions'}},
            'GR': {social_security: {local: 13.87, expat: 0, cap: null, label: 'Social Insurance'}},
            'HR': {social_security: {local: 20, expat: 0, cap: null, label: 'Pension + Health'}},
            'SE': {social_security: {local: 7, expat: 0, cap: null, label: 'Employee Social Fees'}},
            'DK': {social_security: {local: 8, expat: 0, cap: null, label: 'AM-bidrag + ATP'}},
            'FI': {social_security: {local: 10.5, expat: 0, cap: null, label: 'Pension + Unemployment + Health'}},
            'NO': {social_security: {local: 7.8, expat: 0, cap: null, label: 'Trygdeavgift'}},
            'AT': {social_security: {local: 18.07, expat: 0, cap: 78660, label: 'Social Security'}},
            'CZ': {social_security: {local: 11, expat: 0, cap: null, label: 'Social + Health Insurance'}},
            'HU': {social_security: {local: 18.5, expat: 0, cap: null, label: 'Social Contribution (TB)'}},
            'PL': {social_security: {local: 13.71, expat: 0, cap: null, label: 'ZUS Contributions'}},
            'RO': {social_security: {local: 35, expat: 0, cap: null, label: 'CAS + CASS'}},
            'EE': {social_security: {local: 1.6, expat: 0, cap: null, label: 'Unemployment Insurance'}},
            'LV': {social_security: {local: 10.5, expat: 0, cap: null, label: 'Social Security'}},
            'TR': {social_security: {local: 15, expat: 0, cap: null, label: 'SSI + Unemployment'}},
            'JP': {social_security: {local: 14.75, expat: 14.75, cap: null, label: 'Health + Pension + Employment'}},
            'KR': {social_security: {local: 9.4, expat: 0, cap: null, label: 'NPS + Health + Employment'}},
            'HK': {social_security: {local: 5, expat: 0, cap: 18000, label: 'MPF'}},
            'TW': {social_security: {local: 5.17, expat: 0, cap: null, label: 'Labor + Health Insurance'}},
            'CN': {social_security: {local: 22.5, expat: 0, cap: null, label: 'Five Insurances + Housing Fund'}},
            'SG': {social_security: {local: 20, expat: 0, cap: 102000, label: 'CPF (Employee Share)'}},
            'TH': {social_security: {local: 5, expat: 0, cap: 180000, label: 'Social Security'}},
            'MY': {social_security: {local: 11, expat: 0, cap: null, label: 'EPF'}},
            'VN': {social_security: {local: 10.5, expat: 0, cap: null, label: 'Social + Health + Unemployment'}},
            'PH': {social_security: {local: 5, expat: 0, cap: null, label: 'SSS + PhilHealth + Pag-IBIG'}},
            'ID': {social_security: {local: 5, expat: 0, cap: null, label: 'BPJS (Health + Employment)'}},
            'IN': {social_security: {local: 12, expat: 0, cap: 180000, label: 'PF + ESI'}},
            'AU': {},
            'NZ': {social_security: {local: 3, expat: 0, cap: null, label: 'KiwiSaver (default)'}},
            'IL': {social_security: {local: 12, expat: 0, cap: null, label: 'National Insurance + Health'}},
            'ZA': {social_security: {local: 1, expat: 0, cap: 17712, label: 'UIF'}},
            'KE': {social_security: {local: 6, expat: 0, cap: null, label: 'NSSF + NHIF + Housing Levy'}},
            'NG': {social_security: {local: 8, expat: 0, cap: null, label: 'Pension + NHF'}},
            'EG': {social_security: {local: 11, expat: 0, cap: null, label: 'Social Insurance'}},
            'MA': {social_security: {local: 6.29, expat: 0, cap: null, label: 'CNSS'}}
        };

        // City-level deduction overrides (state/provincial/cantonal taxes, council tax, etc.)
        const cityDeductionOverrides = {
            'New York': {state_tax: {rate: 10.3, label: 'State + City Income Tax (NY)'}},
            'San Francisco': {state_tax: {rate: 9.3, label: 'State Income Tax (CA)'}},
            'Los Angeles': {state_tax: {rate: 9.3, label: 'State Income Tax (CA)'}},
            'Chicago': {state_tax: {rate: 4.95, label: 'State Income Tax (IL)'}},
            'Austin': {state_tax: {rate: 0, label: 'No State Income Tax (TX)'}},
            'Miami': {state_tax: {rate: 0, label: 'No State Income Tax (FL)'}},
            'Seattle': {state_tax: {rate: 0, label: 'No State Income Tax (WA)'}},
            'Denver': {state_tax: {rate: 4.4, label: 'State Income Tax (CO)'}},
            'Boston': {state_tax: {rate: 9.0, label: 'State Income Tax (MA)'}},
            'Washington DC': {state_tax: {rate: 8.5, label: 'District Income Tax (DC)'}},
            'Houston': {state_tax: {rate: 0, label: 'No State Income Tax (TX)'}},
            'Zurich': {cantonal_tax: {rate: 22, label: 'Cantonal + Municipal Tax (Zürich)'}},
            'Geneva': {cantonal_tax: {rate: 26, label: 'Cantonal + Municipal Tax (Genève)'}},
            'Toronto': {provincial_tax: {rate: 9.15, label: 'Provincial Tax (Ontario)'}},
            'Vancouver': {provincial_tax: {rate: 7.7, label: 'Provincial Tax (BC)'}},
            'Montreal': {provincial_tax: {rate: 15, label: 'Provincial Tax (Québec)'}},
            'Berlin': {solidarity: {rate: 5.5, of: 'income_tax', label: 'Solidarity Surcharge'}},
            'Munich': {solidarity: {rate: 5.5, of: 'income_tax', label: 'Solidarity Surcharge'}},
            'London': {council_tax: {flat_annual: 1800, label: 'Council Tax (avg)'}},
            'Edinburgh': {council_tax: {flat_annual: 1500, label: 'Council Tax (avg)'}}
        };

        // Neighborhood-level deduction overrides (Tier 1: exact researched rates)
        const neighborhoodDeductions = {
            'London': {
                'Mayfair': {council_tax: {flat_annual: 972, label: 'Council Tax (Westminster)'}},
                'Chelsea': {council_tax: {flat_annual: 972, label: 'Council Tax (Kensington & Chelsea)'}},
                'Kensington': {council_tax: {flat_annual: 972, label: 'Council Tax (Kensington & Chelsea)'}},
                'Soho': {council_tax: {flat_annual: 972, label: 'Council Tax (Westminster)'}},
                'Marylebone': {council_tax: {flat_annual: 972, label: 'Council Tax (Westminster)'}},
                'Notting Hill': {council_tax: {flat_annual: 972, label: 'Council Tax (Kensington & Chelsea)'}},
                'Shoreditch': {council_tax: {flat_annual: 1672, label: 'Council Tax (Hackney)'}},
                'Hackney': {council_tax: {flat_annual: 1672, label: 'Council Tax (Hackney)'}},
                'Camden': {council_tax: {flat_annual: 1942, label: 'Council Tax (Camden)'}},
                'Islington': {council_tax: {flat_annual: 1635, label: 'Council Tax (Islington)'}},
                'Brixton': {council_tax: {flat_annual: 1844, label: 'Council Tax (Lambeth)'}},
                'Peckham': {council_tax: {flat_annual: 1820, label: 'Council Tax (Southwark)'}},
                'Canary Wharf': {council_tax: {flat_annual: 1541, label: 'Council Tax (Tower Hamlets)'}},
                'Greenwich': {council_tax: {flat_annual: 1808, label: 'Council Tax (Greenwich)'}},
                'Clapham': {council_tax: {flat_annual: 1844, label: 'Council Tax (Lambeth)'}},
                'Stratford': {council_tax: {flat_annual: 1637, label: 'Council Tax (Newham)'}},
                'Hampstead': {council_tax: {flat_annual: 1942, label: 'Council Tax (Camden)'}},
                'Battersea': {council_tax: {flat_annual: 898, label: 'Council Tax (Wandsworth)'}},
                'Fulham': {council_tax: {flat_annual: 1375, label: 'Council Tax (Hammersmith & Fulham)'}},
                'Wimbledon': {council_tax: {flat_annual: 1694, label: 'Council Tax (Merton)'}},
                'Ealing': {council_tax: {flat_annual: 1765, label: 'Council Tax (Ealing)'}},
                'Dalston': {council_tax: {flat_annual: 1672, label: 'Council Tax (Hackney)'}},
                'Tooting': {council_tax: {flat_annual: 898, label: 'Council Tax (Wandsworth)'}},
                'Walthamstow': {council_tax: {flat_annual: 2050, label: 'Council Tax (Waltham Forest)'}},
                'Richmond': {council_tax: {flat_annual: 1994, label: 'Council Tax (Richmond)'}},
                'Putney': {council_tax: {flat_annual: 898, label: 'Council Tax (Wandsworth)'}},
                'Chiswick': {council_tax: {flat_annual: 1666, label: 'Council Tax (Hounslow)'}},
                'Balham': {council_tax: {flat_annual: 898, label: 'Council Tax (Wandsworth)'}},
                'Lewisham': {council_tax: {flat_annual: 1859, label: 'Council Tax (Lewisham)'}},
                'Croydon': {council_tax: {flat_annual: 2081, label: 'Council Tax (Croydon)'}},
                'Barking': {council_tax: {flat_annual: 1751, label: 'Council Tax (Barking & Dagenham)'}},
                'Angel (Islington)': {council_tax: {flat_annual: 1635, label: 'Council Tax (Islington)'}},
                'Vauxhall': {council_tax: {flat_annual: 1844, label: 'Council Tax (Lambeth)'}},
                'Bermondsey': {council_tax: {flat_annual: 1820, label: 'Council Tax (Southwark)'}},
                'Kentish Town': {council_tax: {flat_annual: 1942, label: 'Council Tax (Camden)'}}
            },
            'Geneva': {
                'Eaux-Vives': {cantonal_tax: {rate: 26, label: 'Cantonal + Municipal Tax (Genève ville)'}},
                'Champel': {cantonal_tax: {rate: 26, label: 'Cantonal + Municipal Tax (Genève ville)'}},
                'Carouge': {cantonal_tax: {rate: 25, label: 'Cantonal + Municipal Tax (Carouge)'}},
                'Plainpalais': {cantonal_tax: {rate: 26, label: 'Cantonal + Municipal Tax (Genève ville)'}},
                'Pâquis': {cantonal_tax: {rate: 26, label: 'Cantonal + Municipal Tax (Genève ville)'}},
                'Nations': {cantonal_tax: {rate: 26, label: 'Cantonal + Municipal Tax (Genève ville)'}},
                'Servette': {cantonal_tax: {rate: 26, label: 'Cantonal + Municipal Tax (Genève ville)'}},
                'Meyrin': {cantonal_tax: {rate: 27, label: 'Cantonal + Municipal Tax (Meyrin)'}},
                'Vernier': {cantonal_tax: {rate: 28, label: 'Cantonal + Municipal Tax (Vernier)'}},
                'Cologny': {cantonal_tax: {rate: 21, label: 'Cantonal + Municipal Tax (Cologny)'}},
                'Florissant': {cantonal_tax: {rate: 26, label: 'Cantonal + Municipal Tax (Genève ville)'}},
                'Grand-Saconnex': {cantonal_tax: {rate: 25, label: 'Cantonal + Municipal Tax (Grand-Saconnex)'}},
                'Lancy': {cantonal_tax: {rate: 27, label: 'Cantonal + Municipal Tax (Lancy)'}},
                'Onex': {cantonal_tax: {rate: 28, label: 'Cantonal + Municipal Tax (Onex)'}},
                'Thônex': {cantonal_tax: {rate: 27, label: 'Cantonal + Municipal Tax (Thônex)'}},
                'Chêne-Bourg': {cantonal_tax: {rate: 27, label: 'Cantonal + Municipal Tax (Chêne-Bourg)'}},
                'Bernex': {cantonal_tax: {rate: 27, label: 'Cantonal + Municipal Tax (Bernex)'}},
                'Plan-les-Ouates': {cantonal_tax: {rate: 25, label: 'Cantonal + Municipal Tax (Plan-les-Ouates)'}}
            }
        };

        // Approximate average monthly rent for 1BR in city center (USD)
        const cityRent1BR = {
            'New York': 3500, 'San Francisco': 3200, 'Los Angeles': 2400, 'Chicago': 2000,
            'Miami': 2500, 'Austin': 1800, 'Seattle': 2200, 'Denver': 1900, 'Boston': 2800,
            'Washington DC': 2400, 'Houston': 1600, 'Toronto': 2000, 'Vancouver': 2100,
            'Montreal': 1400, 'Mexico City': 700, 'Cancún': 600, 'Panama City': 1000,
            'London': 2500, 'Paris': 1400, 'Amsterdam': 1800, 'Berlin': 1200, 'Munich': 1500,
            'Dublin': 2000, 'Brussels': 1100, 'Luxembourg City': 1800, 'Zurich': 2800,
            'Geneva': 2600, 'Edinburgh': 1300, 'Nice': 1100,
            'Madrid': 1100, 'Barcelona': 1200, 'Valencia': 850, 'Málaga': 800,
            'Lisbon': 1000, 'Porto': 800, 'Rome': 1200, 'Milan': 1400, 'Athens': 700, 'Split': 650,
            'Stockholm': 1500, 'Copenhagen': 1800, 'Helsinki': 1200, 'Oslo': 1600, 'Vienna': 1000,
            'Prague': 800, 'Budapest': 600, 'Warsaw': 700, 'Krakow': 550, 'Bucharest': 500,
            'Tallinn': 650, 'Riga': 550, 'Istanbul': 450,
            'Tokyo': 1500, 'Osaka': 1000, 'Fukuoka': 700, 'Seoul': 1200, 'Hong Kong': 2500,
            'Taipei': 800, 'Shanghai': 1100, 'Beijing': 1000, 'Shenzhen': 900, 'Guangzhou': 750,
            'Singapore': 2200, 'Bangkok': 600, 'Chiang Mai': 350, 'Phuket': 500,
            'Kuala Lumpur': 550, 'Ho Chi Minh City': 500, 'Hanoi': 450, 'Manila': 500,
            'Jakarta': 500, 'Bali (Denpasar)': 450, 'Phnom Penh': 450,
            'Mumbai': 700, 'Bangalore': 400, 'Delhi': 350, 'Chennai': 300,
            'Sydney': 2200, 'Melbourne': 1800, 'Perth': 1500, 'Auckland': 1400,
            'Dubai': 1800, 'Abu Dhabi': 1500, 'Doha': 1600, 'Riyadh': 800, 'Tel Aviv': 1800,
            'Cape Town': 650, 'Nairobi': 500, 'Lagos': 600, 'Cairo': 300,
            'Marrakech': 350, 'Casablanca': 400,
            'São Paulo': 600, 'Buenos Aires': 400, 'Bogotá': 400, 'Lima': 450,
            'Santiago': 550, 'Medellín': 350, 'Montevideo': 500,
            'San José (CR)': 550, 'Playa del Carmen': 500
        };

        // Monthly living costs per city (USD) — groceries, utilities, transport, healthcare, childcare
        const cityLivingCosts = {
            'New York': {groceries:550,utilities:330,transport:134,healthcare:450,childcare:2400},
            'San Francisco': {groceries:520,utilities:365,transport:87,healthcare:420,childcare:2500},
            'Los Angeles': {groceries:450,utilities:290,transport:100,healthcare:400,childcare:1800},
            'Chicago': {groceries:400,utilities:250,transport:105,healthcare:380,childcare:1600},
            'Miami': {groceries:420,utilities:280,transport:115,healthcare:400,childcare:1500},
            'Austin': {groceries:380,utilities:260,transport:42,healthcare:350,childcare:1300},
            'Seattle': {groceries:450,utilities:280,transport:100,healthcare:400,childcare:2000},
            'Denver': {groceries:400,utilities:230,transport:115,healthcare:370,childcare:1500},
            'Boston': {groceries:480,utilities:300,transport:90,healthcare:420,childcare:2200},
            'Washington DC': {groceries:470,utilities:280,transport:100,healthcare:400,childcare:2400},
            'Houston': {groceries:370,utilities:260,transport:45,healthcare:360,childcare:1200},
            'Toronto': {groceries:350,utilities:230,transport:110,healthcare:75,childcare:1100},
            'Vancouver': {groceries:360,utilities:200,transport:75,healthcare:75,childcare:1200},
            'Montreal': {groceries:320,utilities:180,transport:65,healthcare:50,childcare:200},
            'Mexico City': {groceries:250,utilities:115,transport:20,healthcare:50,childcare:475},
            'Cancún': {groceries:280,utilities:245,transport:28,healthcare:50,childcare:210},
            'Panama City': {groceries:300,utilities:180,transport:30,healthcare:60,childcare:500},
            'London': {groceries:400,utilities:415,transport:225,healthcare:50,childcare:2600},
            'Paris': {groceries:380,utilities:320,transport:105,healthcare:60,childcare:1450},
            'Amsterdam': {groceries:350,utilities:310,transport:100,healthcare:130,childcare:2400},
            'Berlin': {groceries:300,utilities:310,transport:50,healthcare:90,childcare:135},
            'Munich': {groceries:350,utilities:320,transport:60,healthcare:90,childcare:400},
            'Dublin': {groceries:350,utilities:280,transport:120,healthcare:50,childcare:1200},
            'Brussels': {groceries:340,utilities:280,transport:55,healthcare:80,childcare:975},
            'Luxembourg City': {groceries:380,utilities:300,transport:0,healthcare:80,childcare:1550},
            'Zurich': {groceries:550,utilities:325,transport:100,healthcare:400,childcare:3600},
            'Geneva': {groceries:530,utilities:310,transport:80,healthcare:400,childcare:3400},
            'Edinburgh': {groceries:320,utilities:290,transport:70,healthcare:30,childcare:1400},
            'Nice': {groceries:370,utilities:280,transport:50,healthcare:60,childcare:1000},
            'Madrid': {groceries:280,utilities:235,transport:55,healthcare:40,childcare:550},
            'Barcelona': {groceries:290,utilities:230,transport:45,healthcare:40,childcare:600},
            'Valencia': {groceries:250,utilities:210,transport:40,healthcare:35,childcare:400},
            'Málaga': {groceries:240,utilities:200,transport:40,healthcare:35,childcare:380},
            'Lisbon': {groceries:280,utilities:220,transport:45,healthcare:35,childcare:450},
            'Porto': {groceries:250,utilities:200,transport:40,healthcare:35,childcare:380},
            'Rome': {groceries:320,utilities:260,transport:40,healthcare:40,childcare:700},
            'Milan': {groceries:350,utilities:270,transport:40,healthcare:45,childcare:800},
            'Athens': {groceries:270,utilities:230,transport:35,healthcare:35,childcare:400},
            'Split': {groceries:280,utilities:230,transport:40,healthcare:30,childcare:350},
            'Stockholm': {groceries:350,utilities:200,transport:100,healthcare:40,childcare:180},
            'Copenhagen': {groceries:380,utilities:250,transport:60,healthcare:35,childcare:400},
            'Helsinki': {groceries:330,utilities:220,transport:65,healthcare:40,childcare:350},
            'Oslo': {groceries:400,utilities:370,transport:70,healthcare:30,childcare:235},
            'Vienna': {groceries:310,utilities:280,transport:55,healthcare:60,childcare:350},
            'Prague': {groceries:280,utilities:375,transport:24,healthcare:25,childcare:955},
            'Budapest': {groceries:240,utilities:250,transport:30,healthcare:25,childcare:500},
            'Warsaw': {groceries:260,utilities:270,transport:30,healthcare:25,childcare:550},
            'Krakow': {groceries:230,utilities:250,transport:25,healthcare:25,childcare:400},
            'Bucharest': {groceries:250,utilities:210,transport:20,healthcare:20,childcare:450},
            'Tallinn': {groceries:290,utilities:400,transport:35,healthcare:30,childcare:645},
            'Riga': {groceries:280,utilities:400,transport:35,healthcare:25,childcare:560},
            'Istanbul': {groceries:250,utilities:115,transport:75,healthcare:40,childcare:350},
            'Tokyo': {groceries:400,utilities:215,transport:78,healthcare:200,childcare:1100},
            'Osaka': {groceries:350,utilities:195,transport:65,healthcare:180,childcare:900},
            'Fukuoka': {groceries:320,utilities:180,transport:55,healthcare:170,childcare:800},
            'Seoul': {groceries:350,utilities:205,transport:45,healthcare:100,childcare:700},
            'Hong Kong': {groceries:450,utilities:260,transport:70,healthcare:60,childcare:1020},
            'Taipei': {groceries:300,utilities:120,transport:38,healthcare:40,childcare:650},
            'Shanghai': {groceries:350,utilities:130,transport:30,healthcare:50,childcare:800},
            'Beijing': {groceries:340,utilities:120,transport:25,healthcare:50,childcare:750},
            'Shenzhen': {groceries:320,utilities:110,transport:30,healthcare:45,childcare:700},
            'Guangzhou': {groceries:300,utilities:100,transport:25,healthcare:45,childcare:650},
            'Singapore': {groceries:380,utilities:200,transport:100,healthcare:150,childcare:1465},
            'Bangkok': {groceries:250,utilities:140,transport:38,healthcare:50,childcare:550},
            'Chiang Mai': {groceries:200,utilities:100,transport:58,healthcare:40,childcare:840},
            'Phuket': {groceries:240,utilities:145,transport:24,healthcare:45,childcare:645},
            'Kuala Lumpur': {groceries:220,utilities:120,transport:35,healthcare:40,childcare:400},
            'Ho Chi Minh City': {groceries:200,utilities:100,transport:12,healthcare:30,childcare:350},
            'Hanoi': {groceries:190,utilities:95,transport:10,healthcare:25,childcare:300},
            'Manila': {groceries:220,utilities:160,transport:15,healthcare:35,childcare:400},
            'Jakarta': {groceries:200,utilities:110,transport:15,healthcare:30,childcare:300},
            'Bali (Denpasar)': {groceries:180,utilities:70,transport:12,healthcare:30,childcare:160},
            'Phnom Penh': {groceries:220,utilities:150,transport:10,healthcare:30,childcare:635},
            'Mumbai': {groceries:150,utilities:75,transport:6,healthcare:25,childcare:200},
            'Bangalore': {groceries:140,utilities:80,transport:15,healthcare:25,childcare:180},
            'Delhi': {groceries:130,utilities:70,transport:10,healthcare:20,childcare:150},
            'Chennai': {groceries:120,utilities:65,transport:8,healthcare:20,childcare:130},
            'Sydney': {groceries:380,utilities:270,transport:145,healthcare:150,childcare:2100},
            'Melbourne': {groceries:350,utilities:250,transport:115,healthcare:150,childcare:2000},
            'Perth': {groceries:340,utilities:240,transport:120,healthcare:150,childcare:1800},
            'Auckland': {groceries:340,utilities:220,transport:125,healthcare:100,childcare:1200},
            'Dubai': {groceries:380,utilities:400,transport:87,healthcare:80,childcare:1200},
            'Abu Dhabi': {groceries:360,utilities:380,transport:80,healthcare:70,childcare:1100},
            'Doha': {groceries:350,utilities:215,transport:33,healthcare:50,childcare:775},
            'Riyadh': {groceries:300,utilities:180,transport:40,healthcare:50,childcare:600},
            'Tel Aviv': {groceries:420,utilities:250,transport:55,healthcare:80,childcare:1230},
            'Cape Town': {groceries:220,utilities:185,transport:55,healthcare:60,childcare:240},
            'Nairobi': {groceries:200,utilities:95,transport:31,healthcare:40,childcare:200},
            'Lagos': {groceries:180,utilities:100,transport:36,healthcare:30,childcare:670},
            'Cairo': {groceries:120,utilities:45,transport:7,healthcare:25,childcare:100},
            'Marrakech': {groceries:170,utilities:80,transport:10,healthcare:25,childcare:100},
            'Casablanca': {groceries:200,utilities:100,transport:25,healthcare:30,childcare:465},
            'São Paulo': {groceries:220,utilities:150,transport:55,healthcare:60,childcare:500},
            'Buenos Aires': {groceries:200,utilities:235,transport:20,healthcare:50,childcare:300},
            'Bogotá': {groceries:200,utilities:120,transport:39,healthcare:40,childcare:330},
            'Lima': {groceries:200,utilities:95,transport:20,healthcare:35,childcare:190},
            'Santiago': {groceries:250,utilities:160,transport:40,healthcare:60,childcare:500},
            'Medellín': {groceries:180,utilities:120,transport:60,healthcare:35,childcare:545},
            'Montevideo': {groceries:280,utilities:260,transport:72,healthcare:70,childcare:520},
            'San José (CR)': {groceries:280,utilities:180,transport:60,healthcare:70,childcare:695},
            'Playa del Carmen': {groceries:260,utilities:140,transport:28,healthcare:45,childcare:210}
        };

        // Deduction keys that scale with neighborhood cost multiplier
        const scalableDeductions = new Set(['council_tax', 'property_tax']);

        const deductionColors = {
            income_tax: '#ef4444', social_security: '#f59e0b',
            state_tax: '#8b5cf6', cantonal_tax: '#8b5cf6', provincial_tax: '#8b5cf6',
            solidarity: '#06b6d4', church_tax: '#06b6d4',
            council_tax: '#6b7280', trash_tax: '#6b7280'
        };

        function calculateAllDeductions(income, countryCode, cityName, neighborhood) {
            if (income <= 0) return {items: [], total: 0, totalRate: 0, net: 0};
            const items = [];
            const nhoodOverrides = (neighborhood && neighborhoodDeductions[cityName]) ? (neighborhoodDeductions[cityName][neighborhood] || {}) : {};
            const nhoodMult = (neighborhood && cityNeighborhoods[cityName]) ? (cityNeighborhoods[cityName][neighborhood] || 1.0) : 1.0;
            // 1. Income Tax
            const taxResult = calculateTax(income, countryCode);
            items.push({key: 'income_tax', label: 'Income Tax', amount: taxResult.tax, rate: taxResult.effectiveRate});
            // 2. Social Security
            const cDed = countryDeductions[countryCode] || {};
            const ss = cDed.social_security;
            if (ss) {
                const ssRate = ss.local || 0;
                if (ssRate > 0) {
                    const ssBase = ss.cap ? Math.min(income, ss.cap) : income;
                    let ssAmount = ssBase * (ssRate / 100);
                    if (ss.reduced_rate && ss.cap && income > ss.cap) {
                        ssAmount += (income - ss.cap) * (ss.reduced_rate / 100);
                    }
                    const ssEffRate = Math.round((ssAmount / income) * 1000) / 10;
                    items.push({key: 'social_security', label: ss.label || 'Social Security', amount: ssAmount, rate: ssEffRate});
                }
            }
            // 3. City/neighborhood-level taxes (Tier 1 neighborhood override → city → country)
            const cityDed = cityDeductionOverrides[cityName] || {};
            for (const taxKey of ['state_tax', 'cantonal_tax', 'provincial_tax']) {
                const taxInfo = nhoodOverrides[taxKey] || cityDed[taxKey] || cDed[taxKey];
                if (taxInfo && (taxInfo.rate || 0) > 0) {
                    const amount = income * (taxInfo.rate / 100);
                    items.push({key: taxKey, label: taxInfo.label, amount, rate: taxInfo.rate});
                }
            }
            // 4. Levies with 3-tier neighborhood lookup
            for (const levyKey of ['solidarity', 'church_tax', 'council_tax', 'trash_tax']) {
                let levy = nhoodOverrides[levyKey];
                if (!levy) {
                    const baseLevy = cityDed[levyKey] || cDed[levyKey];
                    if (!baseLevy) continue;
                    // Tier 2: Scale property-linked deductions by neighborhood multiplier
                    if (scalableDeductions.has(levyKey) && neighborhood && baseLevy.flat_annual) {
                        const scaled = Math.round(baseLevy.flat_annual * nhoodMult);
                        levy = {flat_annual: scaled, label: baseLevy.label + ' (est.)', of: baseLevy.of, rate: baseLevy.rate};
                    } else {
                        // Tier 3: City/country fallback
                        levy = baseLevy;
                    }
                }
                if (levy.flat_annual) {
                    const effRate = Math.round((levy.flat_annual / income) * 1000) / 10;
                    items.push({key: levyKey, label: levy.label, amount: levy.flat_annual, rate: effRate});
                } else if (levy.of === 'income_tax') {
                    const amount = taxResult.tax * (levy.rate / 100);
                    const effRate = Math.round((amount / income) * 1000) / 10;
                    items.push({key: levyKey, label: levy.label, amount, rate: effRate});
                } else if (levy.rate) {
                    const amount = income * (levy.rate / 100);
                    items.push({key: levyKey, label: levy.label, amount, rate: levy.rate});
                }
            }
            const total = items.reduce((s, i) => s + i.amount, 0);
            const totalRate = income > 0 ? Math.round((total / income) * 1000) / 10 : 0;
            return {items, total, totalRate, net: income - total};
        }

        function reverseGrossFromNet(targetNet, countryCode, cityName, neighborhood) {
            if (targetNet <= 0) return 0;
            let lo = targetNet;
            let hi = targetNet * 3;
            let testDed = calculateAllDeductions(hi, countryCode, cityName, neighborhood);
            while (testDed.net < targetNet) {
                hi *= 2;
                testDed = calculateAllDeductions(hi, countryCode, cityName, neighborhood);
            }
            for (let i = 0; i < 100; i++) {
                const mid = (lo + hi) / 2;
                const midDed = calculateAllDeductions(mid, countryCode, cityName, neighborhood);
                if (midDed.net < targetNet) {
                    lo = mid;
                } else {
                    hi = mid;
                }
                if (hi - lo < 1) break;
            }
            return Math.round((lo + hi) / 2);
        }

        // Household state
        const householdState = { mode: 'single', adults: 2, children: 1, remote: false };

        function getHousehold() {
            return {
                mode: householdState.mode,
                adults: householdState.mode === 'single' ? 1 : householdState.adults,
                children: householdState.mode === 'single' ? 0 : householdState.children,
                remote: householdState.remote
            };
        }

        function setHouseholdMode(mode) {
            householdState.mode = mode;
            document.querySelectorAll('#householdModeToggle .mode-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.mode === mode);
            });
            document.getElementById('familyOptions').style.display = mode === 'family' ? '' : 'none';
            updateSalaryFields();
        }

        function updateSalaryFields() {
            const h = getHousehold();
            const singleRow = document.getElementById('singleSalaryRow');
            const familyInputs = document.getElementById('familySalaryInputs');
            const salaryLabel = document.getElementById('salaryLabel');
            const singleOfferRow = document.getElementById('singleOfferRow');
            const familyOfferInputs = document.getElementById('familyOfferInputs');

            if (h.mode === 'single') {
                singleRow.style.display = '';
                familyInputs.style.display = 'none';
                salaryLabel.textContent = 'Your Salary';
                singleOfferRow.style.display = '';
                familyOfferInputs.style.display = 'none';
            } else if (h.adults === 1) {
                singleRow.style.display = '';
                familyInputs.style.display = 'none';
                salaryLabel.textContent = 'Household Income';
                singleOfferRow.style.display = '';
                familyOfferInputs.style.display = 'none';
            } else {
                singleRow.style.display = 'none';
                familyInputs.style.display = '';
                singleOfferRow.style.display = 'none';
                familyOfferInputs.style.display = '';
                // Sync family city with current city
                const cc = document.getElementById('currentCity').value;
                if (cc) document.getElementById('familyCity').value = cc;
            }
            // Remote mode: hide target salary inputs (we use the same salary)
            if (householdState.remote) {
                singleOfferRow.style.display = 'none';
                familyOfferInputs.style.display = 'none';
            }
        }

        const RENT_MULTIPLIERS = { '1BR': 1.0, '2BR': 1.4, '3BR': 1.8 };

        function calculateExpenses(cityName, neighMult, currencyCode, household) {
            const rent1BR = cityRent1BR[cityName];
            const costs = cityLivingCosts[cityName];
            const usdToLocalRate = exchangeRates[currencyCode] / exchangeRates['USD'];
            if (!rent1BR && !costs) return null;

            const h = household || { mode: 'single', adults: 1, children: 0 };
            const extraAdults = Math.max(0, h.adults - 1);
            const numChildren = h.children;

            // Rent sizing
            let rentKey;
            if (h.mode === 'single') {
                rentKey = '1BR';
            } else if (numChildren <= 1) {
                rentKey = '2BR';
            } else {
                rentKey = '3BR';
            }
            const rentMult = RENT_MULTIPLIERS[rentKey];
            const rentLabel = rentKey;

            // Rent: full neighborhood multiplier (rent is directly neighborhood-dependent)
            const annualRent = rent1BR ? rent1BR * rentMult * neighMult * usdToLocalRate * 12 : 0;
            let groceries = 0, utilities = 0, transport = 0, healthcare = 0, childcare = 0;

            if (costs) {
                const groceryScale = 1 + (0.5 * extraAdults) + (0.3 * numChildren);
                const utilityScale = 1 + (0.3 * extraAdults) + (0.15 * numChildren);
                const transportScale = h.adults;
                const healthScale = 1 + (0.7 * extraAdults) + (0.3 * numChildren);

                // Groceries: dampened neighborhood multiplier (supermarkets don't vary as much as rent)
                const groceryNeighMult = 1 + (neighMult - 1) * 0.5;
                groceries = costs.groceries * groceryScale * groceryNeighMult * usdToLocalRate * 12;
                // Utilities, transport, healthcare, childcare: no neighborhood multiplier
                // (utility rates, transit passes, doctor fees, and nursery fees are city-wide, not street-level)
                utilities = costs.utilities * utilityScale * usdToLocalRate * 12;
                transport = costs.transport * transportScale * usdToLocalRate * 12;
                healthcare = costs.healthcare * healthScale * usdToLocalRate * 12;
                childcare = numChildren > 0 ? costs.childcare * numChildren * usdToLocalRate * 12 : 0;
            }

            const total = annualRent + groceries + utilities + transport + healthcare + childcare;
            return { rent: annualRent, groceries, utilities, transport, healthcare, childcare, total, hasRent: !!rent1BR, hasLivingCosts: !!costs, rentLabel };
        }

        function toggleSalaryRanges() {
            const rangesList = document.getElementById('rangesList');
            const items = rangesList.querySelectorAll('.range-item');
            const toggle = document.getElementById('rangesToggle');
            const toggleText = document.getElementById('rangesToggleText');
            const isExpanded = toggle.classList.contains('expanded');
            const isMobile = window.innerWidth <= 768;
            const visibleCount = 3 * (isMobile ? 1 : 2);

            if (isExpanded) {
                items.forEach((item, i) => {
                    if (i >= visibleCount) item.style.display = 'none';
                });
                toggle.classList.remove('expanded');
                toggleText.textContent = `Show all ${items.length} roles`;
                document.getElementById('salaryRangesSection').scrollIntoView({ behavior: 'smooth', block: 'start' });
            } else {
                items.forEach(item => item.style.display = '');
                toggle.classList.add('expanded');
                toggleText.textContent = 'Show fewer';
            }
        }

        // Salary ranges by job title (annual USD, global median ranges)
        const salaryRanges = {
            // Healthcare
            'Doctor (General)': { low: 80000, mid: 180000, high: 350000 },
            'Surgeon': { low: 120000, mid: 280000, high: 500000 },
            'Dentist': { low: 70000, mid: 160000, high: 300000 },
            'Pharmacist': { low: 60000, mid: 125000, high: 200000 },
            'Nurse': { low: 30000, mid: 58000, high: 100000 },
            'Psychologist': { low: 45000, mid: 85000, high: 150000 },
            // Engineering & Tech
            'Software Engineer': { low: 45000, mid: 85000, high: 180000 },
            'DevOps Engineer': { low: 50000, mid: 95000, high: 175000 },
            'Data Scientist': { low: 50000, mid: 95000, high: 170000 },
            'Mechanical Engineer': { low: 40000, mid: 78000, high: 140000 },
            'Civil Engineer': { low: 38000, mid: 72000, high: 135000 },
            'Electrical Engineer': { low: 42000, mid: 80000, high: 145000 },
            'Architect': { low: 38000, mid: 72000, high: 130000 },
            'UX Designer': { low: 40000, mid: 75000, high: 140000 },
            // Business & Finance
            'Product Manager': { low: 55000, mid: 100000, high: 190000 },
            'Project Manager': { low: 45000, mid: 80000, high: 150000 },
            'Financial Analyst': { low: 42000, mid: 78000, high: 145000 },
            'Accountant': { low: 35000, mid: 62000, high: 110000 },
            'Business Analyst': { low: 42000, mid: 75000, high: 140000 },
            'Consultant': { low: 45000, mid: 90000, high: 180000 },
            'Investment Banker': { low: 80000, mid: 150000, high: 350000 },
            'Actuary': { low: 60000, mid: 110000, high: 200000 },
            // Legal
            'Lawyer': { low: 50000, mid: 100000, high: 220000 },
            'Paralegal': { low: 30000, mid: 52000, high: 85000 },
            // Marketing & Sales
            'Marketing Manager': { low: 38000, mid: 72000, high: 135000 },
            'Sales Manager': { low: 40000, mid: 80000, high: 160000 },
            'Graphic Designer': { low: 30000, mid: 55000, high: 100000 },
            'Content Writer': { low: 25000, mid: 50000, high: 90000 },
            // Management & HR
            'HR Manager': { low: 38000, mid: 70000, high: 130000 },
            'Operations Manager': { low: 45000, mid: 82000, high: 150000 },
            'CEO / Executive': { low: 100000, mid: 220000, high: 500000 },
            // Education & Research
            'Teacher': { low: 25000, mid: 48000, high: 85000 },
            'Professor': { low: 50000, mid: 95000, high: 180000 },
            'Research Scientist': { low: 45000, mid: 85000, high: 155000 },
            // Skilled Trades & Other
            'Pilot': { low: 50000, mid: 120000, high: 250000 },
            'Chef': { low: 25000, mid: 50000, high: 100000 },
            'Journalist': { low: 25000, mid: 52000, high: 95000 }
        };

        // Neighborhood data: multipliers relative to city COLI (1.0 = city average)
        const cityNeighborhoods = {
            // ===== NORTH AMERICA =====
            'New York': {
                'Manhattan (Midtown)': 1.25, 'Manhattan (Upper East Side)': 1.30, 'Manhattan (Lower East Side)': 1.10,
                'Brooklyn (Williamsburg)': 1.05, 'Brooklyn (Park Slope)': 1.08, 'Brooklyn (Bushwick)': 0.88,
                'Queens (Astoria)': 0.90, 'Queens (Long Island City)': 0.95, 'Harlem': 0.82,
                'The Bronx': 0.72, 'Staten Island': 0.75, 'SoHo / Tribeca': 1.35,
                'Chelsea': 1.18, 'West Village': 1.28, 'Greenwich Village': 1.25, 'Upper West Side': 1.22, 'Financial District': 1.2, 'DUMBO': 1.15, 'Fort Greene': 1.02, 'Prospect Heights': 1.05, 'Crown Heights': 0.85, 'Red Hook': 0.88, 'Greenpoint': 1.0, 'Jackson Heights': 0.78, 'Flushing': 0.8, 'Bay Ridge': 0.82, 'Forest Hills': 0.88, 'Hoboken (NJ)': 1.08, 'Murray Hill': 1.12, "Hell's Kitchen": 1.1
            },
            'San Francisco': {
                'Financial District': 1.20, 'SoMa': 1.15, 'Mission District': 1.05,
                'Castro': 1.08, 'Sunset District': 0.92, 'Richmond District': 0.90,
                'Nob Hill': 1.18, 'Pacific Heights': 1.25, 'Tenderloin': 0.78,
                'Oakland (Downtown)': 0.80, 'Oakland (Rockridge)': 0.88, 'Berkeley': 0.90,
                'Marina District': 1.22, 'Hayes Valley': 1.15, 'Potrero Hill': 1.1, 'Dogpatch': 1.05, 'Russian Hill': 1.2, 'North Beach': 1.12, 'Haight-Ashbury': 1.08, 'Excelsior': 0.82, 'Bayview': 0.75, 'Daly City': 0.78, 'San Mateo': 0.92, 'Palo Alto': 1.28
            },
            'Los Angeles': {
                'Santa Monica': 1.25, 'Beverly Hills': 1.40, 'Hollywood': 1.10,
                'Downtown LA': 1.05, 'Silver Lake': 1.08, 'Venice': 1.20,
                'Koreatown': 0.85, 'Echo Park': 0.90, 'Pasadena': 0.92,
                'Long Beach': 0.80, 'Culver City': 1.02, 'Burbank': 0.88,
                'West Hollywood': 1.22, 'Westwood': 1.18, 'Glendale': 0.9, 'Studio City': 1.05, 'Sherman Oaks': 1.02, 'Encino': 1.08, 'Bel Air': 1.45, 'Mar Vista': 0.95, 'Los Feliz': 1.12, 'Highland Park': 0.88, 'Eagle Rock': 0.85, 'Inglewood': 0.72, 'Torrance': 0.82, 'Malibu': 1.42, 'Manhattan Beach': 1.3, 'Playa del Rey': 1.1, 'Arts District': 1.05, 'Atwater Village': 0.95
            },
            'Chicago': {
                'The Loop': 1.20, 'Lincoln Park': 1.15, 'Wicker Park': 1.08,
                'River North': 1.22, 'Gold Coast': 1.25, 'Lakeview': 1.05,
                'Logan Square': 0.92, 'Pilsen': 0.82, 'Hyde Park': 0.85,
                'Bridgeport': 0.78, 'Evanston': 0.95, 'Oak Park': 0.90,
                'Bucktown': 1.1, 'Uptown': 0.88, 'Edgewater': 0.9, 'West Loop': 1.18, 'South Loop': 1.08, 'Humboldt Park': 0.82, 'Ravenswood': 0.95, 'Irving Park': 0.8, 'Avondale': 0.85, 'Old Town': 1.15, 'Ukrainian Village': 1.05, 'Chinatown': 0.78, 'Beverly': 0.82, 'Portage Park': 0.75, 'Rogers Park': 0.78
            },
            'Miami': {
                'South Beach': 1.30, 'Brickell': 1.25, 'Wynwood': 1.10,
                'Coconut Grove': 1.15, 'Coral Gables': 1.20, 'Downtown Miami': 1.08,
                'Little Havana': 0.78, 'North Miami': 0.82, 'Hialeah': 0.72,
                'Miami Beach': 1.22, 'Doral': 0.88, 'Kendall': 0.80,
                'Edgewater': 1.1, 'Midtown': 1.12, 'Design District': 1.18, 'Key Biscayne': 1.35, 'Aventura': 1.08, 'Sunny Isles': 1.15, 'Pinecrest': 1.12, 'Westchester': 0.78, 'Surfside': 1.18, 'Bal Harbour': 1.32, 'Homestead': 0.68, 'Overtown': 0.7
            },
            'Austin': {
                'Downtown': 1.25, 'South Congress (SoCo)': 1.18, 'East Austin': 1.05,
                'West Lake Hills': 1.30, 'Hyde Park': 1.08, 'Mueller': 1.02,
                'North Loop': 0.95, 'Round Rock': 0.80, 'Cedar Park': 0.78,
                'Pflugerville': 0.75, 'South Lamar': 1.10,
                'Zilker': 1.22, 'Barton Hills': 1.18, 'Clarksville': 1.25, 'Bouldin Creek': 1.15, 'Travis Heights': 1.12, 'Crestview': 0.95, 'Holly': 1.08, 'Allandale': 0.98, 'Windsor Park': 0.82, 'Riverside': 0.88, 'Govalle': 0.78, 'St. Elmo': 0.85
            },
            'Seattle': {
                'Capitol Hill': 1.12, 'Downtown': 1.18, 'Queen Anne': 1.10,
                'Ballard': 1.05, 'Fremont': 1.08, 'University District': 0.88,
                'Beacon Hill': 0.85, 'West Seattle': 0.92, 'Columbia City': 0.90,
                'Bellevue': 1.15, 'Redmond': 1.05, 'Kirkland': 1.02,
                'South Lake Union': 1.15, 'Georgetown': 0.82, 'Madrona': 1.1, 'Wallingford': 1.05, 'Ravenna': 0.98, 'Magnolia': 1.08, 'Central District': 0.92, 'Rainier Valley': 0.78, 'Green Lake': 1.05, 'Northgate': 0.82, 'Pioneer Square': 0.95, 'Mercer Island': 1.25
            },
            'Denver': {
                'LoDo (Lower Downtown)': 1.22, 'Cherry Creek': 1.28, 'Capitol Hill': 1.10,
                'RiNo (River North)': 1.15, 'Highlands': 1.12, 'Washington Park': 1.08,
                'Baker': 1.02, 'Park Hill': 0.90, 'Montbello': 0.72,
                'Aurora': 0.78, 'Lakewood': 0.85, 'Englewood': 0.82,
                'Five Points': 0.95, 'Sloan Lake': 1.08, 'Congress Park': 1.05, 'Platt Park': 1.02, 'Hilltop': 1.15, 'City Park': 1.0, 'Globeville': 0.72, 'Stapleton (Central Park)': 0.92, 'Green Valley Ranch': 0.75, 'Federal Heights': 0.7, 'Wheat Ridge': 0.8, 'Arvada': 0.82
            },
            'Boston': {
                'Back Bay': 1.30, 'Beacon Hill': 1.28, 'South End': 1.18,
                'North End': 1.12, 'Seaport': 1.25, 'Cambridge (Harvard Sq)': 1.15,
                'Cambridge (Kendall Sq)': 1.20, 'Somerville': 0.95, 'Jamaica Plain': 0.90,
                'Dorchester': 0.78, 'Allston/Brighton': 0.85, 'Brookline': 1.10,
                'Fenway-Kenmore': 1.12, 'Charlestown': 1.05, 'South Boston (Southie)': 1.08, 'East Boston': 0.82, 'Roxbury': 0.72, 'Medford': 0.85, 'Newton': 1.1, 'Watertown': 0.88, 'Waltham': 0.82, 'Malden': 0.78, 'Quincy': 0.8, 'Revere': 0.75
            },
            'Washington DC': {
                'Georgetown': 1.30, 'Dupont Circle': 1.20, 'Capitol Hill': 1.15,
                'Adams Morgan': 1.05, 'Logan Circle': 1.18, 'Navy Yard': 1.10,
                'Columbia Heights': 0.92, 'Foggy Bottom': 1.22, 'U Street': 1.08,
                'Anacostia': 0.72, 'Arlington (VA)': 1.05, 'Bethesda (MD)': 1.12,
                'Shaw': 1.08, 'Woodley Park': 1.15, 'Cleveland Park': 1.12, 'Tenleytown': 1.05, 'Petworth': 0.9, 'Brookland': 0.88, 'Chevy Chase (DC)': 1.18, 'Takoma Park (MD)': 0.85, 'Silver Spring (MD)': 0.88, 'Pentagon City (VA)': 1.02, 'Rosslyn (VA)': 1.08, 'Alexandria (VA)': 1.05
            },
            'Houston': {
                'River Oaks': 1.35, 'The Heights': 1.15, 'Montrose': 1.12,
                'Downtown': 1.18, 'Midtown': 1.10, 'Museum District': 1.08,
                'Upper Kirby': 1.05, 'EaDo': 0.95, 'Katy': 0.82,
                'Sugar Land': 0.85, 'Spring': 0.78, 'Pearland': 0.80,
                'West University Place': 1.22, 'Bellaire': 1.08, 'Memorial': 1.18, 'Tanglewood': 1.25, 'Rice Village': 1.1, 'Galleria': 1.15, 'Clear Lake': 0.85, 'Cypress': 0.78, 'Kingwood': 0.82, 'The Woodlands': 0.92, 'Pasadena (TX)': 0.72, 'Friendswood': 0.82
            },
            'Toronto': {
                'Yorkville': 1.30, 'King West': 1.22, 'Liberty Village': 1.10,
                'Queen West': 1.08, 'The Annex': 1.12, 'Leslieville': 0.95,
                'Kensington Market': 0.92, 'Etobicoke': 0.80, 'Scarborough': 0.75,
                'North York': 0.85, 'Downtown Core': 1.18, 'Danforth': 0.90,
                'Distillery District': 1.15, 'Cabbagetown': 1.05, 'Roncesvalles': 1.02, 'High Park': 1.08, 'Midtown': 1.12, 'Bloor West Village': 0.95, 'Riverdale': 0.98, 'Parkdale': 0.82, 'Mimico': 0.78, 'Don Mills': 0.85, 'Forest Hill': 1.28, 'Yorkdale': 0.88
            },
            'Vancouver': {
                'Yaletown': 1.25, 'Kitsilano': 1.15, 'Gastown': 1.12,
                'West End': 1.10, 'Commercial Drive': 0.95, 'Mount Pleasant': 1.05,
                'East Van': 0.88, 'Burnaby': 0.82, 'Richmond': 0.85,
                'North Vancouver': 0.92, 'West Vancouver': 1.30, 'Surrey': 0.72,
                'Coal Harbour': 1.22, 'False Creek': 1.12, 'Kerrisdale': 1.08, 'Dunbar': 1.05, 'Marpole': 0.85, 'Hastings-Sunrise': 0.8, 'Main Street': 0.98, 'Point Grey': 1.15, 'Collingwood': 0.78, 'New Westminster': 0.75, 'Coquitlam': 0.78, 'Port Moody': 0.8
            },
            'Montreal': {
                'Plateau Mont-Royal': 1.18, 'Old Montreal': 1.22, 'Griffintown': 1.15,
                'Mile End': 1.08, 'Outremont': 1.20, 'Westmount': 1.30,
                'Villeray': 0.92, 'Rosemont': 0.95, 'Verdun': 0.88,
                'NDG (Notre-Dame-de-Grâce)': 0.90, 'Hochelaga': 0.78, 'Laval': 0.75,
                'Saint-Henri': 0.92, 'Ahuntsic': 0.85, 'Côte-des-Neiges': 0.82, 'Pointe-Saint-Charles': 0.88, 'Petite-Italie': 1.05, 'Mercier': 0.78, 'Lachine': 0.75, 'Saint-Laurent': 0.8, 'Dorval': 0.82, 'Brossard': 0.78, 'Longueuil': 0.72, 'Anjou': 0.75
            },
            'Mexico City': {
                'Polanco': 1.35, 'Condesa': 1.22, 'Roma Norte': 1.18,
                'Santa Fe': 1.15, 'Coyoacán': 1.02, 'Del Valle': 0.95,
                'Narvarte': 0.88, 'Tlalpan': 0.78, 'Iztapalapa': 0.65,
                'Centro Histórico': 0.90, 'San Ángel': 1.10,
                'Lomas de Chapultepec': 1.3, 'Juárez': 1.12, 'Anzures': 1.08, 'Pedregal': 1.22, 'Xochimilco': 0.72, 'Reforma': 1.15, 'Escandón': 0.95, 'Doctores': 0.78, 'Portales': 0.82, 'Cuauhtémoc': 0.9, 'Mixcoac': 0.85, 'Lindavista': 0.82, 'Insurgentes Sur': 1.05, 'Satélite': 0.8
            },
            'Cancún': {
                'Zona Hotelera': 1.35, 'Puerto Cancún': 1.28, 'Centro': 0.85,
                'SM 17 (Downtown)': 0.82, 'Alfredo V. Bonfil': 0.72, 'Playa Mujeres': 1.22,
                'Puerto Juárez': 0.90, 'Isla Mujeres': 1.15,
                'Punta Sam': 1.08, 'El Table': 0.78, 'Residencial Campestre': 0.82, 'Supermanzana 500': 0.7, 'Lagos del Sol': 0.88, 'Jardines del Sur': 0.75, 'Malecón Américas': 0.92
            },
            'Panama City': {
                'Punta Pacífica': 1.30, 'Costa del Este': 1.25, 'Casco Viejo': 1.12,
                'Obarrio': 1.10, 'El Cangrejo': 1.02, 'San Francisco': 1.08,
                'Calidonia': 0.78, 'Juan Díaz': 0.72, 'Clayton': 1.05,
                'Balboa': 0.92,
                'Marbella': 1.15, 'Bella Vista': 1.08, 'Condado del Rey': 0.85, 'Albrook': 0.88, 'Betania': 0.75, 'Transistmica': 0.72, 'San Miguelito': 0.68, 'Coco del Mar': 1.1, 'Vista Hermosa': 0.92
            },

            // ===== EUROPE - WESTERN =====
            'London': {
                'Mayfair': 1.45, 'Chelsea': 1.38, 'Kensington': 1.35,
                'Notting Hill': 1.28, 'Soho': 1.22, 'Shoreditch': 1.10,
                'Camden': 1.05, 'Islington': 1.12, 'Brixton': 0.88,
                'Hackney': 0.92, 'Peckham': 0.82, 'Canary Wharf': 1.15,
                'Greenwich': 0.90, 'Clapham': 0.95, 'Stratford': 0.78,
                'Marylebone': 1.32, 'Hampstead': 1.30,
                'Battersea': 1.05, 'Fulham': 1.1, 'Wimbledon': 1.02, 'Ealing': 0.85, 'Dalston': 0.95, 'Tooting': 0.82, 'Walthamstow': 0.8, 'Richmond': 1.18, 'Putney': 1.05, 'Chiswick': 1.1, 'Balham': 0.98, 'Lewisham': 0.78, 'Croydon': 0.72, 'Barking': 0.68, 'Angel (Islington)': 1.12, 'Vauxhall': 1.05, 'Bermondsey': 1.0, 'Kentish Town': 0.95
            },
            'Paris': {
                'Le Marais (3rd/4th)': 1.30, 'Saint-Germain (6th)': 1.35, 'Champs-Élysées (8th)': 1.40,
                'Montmartre (18th)': 0.92, 'Bastille (11th)': 1.05, 'Oberkampf (11th)': 1.02,
                'Belleville (20th)': 0.82, 'La Défense': 1.10, 'Pigalle (9th)': 0.95,
                'Nation (12th)': 0.88, 'Batignolles (17th)': 0.98, 'Boulogne-Billancourt': 1.08,
                'Latin Quarter (5th)': 1.25, 'Tour Eiffel (7th)': 1.38, 'Opéra (9th)': 1.15, 'République (10th)': 1.0, 'Bercy (12th)': 0.95, 'Alésia (14th)': 0.92, 'Vaugirard (15th)': 0.9, 'Passy (16th)': 1.3, 'Buttes-Chaumont (19th)': 0.85, 'Neuilly-sur-Seine': 1.25, 'Saint-Denis': 0.7, 'Vincennes': 0.95, 'Levallois-Perret': 1.1, 'Issy-les-Moulineaux': 1.02
            },
            'Amsterdam': {
                'Canal Ring (Centrum)': 1.30, 'Jordaan': 1.25, 'De Pijp': 1.10,
                'Oud-West': 1.15, 'Oud-Zuid': 1.28, 'Oost': 0.95,
                'Noord': 0.82, 'Nieuw-West': 0.75, 'Amstelveen': 0.88,
                'Zuidas': 1.20, 'Westerpark': 1.05,
                'Rivierenbuurt': 1.05, 'Buitenveldert': 0.92, 'Java-eiland': 1.08, 'IJburg': 0.88, 'Diemen': 0.78, 'Haarlem': 0.82, 'Watergraafsmeer': 0.98, 'Slotervaart': 0.72, 'Geuzenveld': 0.7
            },
            'Berlin': {
                'Mitte': 1.22, 'Prenzlauer Berg': 1.12, 'Kreuzberg': 1.08,
                'Friedrichshain': 1.02, 'Charlottenburg': 1.15, 'Neukölln': 0.85,
                'Schöneberg': 1.05, 'Wedding': 0.78, 'Tempelhof': 0.82,
                'Spandau': 0.72, 'Steglitz': 0.88, 'Grunewald': 1.30,
                'Lichtenberg': 0.75, 'Pankow': 0.85, 'Treptow': 0.82, 'Reinickendorf': 0.72, 'Moabit': 0.92, 'Köpenick': 0.78, 'Wilmersdorf': 1.1, 'Dahlem': 1.22, 'Zehlendorf': 1.05, 'Britz': 0.72, 'Rudow': 0.7, 'Friedenau': 0.98
            },
            'Munich': {
                'Altstadt-Lehel': 1.35, 'Maxvorstadt': 1.18, 'Schwabing': 1.22,
                'Bogenhausen': 1.15, 'Haidhausen': 1.10, 'Glockenbachviertel': 1.20,
                'Sendling': 0.92, 'Moosach': 0.82, 'Pasing': 0.85,
                'Neuhausen': 1.05, 'Berg am Laim': 0.88,
                'Schwabing-West': 1.18, 'Au': 1.08, 'Solln': 1.02, 'Trudering': 0.88, 'Milbertshofen': 0.82, 'Laim': 0.9, 'Riem': 0.85, 'Unterföhring': 0.95, 'Thalkirchen': 1.0
            },
            'Dublin': {
                'Dublin 2 (City Centre)': 1.25, 'Dublin 4 (Ballsbridge)': 1.30,
                'Dublin 6 (Ranelagh)': 1.15, 'Dublin 8 (Portobello)': 1.08,
                'Dún Laoghaire': 1.10, 'Rathmines': 1.05, 'Drumcondra': 0.92,
                'Tallaght': 0.75, 'Clontarf': 1.02, 'Howth': 1.12,
                'Dublin 1 (North City)': 1.08, 'Dublin 7 (Phibsborough)': 0.98, 'Dublin 3 (Clontarf)': 1.05, 'Dublin 9 (Griffith Avenue)': 0.95, 'Blackrock': 1.15, 'Stillorgan': 1.02, 'Sandyford': 0.9, 'Swords': 0.78, 'Lucan': 0.75
            },
            'Brussels': {
                'Ixelles': 1.18, 'Saint-Gilles': 1.05, 'Uccle': 1.22,
                'Sablon': 1.28, 'Etterbeek': 1.02, 'Schaerbeek': 0.85,
                'Molenbeek': 0.72, 'Woluwe-Saint-Pierre': 1.12, 'Forest': 0.88,
                'EU Quarter': 1.15, 'Auderghem': 0.95,
                'Avenue Louise': 1.2, 'Montgomery': 1.02, 'Flagey': 1.08, 'Place du Châtelain': 1.12, 'Jette': 0.8, 'Anderlecht': 0.72, 'Stockel': 1.05, 'Watermael-Boitsfort': 0.98, 'Evere': 0.82
            },
            'Luxembourg City': {
                'Ville Haute': 1.30, 'Kirchberg': 1.22, 'Belair': 1.18,
                'Limpertsberg': 1.15, 'Grund': 1.08, 'Bonnevoie': 0.88,
                'Gasperich': 1.05, 'Eich': 0.92, 'Hollerich': 0.85,
                'Cessange': 0.90,
                'Clausen': 1.02, 'Merl': 0.95, 'Pfaffenthal': 0.98, 'Neudorf': 0.88, 'Hamm': 0.82, 'Bertrange': 0.92, 'Strassen': 0.9
            },
            'Zurich': {
                'Bahnhofstrasse': 1.35, 'Seefeld': 1.25, 'Enge': 1.18,
                'Niederdorf': 1.15, 'Wiedikon': 1.02, 'Oerlikon': 0.88,
                'Altstetten': 0.82, 'Hottingen': 1.12, 'Wipkingen': 0.95,
                'Schwamendingen': 0.78,
                'Seebach': 0.8, 'Witikon': 1.05, 'Höngg': 0.92, 'Fluntern': 1.1, 'Leimbach': 0.82, 'Affoltern': 0.75, 'Wollishofen': 1.0, 'Unterstrass': 0.98
            },
            'Geneva': {
                'Eaux-Vives': 1.20, 'Champel': 1.25, 'Carouge': 1.05,
                'Plainpalais': 1.10, 'Pâquis': 0.92, 'Nations': 1.15,
                'Servette': 0.88, 'Meyrin': 0.78, 'Vernier': 0.75,
                'Cologny': 1.35,
                'Florissant': 1.18, 'Grand-Saconnex': 0.95, 'Lancy': 0.82, 'Onex': 0.72, 'Thônex': 0.85, 'Chêne-Bourg': 0.8, 'Bernex': 0.78, 'Plan-les-Ouates': 0.88
            },
            'Edinburgh': {
                'New Town': 1.25, 'Old Town': 1.18, 'Stockbridge': 1.15,
                'Morningside': 1.10, 'Marchmont': 1.02, 'Leith': 0.90,
                'Portobello': 0.88, 'Bruntsfield': 1.08, 'Gorgie': 0.78,
                'Corstorphine': 0.82,
                'Haymarket': 1.05, 'Dean Village': 1.15, 'Comely Bank': 1.02, 'Cramond': 0.92, 'Dalry': 0.85, 'Tollcross': 0.95, 'Murrayfield': 1.08, 'Newington': 0.9
            },
            'Nice': {
                'Promenade des Anglais': 1.30, 'Old Nice (Vieux Nice)': 1.18, 'Cimiez': 1.15,
                'Port': 1.05, 'Libération': 0.90, 'Riquier': 0.85,
                'Saint-Roch': 0.82, "L'Ariane": 0.70, 'Fabron': 0.95,
                'Mont Boron': 1.22,
                'Magnan': 0.88, 'Musiciens': 1.1, 'Carabacel': 0.82, 'Pasteur': 0.78, 'Gambetta': 0.85, 'Las Planas': 0.72, 'Saint-Isidore': 0.75, 'Caucade': 0.8
            },

            // ===== EUROPE - SOUTHERN =====
            'Madrid': {
                'Salamanca': 1.30, 'Chamberí': 1.18, 'Malasaña': 1.10,
                'Chueca': 1.12, 'La Latina': 1.05, 'Lavapiés': 0.90,
                'Retiro': 1.15, 'Chamartín': 1.08, 'Vallecas': 0.72,
                'Tetuán': 0.82, 'Moncloa': 1.02,
                'Barrio de las Letras': 1.15, 'Arganzuela': 0.95, 'Hortaleza': 0.85, 'Usera': 0.72, 'Carabanchel': 0.7, 'Moncloa-Aravaca': 1.08, 'Barajas': 0.8, 'Fuencarral': 0.88, 'Atocha': 1.0, 'Prosperidad': 0.92, 'Conde de Casal': 0.88, 'Arturo Soria': 0.95
            },
            'Barcelona': {
                'Eixample': 1.15, 'Gràcia': 1.08, 'Born / El Born': 1.20,
                'Gothic Quarter': 1.18, 'Barceloneta': 1.10, 'Poblenou': 1.02,
                'Raval': 0.88, 'Sants': 0.85, 'Sant Andreu': 0.78,
                'Sarrià-Sant Gervasi': 1.25, 'Horta-Guinardó': 0.80,
                'Pedralbes': 1.3, 'Les Corts': 1.05, 'Sant Martí': 0.82, 'El Clot': 0.8, 'Diagonal Mar': 1.08, 'Vila de Gràcia': 1.1, 'La Sagrada Família': 1.05, 'Sant Antoni': 1.02, 'Poble Sec': 0.92, 'Camp Nou': 0.9, 'Nou Barris': 0.72, 'Vallcarca': 0.85
            },
            'Valencia': {
                'El Carmen': 1.18, 'Ruzafa': 1.15, 'Eixample': 1.10,
                'Ciutat Vella': 1.12, 'El Cabanyal': 0.92, 'Benimaclet': 0.88,
                'Patraix': 0.82, 'Poblats Marítims': 0.85, 'Campanar': 0.90,
                'Quatre Carreres': 0.78,
                'La Seu': 1.08, 'Pla del Real': 1.05, 'Mestalla': 0.95, 'Algirós': 0.88, 'Jesús': 0.78, 'La Saïdia': 0.82, 'Olivereta': 0.75, 'Malvarrosa': 0.9
            },
            'Málaga': {
                'Centro Histórico': 1.22, 'Soho': 1.15, 'Pedregalejo': 1.10,
                'El Palo': 0.92, 'Huelin': 0.88, 'Teatinos': 0.85,
                'La Malagueta': 1.18, 'Puerto de la Torre': 0.75,
                'Churriana': 0.78, 'El Limonar': 1.12,
                'La Merced': 1.08, 'Carretera de Cádiz': 0.8, 'Ciudad Jardín': 0.92, 'Bailén-Miraflores': 0.78, 'Cruz de Humilladero': 0.82, 'Campanillas': 0.7, 'Rosaleda': 0.88, 'Victoria': 1.05
            },
            'Lisbon': {
                'Chiado': 1.28, 'Príncipe Real': 1.25, 'Alfama': 1.10,
                'Bairro Alto': 1.15, 'Estrela / Lapa': 1.12, 'Avenidas Novas': 1.05,
                'Alcântara': 0.95, 'Benfica': 0.82, 'Amadora': 0.72,
                'Parque das Nações': 1.08, 'Campo de Ourique': 1.02,
                'Santos': 1.08, 'Graça': 1.05, 'Anjos': 0.92, 'Penha de França': 0.85, 'Belém': 1.1, 'Lumiar': 0.88, 'Telheiras': 0.9, 'Marvila': 0.78, 'Olivais': 0.8
            },
            'Porto': {
                'Ribeira': 1.22, 'Foz do Douro': 1.25, 'Cedofeita': 1.10,
                'Boavista': 1.15, 'Bonfim': 0.95, 'Campanhã': 0.78,
                'Paranhos': 0.85, 'Ramalde': 0.82, 'Matosinhos': 0.90,
                'Vila Nova de Gaia': 0.88,
                'Clérigos': 1.15, 'Miragaia': 1.05, 'Lordelo do Ouro': 0.92, 'Aldoar': 0.82, 'Massarelos': 1.02, 'São Bento': 1.1, 'Bonfim Sul': 0.88, 'Gondomar': 0.75
            },
            'Rome': {
                'Centro Storico': 1.30, 'Trastevere': 1.15, 'Prati': 1.18,
                'Testaccio': 1.05, 'Monti': 1.20, 'San Giovanni': 0.92,
                'EUR': 0.88, 'Pigneto': 0.85, 'Ostiense': 0.90,
                'Garbatella': 0.82, 'Flaminio': 1.08,
                'Aventino': 1.12, 'Coppedè': 1.15, 'Nomentano': 1.02, 'Balduina': 0.92, 'Trastevere Nord': 1.08, 'San Lorenzo': 0.85, 'Monteverde': 0.88, 'Tor Vergata': 0.72, 'Parioli': 1.22, 'Trieste': 1.05, 'Appio-Latino': 0.82
            },
            'Milan': {
                'Brera': 1.30, 'Navigli': 1.15, 'Porta Nuova': 1.25,
                'City Centre': 1.35, 'Isola': 1.10, 'Città Studi': 0.90,
                'Lambrate': 0.85, 'Bovisa': 0.78, 'San Siro': 0.88,
                'Porta Venezia': 1.12,
                'Tortona': 1.08, 'Loreto': 0.95, 'Garibaldi': 1.18, 'Porta Romana': 1.1, 'Cenisio': 0.92, 'Bicocca': 0.82, 'Corsica': 0.88, 'Porta Ticinese': 1.05, 'Sarpi': 0.95, 'Nolo': 0.85, 'QT8': 0.8
            },
            'Athens': {
                'Kolonaki': 1.30, 'Plaka': 1.18, 'Kifissia': 1.22,
                'Glyfada': 1.15, 'Pangrati': 1.02, 'Exarchia': 0.85,
                'Koukaki': 1.05, 'Nea Smyrni': 0.90, 'Piraeus': 0.78,
                'Marousi': 0.95, 'Psyrri': 1.08,
                'Vouliagmeni': 1.25, 'Monastiraki': 1.1, 'Thisio': 1.08, 'Ampelokipoi': 0.88, 'Patisia': 0.72, 'Zografou': 0.82, 'Halandri': 0.92, 'Filothei': 1.18, 'Peristeri': 0.75
            },
            'Split': {
                'Diocletian\'s Palace': 1.25, 'Bačvice': 1.15, 'Manuš': 1.05,
                'Žnjan': 1.10, 'Firule': 1.02, 'Spinut': 0.90,
                'Sućidar': 0.82, 'Trstenik': 0.88, 'Mertojak': 0.92,
                'Varoš': 1.0, 'Bol': 0.95, 'Gripe': 0.85, 'Lokve': 0.78, 'Kman': 0.8, 'Pazdigrad': 0.88, 'Brda': 0.82
            },

            // ===== EUROPE - NORTHERN =====
            'Stockholm': {
                'Östermalm': 1.32, 'Södermalm': 1.15, 'Kungsholmen': 1.10,
                'Vasastan': 1.12, 'Gamla Stan': 1.20, 'Djurgården': 1.18,
                'Hammarby Sjöstad': 1.05, 'Hägersten': 0.88, 'Farsta': 0.75,
                'Solna': 0.90, 'Nacka': 0.92, 'Lidingö': 1.08,
                'Norrmalm': 1.22, 'Bromma': 0.95, 'Enskede': 0.82, 'Skärholmen': 0.72, 'Bandhagen': 0.78, 'Liljeholmen': 1.02, 'Kista': 0.8, 'Sundbyberg': 0.88, 'Täby': 0.95, 'Danderyd': 1.15, 'Vallentuna': 0.72, 'Huddinge': 0.78
            },
            'Copenhagen': {
                'Indre By (City Centre)': 1.28, 'Frederiksberg': 1.18, 'Nørrebro': 1.02,
                'Vesterbro': 1.10, 'Østerbro': 1.15, 'Christianshavn': 1.12,
                'Amager': 0.90, 'Valby': 0.85, 'Brønshøj': 0.80,
                'Hellerup': 1.22, 'Nordvest': 0.78,
                'Sydhavnen': 0.92, 'Vanløse': 0.82, 'Gentofte': 1.18, 'Hvidovre': 0.78, 'Rødovre': 0.75, 'Islands Brygge': 1.08, 'Nørreport': 1.15, 'Carlsberg Byen': 1.05, 'Nordhavn': 1.12
            },
            'Helsinki': {
                'Kruununhaka': 1.25, 'Eira': 1.22, 'Punavuori': 1.15,
                'Kallio': 1.05, 'Töölö': 1.12, 'Ullanlinna': 1.18,
                'Vallila': 0.95, 'Sörnäinen': 0.88, 'Vuosaari': 0.75,
                'Espoo (Tapiola)': 0.92, 'Kontula': 0.72,
                'Lauttasaari': 1.08, 'Herttoniemi': 0.85, 'Munkkiniemi': 1.02, 'Pasila': 0.9, 'Malmi': 0.72, 'Kulosaari': 1.12, 'Arabianranta': 0.92, 'Jätkäsaari': 1.05, 'Katajanokka': 1.18
            },
            'Oslo': {
                'Frogner': 1.30, 'Majorstuen': 1.18, 'Grünerløkka': 1.12,
                'Aker Brygge': 1.25, 'Sentrum': 1.15, 'St. Hanshaugen': 1.08,
                'Tøyen': 0.88, 'Sagene': 1.02, 'Grønland': 0.82,
                'Stovner': 0.72, 'Bærum': 1.10,
                'Bygdøy': 1.22, 'Holmenkollen': 1.18, 'Nydalen': 1.02, 'Torshov': 1.05, 'Alna': 0.78, 'Nordstrand': 0.92, 'Lambertseter': 0.85, 'Ullern': 1.12, 'Manglerud': 0.8
            },
            'Vienna': {
                'Innere Stadt (1st)': 1.35, 'Josefstadt (8th)': 1.15, 'Neubau (7th)': 1.12,
                'Wieden (4th)': 1.18, 'Mariahilf (6th)': 1.08, 'Landstraße (3rd)': 1.05,
                'Leopoldstadt (2nd)': 0.95, 'Favoriten (10th)': 0.75, 'Ottakring (16th)': 0.82,
                'Döbling (19th)': 1.20, 'Hietzing (13th)': 1.10,
                'Alsergrund (9th)': 1.08, 'Margareten (5th)': 0.95, 'Brigittenau (20th)': 0.78, 'Floridsdorf (21st)': 0.72, 'Donaustadt (22nd)': 0.8, 'Liesing (23rd)': 0.82, 'Meidling (12th)': 0.85, 'Penzing (14th)': 0.88, 'Hernals (17th)': 0.82
            },

            // ===== EUROPE - EASTERN =====
            'Prague': {
                'Prague 1 (Old Town)': 1.30, 'Prague 2 (Vinohrady)': 1.18, 'Prague 3 (Žižkov)': 0.95,
                'Prague 5 (Smíchov)': 1.05, 'Prague 6 (Dejvice)': 1.12, 'Prague 7 (Holešovice)': 1.08,
                'Prague 4 (Nusle)': 0.88, 'Prague 8 (Karlín)': 1.02, 'Prague 9': 0.78,
                'Prague 10': 0.82,
                'Prague 11 (Chodov)': 0.78, 'Prague 12 (Modřany)': 0.75, 'Prague 13 (Stodůlky)': 0.72, 'Letná': 1.1, 'Anděl': 1.08, 'Vršovice': 0.9, 'Bubeneč': 1.12, 'Troja': 0.85
            },
            'Budapest': {
                'District V (Belváros)': 1.30, 'District VI (Terézváros)': 1.15, 'District VII (Jewish Quarter)': 1.12,
                'District I (Buda Castle)': 1.22, 'District II (Buda Hills)': 1.18, 'District IX (Ferencváros)': 1.02,
                'District XIII': 1.05, 'District XI (Újbuda)': 0.92, 'District VIII (Józsefváros)': 0.82,
                'District XIV (Zugló)': 0.85, 'District III (Óbuda)': 0.88,
                'District IV (Újpest)': 0.78, 'District X (Kőbánya)': 0.75, 'District XV (Rákospalota)': 0.72, 'District XII (Hegyvidék)': 1.15, 'District XVI (Árpádföld)': 0.8, 'Margaret Island': 1.1, 'Csepel': 0.68, 'Kelenföld': 0.85
            },
            'Warsaw': {
                'Śródmieście (Centre)': 1.25, 'Mokotów': 1.12, 'Żoliborz': 1.15,
                'Wilanów': 1.18, 'Wola': 1.05, 'Praga Północ': 0.88,
                'Ursynów': 0.85, 'Ochota': 0.95, 'Bielany': 0.82,
                'Bemowo': 0.78, 'Targówek': 0.72,
                'Kabaty': 0.88, 'Saska Kępa': 1.08, 'Stary Mokotów': 1.15, 'Muranów': 0.95, 'Natolin': 0.82, 'Służewiec': 0.92, 'Powsin': 0.78, 'Grochów': 0.75
            },
            'Krakow': {
                'Old Town (Stare Miasto)': 1.28, 'Kazimierz': 1.18, 'Podgórze': 1.05,
                'Krowodrza': 0.95, 'Dębniki': 0.90, 'Zabłocie': 1.08,
                'Nowa Huta': 0.72, 'Prądnik Biały': 0.82, 'Bronowice': 0.85,
                'Ruczaj': 0.88,
                'Salwator': 1.05, 'Zwierzyniec': 1.1, 'Łagiewniki': 0.82, 'Prądnik Czerwony': 0.8, 'Mistrzejowice': 0.72, 'Kurdwanów': 0.75, 'Bieżanów': 0.7, 'Czyżyny': 0.85
            },
            'Bucharest': {
                'Dorobanți': 1.28, 'Primăverii': 1.25, 'Floreasca': 1.18,
                'Herăstrău': 1.22, 'Cotroceni': 1.10, 'Aviatorilor': 1.15,
                'Pipera': 1.02, 'Militari': 0.75, 'Rahova': 0.70,
                'Tineretului': 0.88, 'Berceni': 0.78,
                'Unirii': 1.05, 'Titan': 0.82, 'Drumul Taberei': 0.78, 'Băneasa': 1.12, 'Colentina': 0.72, 'Pantelimon': 0.68, 'Victoriei': 1.08, 'Giurgiului': 0.65
            },
            'Tallinn': {
                'Old Town (Vanalinn)': 1.28, 'Kalamaja': 1.15, 'Kadriorg': 1.18,
                'Pirita': 1.10, 'Telliskivi': 1.12, 'Rotermanni': 1.08,
                'Kristiine': 0.92, 'Mustamäe': 0.82, 'Lasnamäe': 0.72,
                'Nõmme': 0.88,
                'Pelgulinn': 0.85, 'Kopli': 0.78, 'Tondi': 0.82, 'Viimsi': 0.92, 'Haabersti': 0.8, 'Õismäe': 0.75, 'Ülemiste': 0.88
            },
            'Riga': {
                'Old Riga (Vecrīga)': 1.25, 'Quiet Centre': 1.18, 'Āgenskalns': 1.05,
                'Mežaparks': 1.10, 'Grīziņkalns': 0.92, 'Teika': 0.95,
                'Purvciems': 0.78, 'Imanta': 0.75, 'Ziepniekkalns': 0.72,
                'Torņakalns': 0.88,
                'Sarkandaugava': 0.8, 'Jugla': 0.72, 'Ķengarags': 0.7, 'Dreiliņi': 0.68, 'Čiekurkalns': 0.82, 'Berģi': 0.75, 'Iļguciems': 0.78
            },
            'Istanbul': {
                'Beşiktaş': 1.28, 'Nişantaşı': 1.35, 'Kadıköy': 1.15,
                'Bebek': 1.30, 'Cihangir': 1.18, 'Karaköy': 1.12,
                'Şişli': 1.05, 'Üsküdar': 0.92, 'Bakırköy': 0.88,
                'Fatih': 0.82, 'Beyoğlu': 1.08, 'Esenyurt': 0.65,
                'Sarıyer': 1.12, 'Ataşehir': 1.05, 'Maltepe': 0.88, 'Pendik': 0.75, 'Levent': 1.22, 'Etiler': 1.25, 'Bağcılar': 0.68, 'Beykoz': 0.92, 'Çekmeköy': 0.78, 'Zeytinburnu': 0.8, 'Küçükçekmece': 0.72, 'Kartal': 0.82
            },

            // ===== ASIA - EAST =====
            'Tokyo': {
                'Minato (Roppongi)': 1.30, 'Shibuya': 1.25, 'Shinjuku': 1.18,
                'Chiyoda (Marunouchi)': 1.35, 'Meguro': 1.15, 'Setagaya': 1.08,
                'Nakano': 0.92, 'Suginami': 0.88, 'Koto (Toyosu)': 1.05,
                'Adachi': 0.75, 'Edogawa': 0.78, 'Bunkyo': 1.10,
                'Daikanyama': 1.28, 'Ebisu': 1.22, 'Ikebukuro': 1.08, 'Asakusa': 0.92, 'Akihabara': 1.0, 'Nerima': 0.82, 'Katsushika': 0.72, 'Toshima': 0.95, 'Shinagawa': 1.12, 'Kichijoji (Musashino)': 0.98, 'Chofu': 0.85, 'Machida': 0.78, 'Ota': 0.88, 'Arakawa': 0.82, 'Sumida': 0.9, 'Taito': 0.95, 'Itabashi': 0.8, 'Azabu': 1.35
            },
            'Osaka': {
                'Kita (Umeda)': 1.22, 'Chuo (Namba)': 1.18, 'Tennoji': 1.08,
                'Fukushima': 1.10, 'Nishi': 1.05, 'Shinmachi': 1.02,
                'Sumiyoshi': 0.88, 'Higashiyodogawa': 0.82, 'Ikuno': 0.78,
                'Sakai': 0.75,
                'Shinsaibashi': 1.15, 'Tsurumi': 0.8, 'Abeno': 1.02, 'Minoh': 0.85, 'Toyonaka': 0.9, 'Ibaraki': 0.82, 'Nishinari': 0.68, 'Yodogawa': 0.85, 'Joto': 0.78, 'Miyakojima': 0.92
            },
            'Fukuoka': {
                'Tenjin': 1.20, 'Hakata': 1.15, 'Daimyo': 1.12,
                'Yakuin': 1.08, 'Ohori': 1.10, 'Nishijin': 0.92,
                'Hakozaki': 0.85, 'Kashii': 0.80, 'Noke': 0.78,
                'Momochi': 1.05,
                'Imaizumi': 1.1, 'Ropponmatsu': 1.05, 'Meinohama': 0.82, 'Chihaya': 0.78, 'Nishijin Area': 0.88, 'Muromi': 0.85, 'Zasshonokuma': 0.75, 'Takamiya': 0.82
            },
            'Seoul': {
                'Gangnam': 1.30, 'Itaewon': 1.15, 'Myeongdong': 1.20,
                'Hongdae': 1.08, 'Bukchon': 1.18, 'Yeouido': 1.12,
                'Sinchon': 0.92, 'Gwangjin': 0.88, 'Nowon': 0.75,
                'Mapo': 1.02,
                'Seocho': 1.25, 'Jongno': 1.15, 'Jung-gu': 1.12, 'Songpa': 1.1, 'Yongsan': 1.08, 'Seodaemun': 0.92, 'Dongjak': 0.95, 'Eunpyeong': 0.8, 'Geumcheon': 0.72, 'Dobong': 0.75, 'Gangdong': 0.88, 'Yangcheon': 0.85
            },
            'Hong Kong': {
                'Central': 1.40, 'The Peak': 1.50, 'Mid-Levels': 1.30,
                'Causeway Bay': 1.25, 'Tsim Sha Tsui': 1.15, 'Wan Chai': 1.18,
                'Mong Kok': 0.92, 'Sham Shui Po': 0.78, 'Tai Po': 0.72,
                'Sai Kung': 0.85, 'Discovery Bay': 1.10,
                'Repulse Bay': 1.3, 'Aberdeen': 0.92, 'Happy Valley': 1.22, 'Tseung Kwan O': 0.8, 'Sha Tin': 0.78, 'Tuen Mun': 0.68, 'Yuen Long': 0.65, 'Kennedy Town': 1.05, 'North Point': 1.0, 'Quarry Bay': 0.98, 'Hung Hom': 0.88
            },
            'Taipei': {
                'Da\'an': 1.25, 'Xinyi': 1.30, 'Zhongshan': 1.12,
                'Songshan': 1.08, 'Zhongzheng': 1.10, 'Shilin': 0.92,
                'Beitou': 0.88, 'Neihu': 1.02, 'Wanhua': 0.82,
                'Banqiao (New Taipei)': 0.78,
                'Wenshan': 0.85, 'Nangang': 0.9, 'Datong': 0.8, 'Tamsui': 0.72, 'Xindian (New Taipei)': 0.78, 'Yonghe (New Taipei)': 0.82, 'Zhonghe (New Taipei)': 0.78, 'Linkou (New Taipei)': 0.72, 'Tianmu': 1.05, 'Donghu': 0.95
            },
            'Shanghai': {
                'Jing\'an': 1.30, 'Xuhui (French Concession)': 1.28, 'Lujiazui (Pudong)': 1.25,
                'Huangpu (The Bund)': 1.22, 'Changning': 1.10, 'Hongkou': 0.92,
                'Yangpu': 0.88, 'Minhang': 0.82, 'Baoshan': 0.75,
                'Putuo': 0.90,
                'Xintiandi': 1.25, 'Pudong (Century Park)': 1.15, 'Gubei': 1.12, 'Qingpu': 0.72, 'Songjiang': 0.7, 'Jiading': 0.68, 'Zhabei': 0.88, 'Pudong (Jinqiao)': 1.05, 'Luwan': 1.18, 'Fengxian': 0.65, 'Chuansha': 0.72, 'Zhangjiang': 1.02
            },
            'Beijing': {
                'Chaoyang (CBD)': 1.28, 'Dongcheng': 1.22, 'Xicheng': 1.18,
                'Haidian (Zhongguancun)': 1.15, 'Shunyi': 1.08, 'Chaoyang (Sanlitun)': 1.25,
                'Fengtai': 0.82, 'Tongzhou': 0.75, 'Daxing': 0.72,
                'Changping': 0.78,
                'Wangjing': 1.08, 'Yizhuang': 0.82, 'Shijingshan': 0.85, 'Dongzhimen': 1.15, 'Guomao': 1.22, 'Wudaokou': 1.05, 'Xidan': 1.12, 'Wangfujing': 1.18, 'Lido': 1.05, 'Yansha': 1.1, 'Zhongguancun South': 1.08, 'Mentougou': 0.68
            },
            'Shenzhen': {
                'Nanshan (Shekou)': 1.25, 'Futian (CBD)': 1.22, 'Luohu': 1.05,
                'Nanshan (Tech Park)': 1.18, 'Bao\'an': 0.82, 'Longhua': 0.78,
                'Longgang': 0.72, 'Yantian': 0.85, 'Guangming': 0.75,
                'Qianhai': 1.12,
                'Houhai': 1.2, 'Chegongmiao': 1.08, 'Shuiwei': 1.02, 'Sungang': 0.9, 'Buji': 0.75, 'Xili': 0.88, 'Shahe': 0.82, 'Dalang': 0.7, 'Pingshan': 0.68
            },
            'Guangzhou': {
                'Tianhe': 1.22, 'Yuexiu': 1.10, 'Haizhu': 1.02,
                'Liwan': 0.92, 'Panyu': 0.82, 'Baiyun': 0.78,
                'Huangpu': 1.05, 'Nansha': 0.75, 'Zhujiang New Town': 1.18,
                'Huadu': 0.72,
                'Dongshan': 1.08, 'Jiangnan Xi': 0.95, 'Wuyang': 1.02, 'Zhujiang New Town East': 1.12, 'Dongpu': 0.8, 'Fangcun': 0.78, 'Luogang': 0.72, 'Conghua': 0.65, 'Zengcheng': 0.68
            },

            // ===== ASIA - SOUTHEAST =====
            'Singapore': {
                'Orchard Road': 1.30, 'Marina Bay': 1.35, 'Raffles Place': 1.25,
                'Holland Village': 1.12, 'Tiong Bahru': 1.10, 'Tanjong Pagar': 1.15,
                'Bukit Timah': 1.18, 'Clementi': 0.88, 'Woodlands': 0.75,
                'Tampines': 0.78, 'Jurong East': 0.80, 'Sentosa': 1.40,
                'Toa Payoh': 0.82, 'Ang Mo Kio': 0.78, 'Bishan': 0.85, 'Queenstown': 0.88, 'Novena': 1.05, 'Bedok': 0.78, 'Punggol': 0.72, 'Sengkang': 0.72, 'Pasir Ris': 0.75, 'Serangoon': 0.85, 'Katong': 1.02, 'Dempsey Hill': 1.22
            },
            'Bangkok': {
                'Sukhumvit (Asoke)': 1.25, 'Silom / Sathorn': 1.22, 'Siam': 1.18,
                'Thonglor': 1.28, 'Ekkamai': 1.15, 'Ari': 1.10,
                'Khao San': 0.85, 'On Nut': 0.88, 'Phra Khanong': 0.92,
                'Bang Na': 0.78, 'Chatuchak': 0.90, 'Ladprao': 0.82,
                'Ratchadaphisek': 1.02, 'Phrom Phong': 1.18, 'Sathorn': 1.15, 'Pratunam': 0.95, 'Saphan Kwai': 0.88, 'Rama 9': 1.02, 'Bangrak': 0.92, 'Thong Lo Soi': 1.22, 'Udom Suk': 0.8, 'Bearing': 0.75, 'Pinklao': 0.82, 'Bangsue': 0.85
            },
            'Chiang Mai': {
                'Old City': 1.15, 'Nimmanhaemin': 1.22, 'Santitham': 1.05,
                'Chang Khlan (Night Bazaar)': 1.08, 'Hang Dong': 0.82, 'San Sai': 0.78,
                'Mae Rim': 0.85, 'Suthep': 1.02, 'Wualai': 0.92,
                'San Kamphaeng': 0.75,
                'Tha Phae': 1.1, 'Night Bazaar East': 1.02, 'Wat Ket': 0.88, 'Chang Phueak': 0.95, 'Ban Waen': 0.72, 'Mae Hia': 0.75, 'Pa Tan': 0.82, 'Don Kaeo': 0.78
            },
            'Phuket': {
                'Patong': 1.22, 'Kata': 1.12, 'Karon': 1.08,
                'Kamala': 1.15, 'Surin': 1.20, 'Bang Tao': 1.18,
                'Phuket Town': 0.85, 'Rawai': 0.92, 'Chalong': 0.88,
                'Cherng Talay': 1.05,
                'Mai Khao': 1.1, 'Nai Harn': 1.05, 'Kata Noi': 1.15, 'Ao Po': 0.85, 'Thalang': 0.78, 'Kathu': 0.82, 'Wichit': 0.8, 'Koh Kaew': 0.88
            },
            'Kuala Lumpur': {
                'KLCC': 1.30, 'Bukit Bintang': 1.22, 'Bangsar': 1.18,
                'Mont Kiara': 1.15, 'Damansara Heights': 1.20, 'Sri Hartamas': 1.08,
                'Petaling Jaya': 0.90, 'Cheras': 0.78, 'Sentul': 0.82,
                'Kepong': 0.75, 'Desa ParkCity': 1.10,
                'Bukit Jalil': 0.92, 'Taman Tun Dr Ismail': 1.08, 'Ampang': 0.85, 'Setapak': 0.72, 'Wangsa Maju': 0.78, 'Brickfields': 0.88, 'Mid Valley': 1.05, 'Kuchai Lama': 0.8, 'Old Klang Road': 0.82
            },
            'Ho Chi Minh City': {
                'District 1': 1.30, 'District 2 (Thao Dien)': 1.22, 'District 3': 1.15,
                'District 7 (Phu My Hung)': 1.12, 'Binh Thanh': 1.02, 'District 4': 0.90,
                'Go Vap': 0.82, 'Tan Binh': 0.85, 'Thu Duc': 0.88,
                'Binh Tan': 0.72,
                'District 5 (Chinatown)': 0.85, 'District 6': 0.78, 'District 8': 0.72, 'District 10': 0.88, 'District 11': 0.82, 'Phu Nhuan': 0.95, 'Tan Phu': 0.78, 'District 9': 0.8, 'Nha Be': 0.72
            },
            'Hanoi': {
                'Hoan Kiem (Old Quarter)': 1.25, 'Ba Dinh': 1.18, 'Tay Ho (West Lake)': 1.22,
                'Hai Ba Trung': 1.08, 'Dong Da': 1.02, 'Cau Giay': 1.05,
                'Thanh Xuan': 0.88, 'Ha Dong': 0.78, 'Long Bien': 0.82,
                'Hoang Mai': 0.85,
                'Nam Tu Liem': 0.88, 'Bac Tu Liem': 0.82, 'Tay Ho Tay': 1.15, 'My Dinh': 0.92, 'Gia Lam': 0.75, 'Thanh Tri': 0.72, 'Truc Bach': 1.08, 'Kim Ma': 1.05, 'Van Quan': 0.8
            },
            'Manila': {
                'Makati (CBD)': 1.28, 'BGC (Taguig)': 1.25, 'Rockwell': 1.22,
                'Alabang': 1.10, 'Ortigas': 1.08, 'Eastwood (Quezon City)': 1.02,
                'Pasig': 0.92, 'Mandaluyong': 0.95, 'Quezon City (Cubao)': 0.82,
                'Manila (Ermita)': 0.78, 'Las Piñas': 0.75,
                'Greenhills': 1.05, 'San Juan': 0.98, 'Marikina': 0.82, 'Antipolo': 0.72, 'Paranaque': 0.85, 'Muntinlupa': 0.88, 'Valenzuela': 0.72, 'Cainta': 0.75, 'Quezon City (Diliman)': 0.88
            },
            'Jakarta': {
                'Menteng': 1.30, 'Sudirman (SCBD)': 1.25, 'Kemang': 1.18,
                'Kuningan': 1.15, 'Senopati': 1.20, 'Pondok Indah': 1.12,
                'Kelapa Gading': 1.02, 'Pluit': 0.90, 'Cempaka Putih': 0.82,
                'Bekasi': 0.72, 'Tangerang': 0.75,
                'Cikini': 1.1, 'Thamrin': 1.22, 'Pantai Indah Kapuk': 1.08, 'Sunter': 0.88, 'Ancol': 0.85, 'Tebet': 0.95, 'Cipete': 1.02, 'Cilandak': 1.05, 'Depok': 0.68, 'Bintaro': 0.82
            },
            'Bali (Denpasar)': {
                'Seminyak': 1.28, 'Canggu': 1.22, 'Ubud': 1.10,
                'Sanur': 1.05, 'Kuta': 0.92, 'Nusa Dua': 1.18,
                'Jimbaran': 1.12, 'Denpasar Centre': 0.82, 'Uluwatu': 1.15,
                'Legian': 0.88,
                'Kedonganan': 1.08, 'Pererenan': 1.15, 'Tabanan': 0.75, 'Gianyar': 0.8, 'Amed': 0.85, 'Lovina': 0.78, 'Pecatu': 1.1, 'Keramas': 0.82
            },
            'Phnom Penh': {
                'BKK1': 1.30, 'BKK2': 1.10, 'Tonle Bassac': 1.22,
                'Daun Penh (Riverside)': 1.15, 'Toul Tom Poung (Russian Market)': 1.05,
                'Chroy Changvar': 0.90, 'Toul Kork': 0.95, 'Sen Sok': 0.78,
                'Meanchey': 0.72, 'Chamkarmon': 1.02,
                'BKK3': 1.0, 'Tuol Sleng': 0.85, 'Chbar Ampov': 0.68, 'Prek Pnov': 0.62, 'Russey Keo': 0.72, 'Boeung Kak': 0.88, 'Olympic': 0.92
            },

            // ===== ASIA - SOUTH =====
            'Mumbai': {
                'South Mumbai (Colaba)': 1.35, 'Bandra West': 1.28, 'Juhu': 1.22,
                'Worli': 1.25, 'Lower Parel': 1.18, 'Andheri West': 1.05,
                'Powai': 1.08, 'Dadar': 0.95, 'Andheri East': 0.88,
                'Borivali': 0.78, 'Thane': 0.72, 'Navi Mumbai': 0.75,
                'Kandivali West': 0.82, 'Malad West': 0.8, 'Goregaon West': 0.85, 'Chembur': 0.88, 'Wadala': 0.92, 'BKC': 1.2, 'Versova': 1.02, 'Santacruz West': 1.05, 'Vikhroli': 0.82, 'Mulund': 0.75, 'Ghatkopar West': 0.82, 'Khar West': 1.12, 'Matunga': 0.95, 'Sion': 0.85
            },
            'Bangalore': {
                'Indiranagar': 1.25, 'Koramangala': 1.22, 'Whitefield': 1.08,
                'MG Road': 1.18, 'HSR Layout': 1.05, 'Jayanagar': 1.02,
                'Electronic City': 0.85, 'Marathahalli': 0.92, 'Yelahanka': 0.78,
                'Bannerghatta Road': 0.88, 'Hebbal': 0.95,
                'Sadashivanagar': 1.15, 'Rajajinagar': 0.95, 'Malleswaram': 1.02, 'Basavanagudi': 0.98, 'JP Nagar': 0.88, 'BTM Layout': 0.85, 'Bellandur': 0.92, 'Sarjapur Road': 0.85, 'Ulsoor': 1.08, 'Shivajinagar': 0.9, 'Vijayanagar': 0.78, 'Kengeri': 0.72
            },
            'Delhi': {
                'South Delhi (GK)': 1.30, 'Lutyens Delhi': 1.40, 'Hauz Khas': 1.18,
                'Defence Colony': 1.22, 'Vasant Kunj': 1.08, 'Dwarka': 0.85,
                'Rohini': 0.78, 'Gurugram (DLF)': 1.12, 'Noida (Sector 18)': 0.82,
                'Saket': 1.05, 'Karol Bagh': 0.88,
                'Lajpat Nagar': 1.05, 'Greater Kailash': 1.25, 'Rajouri Garden': 0.88, 'Connaught Place': 1.22, 'Janakpuri': 0.8, 'Patel Nagar': 0.82, 'Mayur Vihar': 0.85, 'Pitampura': 0.82, 'Vasant Vihar': 1.18, 'Chanakyapuri': 1.3, 'Green Park': 1.1, 'Lodhi Colony': 1.15, 'Nehru Place': 0.92
            },
            'Chennai': {
                'Adyar': 1.18, 'Nungambakkam': 1.22, 'T. Nagar': 1.10,
                'Anna Nagar': 1.05, 'Mylapore': 1.08, 'OMR (Sholinganallur)': 0.92,
                'Velachery': 0.88, 'Tambaram': 0.75, 'Porur': 0.82,
                'Besant Nagar': 1.15,
                'Boat Club': 1.2, 'Alwarpet': 1.15, 'Kilpauk': 1.02, 'Thiruvanmiyur': 1.05, 'Perungudi': 0.85, 'Chromepet': 0.72, 'Medavakkam': 0.78, 'Kodambakkam': 0.92, 'Royapettah': 1.0, 'Egmore': 0.95
            },

            // ===== OCEANIA =====
            'Sydney': {
                'CBD': 1.25, 'Bondi': 1.22, 'Surry Hills': 1.15,
                'Darlinghurst': 1.12, 'Newtown': 1.05, 'Manly': 1.10,
                'Parramatta': 0.82, 'Bankstown': 0.72, 'Chatswood': 0.95,
                'Pyrmont': 1.18, 'Mosman': 1.28, 'Marrickville': 0.90,
                'Glebe': 1.08, 'Redfern': 1.02, 'Balmain': 1.1, 'Coogee': 1.12, 'Paddington': 1.15, 'Double Bay': 1.3, 'Neutral Bay': 1.05, 'Kirribilli': 1.12, 'Lane Cove': 0.92, 'Hornsby': 0.78, 'Cronulla': 0.9, 'Ryde': 0.82
            },
            'Melbourne': {
                'CBD': 1.20, 'South Yarra': 1.22, 'Fitzroy': 1.10,
                'Carlton': 1.05, 'St Kilda': 1.08, 'Collingwood': 1.02,
                'Richmond': 0.98, 'Brunswick': 0.92, 'Footscray': 0.78,
                'Docklands': 1.12, 'Toorak': 1.30, 'Prahran': 1.08,
                'Albert Park': 1.15, 'Northcote': 1.02, 'Thornbury': 0.95, 'Preston': 0.82, 'Caulfield': 1.0, 'Malvern': 1.15, 'Box Hill': 0.82, 'Camberwell': 1.05, 'Brighton': 1.22, 'Hawthorn': 1.08, 'Kew': 1.12, 'Sunshine': 0.72
            },
            'Perth': {
                'CBD': 1.18, 'Subiaco': 1.15, 'Cottesloe': 1.22,
                'Claremont': 1.12, 'Fremantle': 1.05, 'Leederville': 1.08,
                'Mount Lawley': 1.02, 'Northbridge': 0.95, 'Scarborough': 0.90,
                'Rockingham': 0.78, 'Joondalup': 0.82, 'Nedlands': 1.10,
                'Victoria Park': 1.0, 'South Perth': 1.1, 'Applecross': 1.15, 'Dalkeith': 1.25, 'Morley': 0.85, 'Cannington': 0.8, 'Armadale': 0.72, 'Innaloo': 0.85, 'Midland': 0.72, 'Karrinyup': 0.92
            },
            'Auckland': {
                'Ponsonby': 1.25, 'Parnell': 1.22, 'Herne Bay': 1.30,
                'Grey Lynn': 1.15, 'CBD': 1.12, 'Newmarket': 1.08,
                'Mt Eden': 1.05, 'Kingsland': 1.02, 'Devonport': 1.10,
                'Henderson': 0.78, 'Manukau': 0.72, 'Takapuna': 0.95,
                'Remuera': 1.18, 'Mission Bay': 1.15, 'Onehunga': 0.85, 'Mt Albert': 0.92, 'Epsom': 1.05, 'Botany': 0.8, 'Albany': 0.82, 'Howick': 0.85, 'Titirangi': 0.88, 'St Heliers': 1.08
            },

            // ===== MIDDLE EAST =====
            'Dubai': {
                'Downtown Dubai': 1.35, 'Dubai Marina': 1.28, 'Palm Jumeirah': 1.40,
                'JBR': 1.22, 'Business Bay': 1.18, 'DIFC': 1.30,
                'JLT': 1.05, 'Deira': 0.78, 'Al Barsha': 0.88,
                'Jumeirah': 1.15, 'Silicon Oasis': 0.72, 'Sports City': 0.80,
                'Arabian Ranches': 1.08, 'The Greens': 0.95, 'Discovery Gardens': 0.72, 'International City': 0.65, 'Mirdif': 0.85, 'Al Nahda': 0.78, 'Jumeirah Village Circle': 0.82, 'Damac Hills': 0.9, 'City Walk': 1.22, 'Dubai Hills': 1.1, 'Al Quoz': 0.75, 'Motor City': 0.78
            },
            'Abu Dhabi': {
                'Al Reem Island': 1.22, 'Saadiyat Island': 1.30, 'Corniche': 1.25,
                'Al Raha Beach': 1.15, 'Yas Island': 1.12, 'Khalifa City': 0.88,
                'Mussafah': 0.72, 'Al Khalidiya': 1.08, 'Tourist Club Area': 0.92,
                'Al Ain': 0.78,
                'Al Maryah Island': 1.22, 'Al Bateen': 1.15, 'Al Mushrif': 0.95, 'Al Shamkha': 0.72, 'Mohamed Bin Zayed City': 0.78, 'Al Reef': 0.82, 'Al Ghadeer': 0.8, 'Masdar City': 0.92, 'Al Ruwais': 0.68
            },
            'Doha': {
                'The Pearl': 1.35, 'West Bay': 1.28, 'Katara': 1.22,
                'Al Sadd': 1.05, 'Souq Waqif': 1.10, 'Lusail': 1.18,
                'Al Rayyan': 0.85, 'Al Wakrah': 0.78, 'Al Gharrafa': 0.82,
                'Industrial Area': 0.65,
                'Musheireb': 1.12, 'Al Dafna': 1.22, 'Ain Khaled': 0.88, 'Al Thumama': 0.82, 'Umm Salal': 0.75, 'Al Kheesa': 0.78, 'Duhail': 0.85, 'Education City': 1.05
            },
            'Riyadh': {
                'Al Olaya': 1.28, 'King Abdullah Financial District': 1.30, 'Al Nakheel': 1.18,
                'Diplomatic Quarter': 1.22, 'Al Malqa': 1.12, 'Al Yasmin': 1.05,
                'Al Sulimaniyah': 0.95, 'Al Batha': 0.72, 'Al Khaleej': 0.82,
                'Al Thumama': 0.88,
                'Al Muhammadiyah': 1.05, 'Al Rawdah': 1.08, 'Hittin': 1.15, 'Al Narjis': 0.92, 'Al Izdihar': 0.88, 'Al Aqiq': 1.0, 'Al Wadi': 0.82, 'King Fahad Road': 1.12, 'Al Shifa': 0.75
            },
            'Tel Aviv': {
                'Rothschild Blvd': 1.35, 'Neve Tzedek': 1.30, 'Florentin': 1.10,
                'Old North': 1.20, 'Sarona': 1.18, 'Jaffa': 0.95,
                'Ramat Aviv': 1.12, 'Bat Yam': 0.78, 'Holon': 0.75,
                'Givatayim': 0.92,
                "Lev Ha'ir (City Centre)": 1.25, 'Kerem HaTeimanim': 1.15, 'Shapira': 0.82, 'Yad Eliyahu': 0.88, 'Ramat HaHayal': 1.08, 'Bavli': 1.12, 'Kiryat Shalom': 0.78, 'Herzliya Pituach': 1.28, 'Bnei Brak': 0.72
            },

            // ===== AFRICA =====
            'Cape Town': {
                'Camps Bay': 1.35, 'Clifton': 1.40, 'Sea Point': 1.18,
                'City Bowl': 1.15, 'Green Point': 1.12, 'Woodstock': 0.92,
                'Observatory': 0.88, 'Rondebosch': 0.95, 'Claremont': 1.02,
                'Khayelitsha': 0.55, 'Mitchell\'s Plain': 0.60,
                'Constantia': 1.22, 'Newlands': 1.1, 'Hout Bay': 1.05, 'Muizenberg': 0.82, 'Fish Hoek': 0.78, 'Bloubergstrand': 0.85, 'Table View': 0.8, 'Stellenbosch': 0.92, 'Gardens': 1.12, 'Tamboerskloof': 1.08
            },
            'Nairobi': {
                'Westlands': 1.25, 'Karen': 1.22, 'Kilimani': 1.18,
                'Lavington': 1.15, 'Runda': 1.28, 'Kileleshwa': 1.10,
                'Upper Hill': 1.08, 'South B': 0.88, 'Eastleigh': 0.72,
                'Kibera': 0.55, 'Lang\'ata': 0.95,
                'Muthaiga': 1.2, 'Spring Valley': 1.12, 'Hurlingham': 1.08, 'Parklands': 0.92, 'Gigiri': 1.15, 'Kayole': 0.62, 'Donholm': 0.75, 'Kasarani': 0.72, 'Kitisuru': 1.1
            },
            'Lagos': {
                'Victoria Island': 1.35, 'Ikoyi': 1.30, 'Lekki Phase 1': 1.22,
                'Banana Island': 1.45, 'Yaba': 0.88, 'Surulere': 0.82,
                'Ikeja': 0.90, 'Ajah': 0.78, 'Oshodi': 0.68,
                'Maryland': 0.85, 'Gbagada': 0.92,
                'Lekki Phase 2': 1.08, 'Magodo': 0.95, 'Festac Town': 0.72, 'Ilupeju': 0.82, 'Agege': 0.65, 'Amuwo-Odofin': 0.78, 'Ogudu': 0.82, 'Sangotedo': 0.75, 'Chevron Drive': 1.12
            },
            'Cairo': {
                'Zamalek': 1.35, 'Garden City': 1.28, 'Maadi': 1.18,
                'Heliopolis': 1.08, 'New Cairo (5th Settlement)': 1.15, '6th of October City': 0.85,
                'Dokki': 1.02, 'Mohandessin': 0.95, 'Nasr City': 0.82,
                'Shubra': 0.72, 'Downtown': 0.90,
                'Rehab City': 1.1, 'Sheikh Zayed City': 1.05, 'Katameya': 1.12, 'Obour City': 0.78, 'Al Shorouk': 0.82, 'Corniche El Nil': 1.05, 'Hadayek El Maadi': 1.02, 'Ain Shams': 0.68, 'El Marg': 0.65
            },
            'Marrakech': {
                'Gueliz': 1.18, 'Hivernage': 1.25, 'Medina (Riads)': 1.15,
                'Palmeraie': 1.30, 'Agdal': 1.08, 'Targa': 1.02,
                'Massira': 0.78, 'Sidi Youssef Ben Ali': 0.72, 'Menara': 0.88,
                'Amelkis': 1.12,
                'Route de Fès': 0.82, 'Route de Ouarzazate': 0.75, 'Tamesna': 0.7, 'Sidi Ghanem': 0.92, 'Bab Doukkala': 0.95, 'Route de Casablanca': 0.8, "M'hamid": 0.82
            },
            'Casablanca': {
                'Corniche (Ain Diab)': 1.25, 'Maarif': 1.15, 'Anfa': 1.22,
                'Gauthier': 1.12, 'Bourgogne': 1.08, 'Racine': 1.05,
                'Sidi Moumen': 0.68, 'Hay Hassani': 0.78, 'Derb Sultan': 0.82,
                'CIL': 0.88,
                'Dar Bouazza': 0.85, 'Oulfa': 0.72, 'Oasis': 1.02, 'Palmier': 0.95, "Triangle d'Or": 1.18, 'Ain Chock': 0.75, 'Sidi Bernoussi': 0.68, 'Ain Sebaa': 0.78
            },

            // ===== SOUTH AMERICA =====
            'São Paulo': {
                'Jardins': 1.30, 'Vila Madalena': 1.15, 'Pinheiros': 1.18,
                'Itaim Bibi': 1.25, 'Vila Olímpia': 1.20, 'Moema': 1.12,
                'Centro': 0.78, 'Liberdade': 0.85, 'Bela Vista': 0.92,
                'Santana': 0.82, 'Tatuapé': 0.80,
                'Brooklin': 1.18, 'Perdizes': 1.1, 'Alto de Pinheiros': 1.22, 'Consolação': 1.02, 'Higienópolis': 1.2, 'Butantã': 0.85, 'Morumbi': 1.15, 'Campo Belo': 1.08, 'Paraíso': 1.05, 'Lapa': 0.88, 'Ipiranga': 0.78, 'Vila Mariana': 1.02, 'Aclimação': 0.92
            },
            'Buenos Aires': {
                'Palermo (Soho)': 1.25, 'Recoleta': 1.28, 'Puerto Madero': 1.35,
                'San Telmo': 1.02, 'Belgrano': 1.10, 'Núñez': 1.05,
                'Caballito': 0.88, 'Almagro': 0.85, 'Flores': 0.75,
                'Villa Crespo': 0.92, 'Colegiales': 1.02,
                'La Boca': 0.78, 'Palermo Hollywood': 1.18, 'Montserrat': 0.88, 'Retiro': 1.02, 'Barrio Norte': 1.15, 'Balvanera': 0.82, 'Chacarita': 0.88, 'Saavedra': 0.82, 'Villa Devoto': 0.8, 'Palermo Chico': 1.3, 'Olivos': 1.05, 'Vicente López': 1.02
            },
            'Bogotá': {
                'Zona T (Zona Rosa)': 1.25, 'Usaquén': 1.22, 'Chicó': 1.20,
                'Chapinero Alto': 1.12, 'La Candelaria': 0.88, 'Cedritos': 1.02,
                'Suba': 0.82, 'Kennedy': 0.72, 'Teusaquillo': 0.95,
                'Santa Bárbara': 1.15,
                'Rosales': 1.18, 'El Virrey': 1.15, 'Galerías': 0.92, 'La Soledad': 0.88, 'La Macarena': 0.95, 'Niza': 1.02, 'Engativá': 0.75, 'Fontibón': 0.78, 'Modelia': 0.88
            },
            'Lima': {
                'Miraflores': 1.28, 'San Isidro': 1.30, 'Barranco': 1.15,
                'Surco': 1.08, 'La Molina': 1.05, 'San Borja': 1.02,
                'Jesús María': 0.90, 'Lince': 0.85, 'San Juan de Lurigancho': 0.68,
                'Callao': 0.72,
                'Pueblo Libre': 0.88, 'Magdalena': 0.92, 'San Miguel': 0.85, 'La Victoria': 0.72, 'Chorrillos': 0.78, 'Surquillo': 0.82, 'Ate': 0.72, 'Comas': 0.65, 'Los Olivos': 0.75
            },
            'Santiago': {
                'Providencia': 1.22, 'Las Condes': 1.25, 'Vitacura': 1.35,
                'Ñuñoa': 1.08, 'La Reina': 1.05, 'Santiago Centro': 0.92,
                'Lo Barnechea': 1.18, 'Macul': 0.82, 'La Florida': 0.78,
                'Puente Alto': 0.70,
                'Peñalolén': 0.85, 'San Miguel': 0.78, 'Recoleta': 0.72, 'Maipú': 0.7, 'Independencia': 0.75, 'Pedro de Valdivia': 1.15, 'El Golf': 1.22, 'Tobalaba': 1.02, 'Bellavista': 1.0
            },
            'Medellín': {
                'El Poblado': 1.30, 'Laureles': 1.12, 'Envigado': 1.08,
                'Sabaneta': 0.95, 'Belén': 0.88, 'La Floresta': 1.02,
                'Centro': 0.78, 'Robledo': 0.75, 'Aranjuez': 0.72,
                'Estadio': 0.85,
                'Manila': 1.05, 'San Lucas': 1.18, 'La Estrella': 0.82, 'Itagüí': 0.78, 'Bello': 0.72, 'Calasanz': 0.8, 'Castropol': 1.08, 'Boston': 0.75, 'Provenza': 1.15
            },
            'Montevideo': {
                'Pocitos': 1.22, 'Punta Carretas': 1.25, 'Carrasco': 1.30,
                'Ciudad Vieja': 1.08, 'Parque Rodó': 1.05, 'Buceo': 1.02,
                'Cordón': 0.92, 'Tres Cruces': 0.88, 'La Blanqueada': 0.85,
                'Cerro': 0.70,
                'Malvín': 1.0, 'Parque Batlle': 0.95, 'Paso Molino': 0.78, 'La Comercial': 0.82, 'Prado': 0.85, 'Aguada': 0.75, 'Unión': 0.72, 'Punta Gorda': 1.12
            },
            'San José (CR)': {
                'Escazú': 1.28, 'Santa Ana': 1.22, 'Rohrmoser': 1.12,
                'Los Yoses': 1.08, 'Barrio Escalante': 1.10, 'San Pedro': 0.92,
                'Sabana': 1.05, 'Heredia': 0.85, 'Alajuela': 0.78,
                'Cartago': 0.75,
                'Curridabat': 0.92, 'Moravia': 0.85, 'Tibás': 0.78, 'Desamparados': 0.72, 'Montes de Oca': 0.9, 'San Rafael': 0.82, 'Guadalupe': 0.78, 'Zapote': 0.85
            },
            'Playa del Carmen': {
                'Playacar': 1.30, 'Centro (5th Avenue)': 1.18, 'Gonzalo Guerrero': 1.05,
                'Ejidal': 0.82, 'Colosio': 0.78, 'Playa Mamitas': 1.22,
                'Zazil Ha': 0.88, 'Luis Donaldo Colosio': 0.75,
                'Villas del Sol': 0.72,
                'Selvanova': 0.85, 'Real Ibiza': 0.68, 'Riviera Maya Zona': 1.15, 'Puerto Aventuras': 1.1, 'Mayakoba Area': 1.25, 'Playa Paraíso': 1.08, 'La Guadalupana': 0.72
            }
        };

        // Dynamic city & neighborhood counts
        const totalCities = Object.keys(coliData).length;
        const totalNeighborhoods = Object.values(cityNeighborhoods).reduce((sum, n) => sum + Object.keys(n).length, 0);
        const roundedNeighborhoods = Math.floor(totalNeighborhoods / 100) * 100;
        const countText = `Compare salaries across ${totalCities} cities and over ${roundedNeighborhoods.toLocaleString()} neighborhoods worldwide.`;
        const heroEl = document.getElementById('hero-subtitle');
        const footerEl = document.getElementById('footer-subtitle');
        if (heroEl) heroEl.textContent = countText;
        if (footerEl) footerEl.textContent = countText;

        // Auto-suggest currency when a city is selected (always updates, user can still override)
        function suggestCurrency(city, currencySelectId, hintId) {
            const suggestedCurrency = cityToCurrency[city];
            const currencySelect = document.getElementById(currencySelectId);
            const hint = document.getElementById(hintId);

            if (suggestedCurrency) {
                // Always update the currency to match the selected city
                currencySelect.value = suggestedCurrency;

                // Show hint so user knows they can change it
                hint.textContent = `💡 Auto-selected: ${suggestedCurrency} for ${city} — you can change this`;
                hint.classList.add('show');
            } else {
                hint.classList.remove('show');
            }

            // Update offer input currency hints when target currency changes
            if (currencySelectId === 'targetCurrency') {
                updateOfferCurrencyHints();
            }
        }

        // Show target currency in offer input placeholders and hints
        function updateOfferCurrencyHints() {
            const tc = document.getElementById('targetCurrency').value;
            const badge = document.getElementById('offerCurrencyBadge');
            const familyHint = document.getElementById('familyOfferCurrencyHint');
            const offer1 = document.getElementById('offer1Salary');
            const offer2 = document.getElementById('offer2Salary');
            const singleOffer = document.getElementById('targetSalary');

            if (tc) {
                const sym = getCurrencySymbol(tc);
                badge.textContent = sym;
                badge.style.display = '';
                singleOffer.style.paddingLeft = `${sym.length * 10 + 16}px`;
                singleOffer.placeholder = `e.g. 45,000`;
                offer1.placeholder = `e.g. 80,000 (${tc})`;
                offer2.placeholder = `e.g. 45,000 (${tc})`;
                familyHint.textContent = `Enter target salaries in ${tc}. Uses the target currency selected above.`;
            } else {
                badge.style.display = 'none';
                singleOffer.style.paddingLeft = '';
                singleOffer.placeholder = 'e.g. 45,000';
                offer1.placeholder = 'e.g. 80,000';
                offer2.placeholder = 'e.g. 45,000';
                familyHint.textContent = 'Have target salaries or offers? Enter them for a personalized comparison.';
            }
        }

        // Get currency symbol from code
        function getCurrencySymbol(code) {
            try {
                return (0).toLocaleString('en-US', { style: 'currency', currency: code, minimumFractionDigits: 0, maximumFractionDigits: 0 }).replace(/\d/g, '').trim();
            } catch(e) {
                return code;
            }
        }

        // Populate neighborhood dropdown when a city is selected
        function populateNeighborhoods(city, neighborhoodSelectId, neighborhoodGroupId) {
            const select = document.getElementById(neighborhoodSelectId);
            const group = document.getElementById(neighborhoodGroupId);
            const neighborhoods = cityNeighborhoods[city];

            // Clear existing options
            select.innerHTML = '<option value="">Select a neighborhood...</option>';

            if (neighborhoods) {
                // Sort neighborhoods by multiplier (highest first)
                const sorted = Object.entries(neighborhoods).sort((a, b) => b[1] - a[1]);
                sorted.forEach(([name, multiplier]) => {
                    const option = document.createElement('option');
                    option.value = name;
                    const pct = ((multiplier - 1) * 100);
                    const sign = pct >= 0 ? '+' : '';
                    option.textContent = `${name} (${sign}${pct.toFixed(0)}% vs city avg)`;
                    select.appendChild(option);
                });
                group.style.display = 'block';
            } else {
                group.style.display = 'none';
            }
        }

        const cities = Object.keys(coliData).sort();
        const currencies = Object.keys(exchangeRates).sort();

        // Populate dropdowns
        function populateSelects() {
            const currentCitySelect = document.getElementById('currentCity');
            const targetCitySelect = document.getElementById('targetCity');
            const currentCurrencySelect = document.getElementById('currentCurrency');
            const targetCurrencySelect = document.getElementById('targetCurrency');

            cities.forEach(city => {
                let option = document.createElement('option');
                option.value = city;
                option.textContent = city;
                currentCitySelect.appendChild(option);

                option = document.createElement('option');
                option.value = city;
                option.textContent = city;
                targetCitySelect.appendChild(option);
            });

            currencies.forEach(curr => {
                let option = document.createElement('option');
                option.value = curr;
                option.textContent = curr;
                currentCurrencySelect.appendChild(option);

                option = document.createElement('option');
                option.value = curr;
                option.textContent = curr;
                targetCurrencySelect.appendChild(option);
            });
        }

        // Auto-suggest currency and populate neighborhoods on city dropdown change
        document.getElementById('currentCity').addEventListener('change', (e) => {
            suggestCurrency(e.target.value, 'currentCurrency', 'currentCurrencyHint');
            populateNeighborhoods(e.target.value, 'currentNeighborhood', 'currentNeighborhoodGroup');
        });
        document.getElementById('targetCity').addEventListener('change', (e) => {
            suggestCurrency(e.target.value, 'targetCurrency', 'targetCurrencyHint');
            populateNeighborhoods(e.target.value, 'targetNeighborhood', 'targetNeighborhoodGroup');
        });
        document.getElementById('targetCurrency').addEventListener('change', () => {
            updateOfferCurrencyHints();
        });

        // Create quick select buttons
        function createQuickButtons() {
            const popularCities = ['London', 'New York', 'Dubai', 'Singapore', 'Tokyo', 'Paris', 'Sydney', 'Toronto', 'Berlin', 'Bangkok', 'Lisbon', 'Bali (Denpasar)'];

            const currentQuick = document.getElementById('currentCityQuick');
            const targetQuick = document.getElementById('targetCityQuick');

            popularCities.forEach(city => {
                let btn1 = document.createElement('button');
                btn1.type = 'button';
                btn1.className = 'quick-btn';
                btn1.textContent = city;
                btn1.addEventListener('click', () => {
                    document.getElementById('currentCity').value = city;
                    document.querySelectorAll('#currentCityQuick .quick-btn').forEach(b => b.classList.remove('active'));
                    btn1.classList.add('active');
                    suggestCurrency(city, 'currentCurrency', 'currentCurrencyHint');
                    populateNeighborhoods(city, 'currentNeighborhood', 'currentNeighborhoodGroup');
                });
                currentQuick.appendChild(btn1);

                let btn2 = document.createElement('button');
                btn2.type = 'button';
                btn2.className = 'quick-btn';
                btn2.textContent = city;
                btn2.addEventListener('click', () => {
                    document.getElementById('targetCity').value = city;
                    document.querySelectorAll('#targetCityQuick .quick-btn').forEach(b => b.classList.remove('active'));
                    btn2.classList.add('active');
                    suggestCurrency(city, 'targetCurrency', 'targetCurrencyHint');
                    populateNeighborhoods(city, 'targetNeighborhood', 'targetNeighborhoodGroup');
                });
                targetQuick.appendChild(btn2);
            });
        }

        // Show/hide error with scroll-to and field highlight
        function showError(message, fieldId) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
            if (fieldId) {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    field.style.borderColor = '#dc2626';
                    field.style.boxShadow = '0 0 0 3px rgba(220, 38, 38, 0.15)';
                    field.focus();
                    setTimeout(() => {
                        field.style.borderColor = '';
                        field.style.boxShadow = '';
                    }, 3000);
                }
            }
            setTimeout(() => {
                errorDiv.classList.remove('show');
            }, 5000);
        }

        // Format salary input with commas as user types
        const salaryInput = document.getElementById('currentSalary');
        salaryInput.addEventListener('input', (e) => {
            // Remove commas and non-digit/non-dot characters
            let value = e.target.value.replace(/,/g, '').replace(/[^\d.]/g, '');

            if (value === '') {
                e.target.value = '';
                return;
            }

            const parts = value.split('.');
            let integerPart = parts[0];
            let decimalPart = parts[1] || '';

            // Remove leading zeros (but keep single zero)
            integerPart = integerPart.replace(/^0+(?=\d)/, '');

            // Format integer part with commas
            const formattedInteger = Number(integerPart).toLocaleString('en-US');

            let formatted = formattedInteger;
            if (decimalPart.length > 0) {
                decimalPart = decimalPart.slice(0, 2); // limit to 2 decimals
                formatted += '.' + decimalPart;
            }

            e.target.value = formatted;
        });

        // Format salary offer inputs with commas as user types
        function formatSalaryInput(e) {
            let value = e.target.value.replace(/,/g, '').replace(/[^\d.]/g, '');
            if (value === '') { e.target.value = ''; return; }
            const parts = value.split('.');
            let integerPart = parts[0].replace(/^0+(?=\d)/, '');
            const formattedInteger = Number(integerPart).toLocaleString('en-US');
            let formatted = formattedInteger;
            if (parts[1] !== undefined) {
                formatted += '.' + parts[1].slice(0, 2);
            }
            e.target.value = formatted;
        }
        document.getElementById('targetSalary').addEventListener('input', formatSalaryInput);
        document.getElementById('offer1Salary').addEventListener('input', formatSalaryInput);
        document.getElementById('offer2Salary').addEventListener('input', formatSalaryInput);

        // Calculate salary
        document.getElementById('calculateBtn').addEventListener('click', () => {
            const household = getHousehold();
            let salary, salary2 = null;

            if (household.mode === 'family' && household.adults === 2) {
                const raw1 = document.getElementById('adult1Salary').value.replace(/,/g, '').replace(/[^\d.]/g, '');
                const raw2 = document.getElementById('adult2Salary').value.replace(/,/g, '').replace(/[^\d.]/g, '');
                salary = parseFloat(raw1);
                salary2 = parseFloat(raw2);
                if (!salary || salary <= 0) { showError('Please enter Adult 1 salary', 'adult1Salary'); return; }
                if (!salary2 || salary2 <= 0) { showError('Please enter Adult 2 salary', 'adult2Salary'); return; }
            } else {
                const rawSalary = document.getElementById('currentSalary').value.replace(/,/g, '').replace(/[^\d.]/g, '');
                salary = parseFloat(rawSalary);
                if (!salary || salary <= 0) { showError('Please enter your salary', 'currentSalary'); return; }
            }

            // Read city from the correct field
            const currentCity = (household.mode === 'family' && household.adults === 2)
                ? (document.getElementById('familyCity').value || document.getElementById('currentCity').value)
                : document.getElementById('currentCity').value;
            const currentCurrency = document.getElementById('currentCurrency').value;
            const targetCity = document.getElementById('targetCity').value;
            const targetCurrency = document.getElementById('targetCurrency').value;
            const currentNeighborhood = document.getElementById('currentNeighborhood').value;
            const targetNeighborhood = document.getElementById('targetNeighborhood').value;

            // Read optional target salary offer(s)
            let targetSalaryOffer = null;
            let offer1 = null, offer2 = null;
            const isFamily2Offer = household.mode === 'family' && household.adults === 2;

            if (isFamily2Offer) {
                const raw1 = document.getElementById('offer1Salary').value.replace(/,/g, '').replace(/[^\d.]/g, '');
                const raw2 = document.getElementById('offer2Salary').value.replace(/,/g, '').replace(/[^\d.]/g, '');
                offer1 = raw1 ? parseFloat(raw1) : null;
                offer2 = raw2 ? parseFloat(raw2) : null;
                if (offer1 !== null || offer2 !== null) {
                    offer1 = offer1 || 0;
                    offer2 = offer2 || 0;
                    targetSalaryOffer = offer1 + offer2;
                }
            } else {
                const rawTargetSalary = document.getElementById('targetSalary').value
                    .replace(/,/g, '').replace(/[^\d.]/g, '');
                targetSalaryOffer = rawTargetSalary ? parseFloat(rawTargetSalary) : null;
            }
            const hasOffer = targetSalaryOffer !== null && targetSalaryOffer > 0;

            // For family mode, total salary is combined
            const totalSalary = salary2 ? salary + salary2 : salary;
            if (!currentCity) {
                showError('Please select your current city', 'currentCity');
                return;
            }
            if (!currentCurrency) {
                showError('Please select your current currency', 'currentCurrency');
                return;
            }
            if (!targetCity) {
                showError('Please select a comparable city', 'targetCity');
                return;
            }
            if (!targetCurrency) {
                showError('Please select a target currency', 'targetCurrency');
                return;
            }
            if (cityNeighborhoods[currentCity] && !currentNeighborhood && !window._fromUrlParams) {
                showError('Please select a neighborhood for your current city', 'currentNeighborhood');
                return;
            }
            if (cityNeighborhoods[targetCity] && !targetNeighborhood && !window._fromUrlParams) {
                showError('Please select a neighborhood for your target city', 'targetNeighborhood');
                return;
            }
            window._fromUrlParams = false;

            // Get base cost of living indices
            const baseCOLICurrent = coliData[currentCity];
            const baseCOLITarget = coliData[targetCity];

            // Get neighborhood multipliers (1.0 if no neighborhood selected)
            const currentNeighMult = currentNeighborhood && cityNeighborhoods[currentCity]
                ? cityNeighborhoods[currentCity][currentNeighborhood] : 1.0;
            const targetNeighMult = targetNeighborhood && cityNeighborhoods[targetCity]
                ? cityNeighborhoods[targetCity][targetNeighborhood] : 1.0;

            // Adjusted COLI with neighborhood multiplier
            const currentCOLI = baseCOLICurrent * currentNeighMult;
            const targetCOLI = baseCOLITarget * targetNeighMult;

            // Get exchange rate (current -> target)
            const currentToGBP = 1 / exchangeRates[currentCurrency];
            const GBPtoTarget = exchangeRates[targetCurrency];
            const exchangeRate = currentToGBP * GBPtoTarget;

            // === COLI-only equivalent (for reference) ===
            const colRatio = targetCOLI / currentCOLI;
            const coliEquivalentSalary = totalSalary * colRatio * exchangeRate;

            // === Format helpers ===
            const formatter = new Intl.NumberFormat('en-US', {
                style: 'currency', currency: targetCurrency,
                minimumFractionDigits: 0, maximumFractionDigits: 0
            });
            const fmtCurr = (amount, cur) => new Intl.NumberFormat('en-US', {
                style: 'currency', currency: cur,
                minimumFractionDigits: 0, maximumFractionDigits: 0
            }).format(amount);
            const formattedOriginalCurrent = fmtCurr(totalSalary, currentCurrency);
            const currentLabel = currentNeighborhood ? `${currentNeighborhood}, ${currentCity}` : currentCity;
            const targetLabel = targetNeighborhood ? `${targetNeighborhood}, ${targetCity}` : targetCity;

            // === TRUE EQUIVALENT SALARY CALCULATION ===
            const currentCountry = cityToCountry[currentCity];
            const targetCountry = cityToCountry[targetCity];

            // Step 1: Current city deductions + expenses
            const currentExpenses = calculateExpenses(currentCity, currentNeighMult, currentCurrency, household);
            const targetExpenses = calculateExpenses(targetCity, targetNeighMult, targetCurrency, household);

            let trueEquivalentSalary;
            let currentDisposable = null, targetDisposable = null;
            let currentDed = null, currentDed2 = null;
            let targetAdult1Gross = null, targetAdult2Gross = null;
            let combinedCurrentTakeHome = 0;

            if (household.mode === 'family' && household.adults === 2) {
                // Family mode with 2 working adults: tax each salary separately
                currentDed = (currentCountry) ? calculateAllDeductions(salary, currentCountry, currentCity, currentNeighborhood) : null;
                currentDed2 = (currentCountry) ? calculateAllDeductions(salary2, currentCountry, currentCity, currentNeighborhood) : null;
                if (currentDed && currentDed2) combinedCurrentTakeHome = currentDed.net + currentDed2.net;
            } else {
                // Single mode or family with 1 adult
                currentDed = (currentCountry) ? calculateAllDeductions(salary, currentCountry, currentCity, currentNeighborhood) : null;
                if (currentDed) combinedCurrentTakeHome = currentDed.net;
            }

            const hasFullData = !!(currentDed && currentCountry && targetCountry && currentExpenses && targetExpenses);
            const hasTaxData = !!(currentDed && currentCountry && targetCountry);

            // Calculate current disposable (used in both normal and remote mode)
            if (hasFullData) {
                currentDisposable = combinedCurrentTakeHome - currentExpenses.total;
            }

            const isFamily2Early = household.mode === 'family' && household.adults === 2;
            if (household.remote) {
                // === REMOTE MODE: same salary, compare purchasing power ===
                const targetGrossSingle = salary * exchangeRate;
                const targetGross2 = salary2 ? salary2 * exchangeRate : 0;
                trueEquivalentSalary = isFamily2Early ? targetGrossSingle + targetGross2 : targetGrossSingle;
                targetAdult1Gross = targetGrossSingle;
                if (isFamily2Early) targetAdult2Gross = targetGross2;
            } else if (hasFullData) {
                const targetDisposableNeeded = currentDisposable * exchangeRate;
                const targetTakeHomeNeeded = targetDisposableNeeded + targetExpenses.total;

                if (household.mode === 'family' && household.adults === 2) {
                    // Split target take-home by salary ratio, reverse-engineer each
                    const totalInput = salary + salary2;
                    const ratio1 = salary / totalInput;
                    const ratio2 = salary2 / totalInput;
                    const targetTH1 = targetTakeHomeNeeded * ratio1;
                    const targetTH2 = targetTakeHomeNeeded * ratio2;
                    targetAdult1Gross = reverseGrossFromNet(Math.max(targetTH1, 0), targetCountry, targetCity, targetNeighborhood);
                    targetAdult2Gross = reverseGrossFromNet(Math.max(targetTH2, 0), targetCountry, targetCity, targetNeighborhood);
                    trueEquivalentSalary = targetAdult1Gross + targetAdult2Gross;
                } else {
                    trueEquivalentSalary = reverseGrossFromNet(Math.max(targetTakeHomeNeeded, 0), targetCountry, targetCity, targetNeighborhood);
                }
            } else if (hasTaxData) {
                const targetTakeHomeNeeded = combinedCurrentTakeHome * exchangeRate;
                if (household.mode === 'family' && household.adults === 2) {
                    const totalInput = salary + salary2;
                    const ratio1 = salary / totalInput;
                    const targetTH1 = targetTakeHomeNeeded * ratio1;
                    const targetTH2 = targetTakeHomeNeeded * (1 - ratio1);
                    targetAdult1Gross = reverseGrossFromNet(Math.max(targetTH1, 0), targetCountry, targetCity, targetNeighborhood);
                    targetAdult2Gross = reverseGrossFromNet(Math.max(targetTH2, 0), targetCountry, targetCity, targetNeighborhood);
                    trueEquivalentSalary = targetAdult1Gross + targetAdult2Gross;
                } else {
                    trueEquivalentSalary = reverseGrossFromNet(Math.max(targetTakeHomeNeeded, 0), targetCountry, targetCity, targetNeighborhood);
                }
            } else {
                trueEquivalentSalary = coliEquivalentSalary;
            }

            const formattedAmount = formatter.format(trueEquivalentSalary);

            // Salary used for target-side analysis
            const affordabilitySalary = hasOffer ? targetSalaryOffer : trueEquivalentSalary;
            const isFamily2 = household.mode === 'family' && household.adults === 2;
            const isFamily = household.mode === 'family';

            // For target-side deductions
            let targetDed = null, targetDed2 = null, combinedTargetTakeHome = 0;
            if (household.remote) {
                // Remote mode: tax the converted salary in the target country
                if (isFamily2) {
                    targetDed = (targetCountry) ? calculateAllDeductions(targetAdult1Gross || 0, targetCountry, targetCity, targetNeighborhood) : null;
                    targetDed2 = (targetCountry) ? calculateAllDeductions(targetAdult2Gross || 0, targetCountry, targetCity, targetNeighborhood) : null;
                    if (targetDed && targetDed2) combinedTargetTakeHome = targetDed.net + targetDed2.net;
                } else {
                    targetDed = (targetCountry) ? calculateAllDeductions(targetAdult1Gross || 0, targetCountry, targetCity, targetNeighborhood) : null;
                    if (targetDed) combinedTargetTakeHome = targetDed.net;
                }
            } else if (isFamily2 && !hasOffer) {
                targetDed = (targetCountry) ? calculateAllDeductions(targetAdult1Gross || 0, targetCountry, targetCity, targetNeighborhood) : null;
                targetDed2 = (targetCountry) ? calculateAllDeductions(targetAdult2Gross || 0, targetCountry, targetCity, targetNeighborhood) : null;
                if (targetDed && targetDed2) combinedTargetTakeHome = targetDed.net + targetDed2.net;
            } else if (isFamily2 && hasOffer) {
                // Use actual per-adult offers (not ratio split)
                targetDed = (targetCountry) ? calculateAllDeductions(offer1 || 0, targetCountry, targetCity, targetNeighborhood) : null;
                targetDed2 = (targetCountry) ? calculateAllDeductions(offer2 || 0, targetCountry, targetCity, targetNeighborhood) : null;
                if (targetDed && targetDed2) combinedTargetTakeHome = targetDed.net + targetDed2.net;
            } else {
                targetDed = (targetCountry) ? calculateAllDeductions(affordabilitySalary, targetCountry, targetCity, targetNeighborhood) : null;
                if (targetDed) combinedTargetTakeHome = targetDed.net;
            }

            // Calculate target disposable on actual salary
            if (hasFullData && combinedTargetTakeHome > 0) {
                targetDisposable = combinedTargetTakeHome - targetExpenses.total;
            }

            // === 1. HEADLINE ===
            const isHouseholdMode = isFamily;
            let headlinePrefix;
            if (household.remote) {
                headlinePrefix = isHouseholdMode ? 'Your Household Purchasing Power in' : 'Your Purchasing Power in';
            } else {
                headlinePrefix = isHouseholdMode ? 'Your Household True Equivalent in' : 'Your True Equivalent Salary in';
            }
            document.getElementById('resultTitle').textContent = `${headlinePrefix} ${targetCity}`;
            document.getElementById('resultAmount').textContent = formattedAmount;

            let subtitleHtml = '';
            if (household.remote) {
                if (isFamily2) {
                    subtitleHtml = `Your household income of <strong>${formattedOriginalCurrent}</strong> (${currentCurrency}), converted and taxed in ${targetCity} after living costs.`;
                } else {
                    subtitleHtml = `Your <strong>${formattedOriginalCurrent}</strong> (${currentCurrency}) salary, converted and taxed in ${targetCity} after living costs.`;
                }
            } else if (isFamily2) {
                subtitleHtml = `Adult 1: <strong>${fmtCurr(targetAdult1Gross || 0, targetCurrency)}</strong> + Adult 2: <strong>${fmtCurr(targetAdult2Gross || 0, targetCurrency)}</strong>`;
                if (hasFullData) subtitleHtml += `<br><span style="font-size:0.82rem;color:var(--text-secondary);">To maintain the same household disposable income from <strong>${fmtCurr(totalSalary, currentCurrency)}</strong> in ${currentLabel}.</span>`;
            } else {
                subtitleHtml = hasFullData
                    ? `To maintain the same disposable income you have on <strong>${formattedOriginalCurrent}</strong> in ${currentLabel}, accounting for taxes, rent, and living costs.`
                    : hasTaxData
                        ? `To maintain the same take-home pay you have on <strong>${formattedOriginalCurrent}</strong> in ${currentLabel}, accounting for taxes.`
                        : `Based on cost-of-living index comparison (limited data available).`;
            }
            document.getElementById('resultSubtitle').innerHTML = subtitleHtml;

            // === 3. VERDICT BANNER (affordable + take-home comparison) ===
            const verdictBanner = document.getElementById('verdictBanner');
            if (hasFullData && combinedCurrentTakeHome > 0 && combinedTargetTakeHome > 0) {
                // Compare take-home pay (stable metric — avoids extreme % on small disposable residuals)
                const currentTHinTarget = combinedCurrentTakeHome * exchangeRate;
                const thDiffPct = ((combinedTargetTakeHome - currentTHinTarget) / currentTHinTarget) * 100;
                const absThPct = Math.abs(thDiffPct).toFixed(0);
                let verdictClass, verdictIcon, verdictText;

                if (household.remote) {
                    // Remote mode verdict: compare disposable income
                    const currentDispInTarget = currentDisposable * exchangeRate;
                    const dispDiffPct = currentDispInTarget !== 0 ? ((targetDisposable - currentDispInTarget) / Math.abs(currentDispInTarget)) * 100 : 0;
                    const absPct = Math.abs(dispDiffPct).toFixed(0);
                    const fmtDiff = formatter.format(Math.abs(targetDisposable - currentDispInTarget));

                    if (dispDiffPct > 5) {
                        verdictClass = 'better'; verdictIcon = '\uD83D\uDFE2';
                        verdictText = `Your money goes further \u2014 you'd have ~${absPct}% more disposable income (${fmtDiff}/yr more) in ${targetLabel}`;
                    } else if (dispDiffPct < -5) {
                        verdictClass = 'worse'; verdictIcon = '\uD83D\uDD34';
                        verdictText = `Your money doesn't go as far \u2014 you'd have ~${absPct}% less disposable income (${fmtDiff}/yr less) in ${targetLabel}`;
                    } else {
                        verdictClass = 'similar'; verdictIcon = '\uD83D\uDFE1';
                        verdictText = `Similar purchasing power \u2014 your disposable income would change by ~${absPct}% in ${targetLabel}`;
                    }
                } else if (hasOffer) {
                    const fmtOffer = formatter.format(targetSalaryOffer);
                    if (targetDisposable > 0 && thDiffPct >= -2) {
                        // Affordable and at or above parity
                        verdictClass = 'better'; verdictIcon = '\uD83D\uDFE2';
                        const moreOrLess = thDiffPct >= 0 ? 'more' : 'less';
                        verdictText = `Your ${fmtOffer} target salary is affordable \u2014 you'd have ~${absThPct}% ${moreOrLess} take-home pay than your current equivalent`;
                    } else if (targetDisposable > 0 && thDiffPct < -2) {
                        // Affordable but below parity
                        verdictClass = 'similar'; verdictIcon = '\uD83D\uDFE1';
                        verdictText = `Your ${fmtOffer} target salary is affordable, but you'd have ~${absThPct}% less take-home pay \u2014 you'd save less each month`;
                    } else {
                        // Not affordable — expenses exceed take-home
                        const shortfall = formatter.format(Math.abs(targetDisposable));
                        verdictClass = 'worse'; verdictIcon = '\uD83D\uDD34';
                        verdictText = `Your ${fmtOffer} target salary may be tight \u2014 living expenses would exceed take-home by ${shortfall}/yr`;
                    }
                } else {
                    verdictClass = 'neutral'; verdictIcon = '\u2139\uFE0F';
                    const needPrefix = isHouseholdMode ? 'Your household needs' : 'You need';
                    verdictText = `${needPrefix} ${formattedAmount} in ${targetLabel} to maintain your current take-home pay relative to expenses`;
                }
                verdictBanner.className = 'verdict-banner ' + verdictClass;
                document.getElementById('verdictIcon').textContent = verdictIcon;
                document.getElementById('verdictText').innerHTML = verdictText;
                verdictBanner.style.display = '';
            } else {
                verdictBanner.style.display = 'none';
            }

            // === 3. FULL BREAKDOWN CARDS ===
            const breakdownSection = document.getElementById('fullBreakdownSection');
            if (currentDed && targetDed) {
                function pctBadge(currentVal, targetVal) {
                    if (!currentVal || currentVal <= 0 || !targetVal) return '';
                    const pct = ((targetVal - currentVal) / currentVal) * 100;
                    const absPct = Math.abs(pct).toFixed(0);
                    if (absPct < 3) return '<span class="exp-pct pct-similar">~same</span>';
                    if (pct > 0) return `<span class="exp-pct pct-pricier">+${absPct}%</span>`;
                    return `<span class="exp-pct pct-cheaper">\u2212${absPct}%</span>`;
                }

                function buildFullBreakdownCard(label, gross, ded, ded2, expenses, disposable, currency, isOffer, hh, compareExpenses) {
                    const fmtLocal = (amount) => fmtCurr(amount, currency);
                    const dispClass = (disposable !== null && disposable >= 0) ? 'positive' : 'negative';
                    const isFam2 = hh && hh.mode === 'family' && hh.adults === 2;
                    const grossLabel = isOffer ? 'Gross Salary (your target)' : (isFam2 ? 'Household Gross' : 'Gross Salary');

                    let html = `<div class="full-breakdown-card">
                        <div class="fbc-city">${label}</div>
                        <div class="fbc-row gross"><span>${grossLabel}</span><span class="fbc-val">${fmtLocal(gross)}</span></div>`;

                    if (isFam2 && ded && ded2) {
                        html += `<div class="fbc-section-label">Taxes &amp; Deductions<sup>2</sup></div>`;
                        html += `<div style="font-size:0.72rem;color:var(--text-secondary);padding:2px 0 4px;font-style:italic;">Adult 1 (${fmtLocal(ded.net + ded.total)} gross)</div>`;
                        for (const item of ded.items) {
                            html += `<div class="fbc-row deduction"><span>${item.label} (${item.rate}%)</span><span class="fbc-val negative">\u2212 ${fmtLocal(item.amount)}</span></div>`;
                        }
                        html += `<div style="font-size:0.72rem;color:var(--text-secondary);padding:6px 0 4px;font-style:italic;">Adult 2 (${fmtLocal(ded2.net + ded2.total)} gross)</div>`;
                        for (const item of ded2.items) {
                            html += `<div class="fbc-row deduction"><span>${item.label} (${item.rate}%)</span><span class="fbc-val negative">\u2212 ${fmtLocal(item.amount)}</span></div>`;
                        }
                        const combinedNet = ded.net + ded2.net;
                        html += `<div class="fbc-row subtotal"><span>Combined Take-Home</span><span class="fbc-val">${fmtLocal(combinedNet)}</span></div>`;
                    } else {
                        html += `<div class="fbc-section-label">Taxes &amp; Deductions<sup>2</sup></div>`;
                        for (const item of ded.items) {
                            html += `<div class="fbc-row deduction"><span>${item.label} (${item.rate}%)</span><span class="fbc-val negative">\u2212 ${fmtLocal(item.amount)}</span></div>`;
                        }
                        html += `<div class="fbc-row subtotal"><span>Take-Home Pay</span><span class="fbc-val">${fmtLocal(ded.net)}</span></div>`;
                    }

                    if (expenses) {
                        const rentLbl = expenses.rentLabel || '1BR';
                        html += `<div class="fbc-section-label">Living Expenses (Annual)<sup>1</sup></div>`;
                        if (expenses.hasRent) {
                            const rentBadge = compareExpenses ? pctBadge(compareExpenses.rent, expenses.rent) : '';
                            html += `<div class="fbc-row expense"><span>Rent (${rentLbl}) ${rentBadge}</span><span class="fbc-val negative">\u2212 ${fmtLocal(expenses.rent)}</span></div>`;
                        }
                        if (expenses.hasLivingCosts) {
                            const gBadge = compareExpenses ? pctBadge(compareExpenses.groceries, expenses.groceries) : '';
                            const uBadge = compareExpenses ? pctBadge(compareExpenses.utilities, expenses.utilities) : '';
                            const tBadge = compareExpenses ? pctBadge(compareExpenses.transport, expenses.transport) : '';
                            const hBadge = compareExpenses ? pctBadge(compareExpenses.healthcare, expenses.healthcare) : '';
                            html += `<div class="fbc-row expense"><span>Groceries ${gBadge}</span><span class="fbc-val negative">\u2212 ${fmtLocal(expenses.groceries)}</span></div>`;
                            html += `<div class="fbc-row expense"><span>Utilities ${uBadge}</span><span class="fbc-val negative">\u2212 ${fmtLocal(expenses.utilities)}</span></div>`;
                            html += `<div class="fbc-row expense"><span>Transport ${tBadge}</span><span class="fbc-val negative">\u2212 ${fmtLocal(expenses.transport)}</span></div>`;
                            html += `<div class="fbc-row expense"><span>Healthcare ${hBadge}</span><span class="fbc-val negative">\u2212 ${fmtLocal(expenses.healthcare)}</span></div>`;
                            if (hh && hh.children > 0 && expenses.childcare > 0) {
                                const cBadge = compareExpenses ? pctBadge(compareExpenses.childcare, expenses.childcare) : '';
                                const childLabel = hh.children === 1 ? 'Childcare (1 child)' : `Childcare (${hh.children} children)`;
                                html += `<div class="fbc-row expense"><span>${childLabel} ${cBadge}</span><span class="fbc-val negative">\u2212 ${fmtLocal(expenses.childcare)}</span></div>`;
                            }
                        }
                        if (disposable !== null) {
                            const dispLabel = (hh && hh.mode === 'family') ? 'Household Disposable Income' : 'Disposable Income';
                            html += `<div class="fbc-row total"><span>${dispLabel}</span><span class="fbc-val ${dispClass}">${fmtLocal(disposable)}</span></div>`;
                        }
                    }
                    html += `</div>`;
                    return html;
                }

                const currentDispForCard = hasFullData ? combinedCurrentTakeHome - currentExpenses.total : null;
                const targetDispForCard = hasFullData ? combinedTargetTakeHome - targetExpenses.total : null;

                // Determine gross amounts for cards
                const currentGrossForCard = isFamily2 ? (salary + salary2) : salary;
                const targetGrossForCard = household.remote
                    ? (isFamily2 ? (targetAdult1Gross + targetAdult2Gross) : targetAdult1Gross)
                    : (isFamily2 && !hasOffer ? (targetAdult1Gross + targetAdult2Gross) : affordabilitySalary);

                // Currency-convert current expenses to target currency for % comparison badges
                let compareExps = null;
                if (currentExpenses && targetExpenses) {
                    compareExps = {
                        rent: currentExpenses.rent * exchangeRate,
                        groceries: currentExpenses.groceries * exchangeRate,
                        utilities: currentExpenses.utilities * exchangeRate,
                        transport: currentExpenses.transport * exchangeRate,
                        healthcare: currentExpenses.healthcare * exchangeRate,
                        childcare: currentExpenses.childcare * exchangeRate,
                        total: currentExpenses.total * exchangeRate
                    };
                }

                const targetCardLabel = household.remote ? `${targetLabel} (same salary, local taxes)` : targetLabel;

                document.getElementById('breakdownCards').innerHTML =
                    buildFullBreakdownCard(currentLabel, currentGrossForCard, currentDed, currentDed2, currentExpenses, currentDispForCard, currentCurrency, false, household, null) +
                    buildFullBreakdownCard(targetCardLabel, targetGrossForCard, targetDed, targetDed2, targetExpenses, targetDispForCard, targetCurrency, hasOffer, household, compareExps);

                // Dynamic citations
                const COUNTRY_TAX_SOURCES = {
                    'US': {name: 'IRS', url: 'https://www.irs.gov/'},
                    'GB': {name: 'HMRC', url: 'https://www.gov.uk/government/organisations/hm-revenue-customs'},
                    'DE': {name: 'Bundesministerium der Finanzen', url: 'https://www.bundesfinanzministerium.de/'},
                    'FR': {name: 'Direction Générale des Finances Publiques', url: 'https://www.impots.gouv.fr/'},
                    'JP': {name: 'National Tax Agency', url: 'https://www.nta.go.jp/english/'},
                    'AU': {name: 'Australian Taxation Office', url: 'https://www.ato.gov.au/'},
                    'CA': {name: 'Canada Revenue Agency', url: 'https://www.canada.ca/en/revenue-agency.html'},
                    'SG': {name: 'IRAS', url: 'https://www.iras.gov.sg/'},
                    'AE': {name: 'Federal Tax Authority', url: 'https://tax.gov.ae/'},
                    'CH': {name: 'Federal Tax Administration', url: 'https://www.estv.admin.ch/'},
                    'NL': {name: 'Belastingdienst', url: 'https://www.belastingdienst.nl/'},
                    'ES': {name: 'Agencia Tributaria', url: 'https://www.agenciatributaria.es/'},
                    'IT': {name: 'Agenzia delle Entrate', url: 'https://www.agenziaentrate.gov.it/'},
                    'KR': {name: 'National Tax Service', url: 'https://www.nts.go.kr/'},
                    'SE': {name: 'Skatteverket', url: 'https://www.skatteverket.se/'},
                    'NO': {name: 'Skatteetaten', url: 'https://www.skatteetaten.no/'},
                    'DK': {name: 'Skattestyrelsen', url: 'https://skat.dk/'},
                    'IN': {name: 'Income Tax Department', url: 'https://www.incometax.gov.in/'},
                    'BR': {name: 'Receita Federal', url: 'https://www.gov.br/receitafederal/'},
                    'MX': {name: 'SAT', url: 'https://www.sat.gob.mx/'},
                    'HK': {name: 'Inland Revenue Department', url: 'https://www.ird.gov.hk/'},
                    'NZ': {name: 'Inland Revenue', url: 'https://www.ird.govt.nz/'},
                    'IE': {name: 'Revenue Commissioners', url: 'https://www.revenue.ie/'},
                    'AT': {name: 'BMF Austria', url: 'https://www.bmf.gv.at/'},
                    'BE': {name: 'SPF Finances', url: 'https://finances.belgium.be/'},
                    'PL': {name: 'KAS', url: 'https://www.podatki.gov.pl/'},
                    'CZ': {name: 'Finanční správa', url: 'https://www.financnisprava.cz/'},
                    'PT': {name: 'Autoridade Tributária', url: 'https://www.portaldasfinancas.gov.pt/'},
                    'TH': {name: 'Revenue Department', url: 'https://www.rd.go.th/'},
                    'MY': {name: 'LHDN', url: 'https://www.hasil.gov.my/'},
                    'PH': {name: 'Bureau of Internal Revenue', url: 'https://www.bir.gov.ph/'},
                    'ID': {name: 'DJP', url: 'https://www.pajak.go.id/'},
                    'VN': {name: 'General Dept. of Taxation', url: 'https://www.gdt.gov.vn/'},
                    'TW': {name: 'National Taxation Bureau', url: 'https://www.ntbt.gov.tw/'},
                    'IL': {name: 'Israel Tax Authority', url: 'https://taxes.gov.il/'},
                    'ZA': {name: 'SARS', url: 'https://www.sars.gov.za/'},
                    'TR': {name: 'Revenue Administration', url: 'https://www.gib.gov.tr/'},
                    'QA': {name: 'General Tax Authority', url: 'https://www.gta.gov.qa/'},
                    'SA': {name: 'ZATCA', url: 'https://zatca.gov.sa/'},
                    'EG': {name: 'Egyptian Tax Authority', url: 'https://www.eta.gov.eg/'},
                    'KE': {name: 'KRA', url: 'https://www.kra.go.ke/'},
                    'NG': {name: 'FIRS', url: 'https://www.firs.gov.ng/'},
                    'CO': {name: 'DIAN', url: 'https://www.dian.gov.co/'},
                    'CL': {name: 'SII', url: 'https://www.sii.cl/'},
                    'PE': {name: 'SUNAT', url: 'https://www.sunat.gob.pe/'},
                    'AR': {name: 'AFIP', url: 'https://www.afip.gob.ar/'},
                    'RO': {name: 'ANAF', url: 'https://www.anaf.ro/'},
                    'HU': {name: 'NAV', url: 'https://nav.gov.hu/'},
                    'PA': {name: 'DGI Panama', url: 'https://dgi.mef.gob.pa/'},
                    'CN': {name: 'State Taxation Administration', url: 'https://www.chinatax.gov.cn/'},
                };
                const cSrc = COUNTRY_TAX_SOURCES[currentCountry] || {name: 'Local tax authority', url: '#'};
                const tSrc = COUNTRY_TAX_SOURCES[targetCountry] || {name: 'Local tax authority', url: '#'};
                let citationHtml = '<div class="citation-sources"><strong>Data Sources:</strong><ul>';
                citationHtml += '<li><sup>1</sup> Rent &amp; Living Costs: <a href="https://www.numbeo.com/cost-of-living/" target="_blank" rel="noopener">Numbeo Cost of Living Index</a> (2025)</li>';
                citationHtml += `<li><sup>2</sup> Tax Rates: <a href="${cSrc.url}" target="_blank" rel="noopener">${cSrc.name}</a>`;
                if (targetCountry !== currentCountry) {
                    citationHtml += ` &amp; <a href="${tSrc.url}" target="_blank" rel="noopener">${tSrc.name}</a>`;
                }
                citationHtml += ' (2025/26 rates)</li>';
                citationHtml += '<li><sup>3</sup> Exchange Rates: <a href="https://www.ecb.europa.eu/stats/policy_and_exchange_rates/euro_reference_exchange_rates/" target="_blank" rel="noopener">European Central Bank (ECB)</a></li>';
                citationHtml += '<li>Cost of Living Index: <a href="https://www.numbeo.com/cost-of-living/" target="_blank" rel="noopener">Numbeo</a> &amp; <a href="https://www.oecdbetterlifeindex.org/" target="_blank" rel="noopener">OECD Better Life Index</a></li>';
                citationHtml += '</ul></div>';

                const noteEl = document.getElementById('breakdownNote');
                if (!hasFullData) {
                    noteEl.innerHTML = 'Full living cost data not available for one or both cities. Tax comparison shown only.' + citationHtml;
                } else {
                    noteEl.innerHTML = 'All living costs adjusted for neighborhood. Annual estimates based on city averages.' + citationHtml;
                }
                breakdownSection.style.display = '';
            } else {
                breakdownSection.style.display = 'none';
            }

            // === 5. OFFER COMPARISON ===
            const offerCompEl = document.getElementById('offerComparison');
            if (hasOffer && !household.remote) {
                const formattedOffer = formatter.format(targetSalaryOffer);
                const formattedTrueEquiv = formatter.format(trueEquivalentSalary);
                const offerVsTrue = ((targetSalaryOffer - trueEquivalentSalary) / trueEquivalentSalary) * 100;
                const offerAbsPct = Math.abs(offerVsTrue).toFixed(0);
                let offerLine;
                if (offerVsTrue > 2) {
                    offerLine = `Your target salary of ${formattedOffer} is <span class="offer-above">${offerAbsPct}% above</span> the true equivalent of ${formattedTrueEquiv}. You'd come out ahead.`;
                } else if (offerVsTrue < -2) {
                    offerLine = `Your target salary of ${formattedOffer} is <span class="offer-below">${offerAbsPct}% below</span> the true equivalent of ${formattedTrueEquiv}. You'd have less disposable income than today.`;
                } else {
                    offerLine = `Your target salary of ${formattedOffer} is <span class="offer-match">within ${offerAbsPct}%</span> of the true equivalent ${formattedTrueEquiv}. Essentially a match.`;
                }
                // Show per-adult breakdown for family 2-adult mode
                if (isFamily2 && offer1 !== null && offer2 !== null) {
                    offerLine += `<div style="font-size:0.8rem;color:var(--text-secondary);margin-top:4px;">Adult 1: ${formatter.format(offer1)} + Adult 2: ${formatter.format(offer2)}</div>`;
                }
                offerCompEl.innerHTML = offerLine;
                offerCompEl.style.display = '';
            } else {
                offerCompEl.style.display = 'none';
            }

            // === 7. HOW WE CALCULATED THIS ===
            let explanation;
            if (household.remote) {
                const salaryDesc = isFamily2
                    ? `Adult 1: ${fmtCurr(salary, currentCurrency)} + Adult 2: ${fmtCurr(salary2, currentCurrency)} (${formattedOriginalCurrent} total)`
                    : `${formattedOriginalCurrent} in ${currentLabel} (${currentCurrency})`;
                const convertedDesc = `${formattedAmount} (${targetCurrency}) at ${exchangeRate.toFixed(4)} exchange rate`;
                const targetDedDesc = isFamily2
                    ? `Adult 1: ${targetDed ? targetDed.totalRate + '%' : '?'}, Adult 2: ${targetDed2 ? targetDed2.totalRate + '%' : '?'} \u2192 combined take-home ${fmtCurr(combinedTargetTakeHome, targetCurrency)}`
                    : `${targetDed ? targetDed.totalRate + '% in taxes & social charges' : 'Tax data not available'}, leaving ${targetDed ? fmtCurr(targetDed.net, targetCurrency) + ' take-home' : 'unknown take-home'}`;
                const currentDispDesc = hasFullData ? fmtCurr(currentDisposable, currentCurrency) + '/yr' : 'Cannot calculate';
                const targetDispDesc = hasFullData && targetDisposable !== null ? fmtCurr(targetDisposable, targetCurrency) + '/yr' : 'Cannot calculate';

                explanation = `
                    <div class="explanation-title">How we calculated this</div>
                    <div class="explanation-step">
                        <div class="step-number">1</div>
                        <div class="step-text"><strong>${isFamily ? 'Household income:' : 'Your salary:'}</strong> ${salaryDesc}</div>
                    </div>
                    <div class="explanation-step">
                        <div class="step-number">2</div>
                        <div class="step-text"><strong>Current city taxes:</strong> ${isFamily2
                            ? `Adult 1: ${currentDed ? currentDed.totalRate + '%' : '?'}, Adult 2: ${currentDed2 ? currentDed2.totalRate + '%' : '?'} \u2192 combined take-home ${fmtCurr(combinedCurrentTakeHome, currentCurrency)}`
                            : `${currentDed ? currentDed.totalRate + '% in taxes' : '?'}, leaving ${fmtCurr(combinedCurrentTakeHome, currentCurrency)} take-home`}</div>
                    </div>
                    <div class="explanation-step">
                        <div class="step-number">3</div>
                        <div class="step-text"><strong>Current expenses:</strong> ${currentExpenses ? fmtCurr(currentExpenses.total, currentCurrency) + '/yr' : 'N/A'} \u2192 <strong>Current disposable:</strong> ${currentDispDesc}</div>
                    </div>
                    <div class="explanation-step">
                        <div class="step-number">4</div>
                        <div class="step-text"><strong>Same salary converted:</strong> ${convertedDesc}</div>
                    </div>
                    <div class="explanation-step">
                        <div class="step-number">5</div>
                        <div class="step-text"><strong>Target city taxes:</strong> ${targetDedDesc}</div>
                    </div>
                    <div class="explanation-step">
                        <div class="step-number">6</div>
                        <div class="step-text"><strong>Target expenses:</strong> ${targetExpenses ? fmtCurr(targetExpenses.total, targetCurrency) + '/yr' : 'N/A'} \u2192 <strong>Target disposable:</strong> ${targetDispDesc}</div>
                    </div>
                `;
            } else {
                const salaryDesc = isFamily2
                    ? `Adult 1: ${fmtCurr(salary, currentCurrency)} + Adult 2: ${fmtCurr(salary2, currentCurrency)} (${formattedOriginalCurrent} total)`
                    : `${formattedOriginalCurrent} in ${currentLabel} (${currentCurrency})`;
                const dedDesc = isFamily2
                    ? `Adult 1: ${currentDed ? currentDed.totalRate + '%' : '?'}, Adult 2: ${currentDed2 ? currentDed2.totalRate + '%' : '?'} \u2192 combined take-home ${fmtCurr(combinedCurrentTakeHome, currentCurrency)}`
                    : `${currentDed ? currentDed.totalRate + '% in taxes & social charges' : 'Tax data not available'}, leaving ${currentDed ? fmtCurr(currentDed.net, currentCurrency) + ' take-home' : 'unknown take-home'}`;
                const expDesc = currentExpenses ? `${fmtCurr(currentExpenses.total, currentCurrency)}/yr in ${currentExpenses.rentLabel || '1BR'} rent and living costs${household.children > 0 ? ' (incl. childcare for ' + household.children + ')' : ''}` : 'Expense data not available';
                const grossDesc = isFamily2
                    ? `Adult 1 needs <strong>${fmtCurr(targetAdult1Gross || 0, targetCurrency)}</strong> + Adult 2 needs <strong>${fmtCurr(targetAdult2Gross || 0, targetCurrency)}</strong> = <strong>${formattedAmount}</strong>`
                    : `you need a gross salary of <strong>${formattedAmount}</strong>`;

                explanation = `
                    <div class="explanation-title">How we calculated this</div>
                    <div class="explanation-step">
                        <div class="step-number">1</div>
                        <div class="step-text"><strong>${isFamily ? 'Household income:' : 'Your salary:'}</strong> ${salaryDesc}</div>
                    </div>
                    <div class="explanation-step">
                        <div class="step-number">2</div>
                        <div class="step-text"><strong>Current deductions:</strong> ${dedDesc}</div>
                    </div>
                    <div class="explanation-step">
                        <div class="step-number">3</div>
                        <div class="step-text"><strong>Current expenses:</strong> ${expDesc}</div>
                    </div>
                    <div class="explanation-step">
                        <div class="step-number">4</div>
                        <div class="step-text"><strong>${isFamily ? 'Household' : 'Your'} disposable income:</strong> ${hasFullData ? fmtCurr(currentDisposable, currentCurrency) + '/yr \u2014 this is what we match in ' + targetCity : 'Cannot calculate \u2014 incomplete data'}</div>
                    </div>
                    <div class="explanation-step">
                        <div class="step-number">5</div>
                        <div class="step-text"><strong>Target city expenses:</strong> ${targetExpenses ? targetExpenses.rentLabel + ' rent + living costs in ' + targetLabel + ' total ' + fmtCurr(targetExpenses.total, targetCurrency) + '/yr' : 'unknown'}</div>
                    </div>
                    <div class="explanation-step">
                        <div class="step-number">6</div>
                        <div class="step-text"><strong>Target take-home needed:</strong> ${hasFullData ? fmtCurr(currentDisposable * exchangeRate + targetExpenses.total, targetCurrency) + ' (' + fmtCurr(currentDisposable * exchangeRate, targetCurrency) + ' disposable + ' + fmtCurr(targetExpenses.total, targetCurrency) + ' expenses)' : 'Cannot calculate'}</div>
                    </div>
                    <div class="explanation-step">
                        <div class="step-number">7</div>
                        <div class="step-text"><strong>Reverse-engineer gross:</strong> To take home ${hasFullData ? fmtCurr(currentDisposable * exchangeRate + targetExpenses.total, targetCurrency) : '?'} in ${targetCity}, ${grossDesc}</div>
                    </div>
                `;
            }
            document.getElementById('explanationSection').innerHTML = explanation;

            // === 8. COLI REFERENCE (demoted) ===
            const coliRef = document.getElementById('coliReference');
            document.getElementById('coliRefAmount').textContent = formatter.format(coliEquivalentSalary);
            coliRef.style.display = '';

            // === SALARY RANGES BY JOB TITLE ===
            const rangesSection = document.getElementById('salaryRangesSection');
            const rangesList = document.getElementById('rangesList');
            let rangesHTML = '';

            const targetExRate = exchangeRates[targetCurrency] / exchangeRates['USD'];
            const targetColiAdj = coliData[targetCity] / 100; // relative to NY

            Object.entries(salaryRanges).forEach(([title, range]) => {
                const adjLow = range.low * targetColiAdj * targetExRate;
                const adjMid = range.mid * targetColiAdj * targetExRate;
                const adjHigh = range.high * targetColiAdj * targetExRate;

                const fmtLow = new Intl.NumberFormat('en-US', {
                    style: 'currency', currency: targetCurrency,
                    minimumFractionDigits: 0, maximumFractionDigits: 0, notation: 'compact'
                }).format(adjLow);
                const fmtMid = new Intl.NumberFormat('en-US', {
                    style: 'currency', currency: targetCurrency,
                    minimumFractionDigits: 0, maximumFractionDigits: 0, notation: 'compact'
                }).format(adjMid);
                const fmtHigh = new Intl.NumberFormat('en-US', {
                    style: 'currency', currency: targetCurrency,
                    minimumFractionDigits: 0, maximumFractionDigits: 0, notation: 'compact'
                }).format(adjHigh);

                // Bar position: low-high range within 0-maxHigh
                const maxHigh = Math.max(...Object.values(salaryRanges).map(r => r.high * targetColiAdj * targetExRate));
                const barLeft = (adjLow / maxHigh) * 100;
                const barWidth = ((adjHigh - adjLow) / maxHigh) * 100;

                rangesHTML += `
                    <div class="range-item">
                        <div class="range-item-title">${title}</div>
                        <div class="range-item-bar">
                            <div class="range-item-bar-fill" style="left: ${barLeft}%; width: ${barWidth}%;"></div>
                        </div>
                        <div class="range-item-mid">${fmtMid}</div>
                        <div class="range-item-values">
                            <span>${fmtLow}</span>
                            <span>${fmtHigh}</span>
                        </div>
                    </div>
                `;
            });

            rangesList.innerHTML = rangesHTML;
            rangesSection.style.display = '';

            // Cap salary ranges to 3 rows
            const rangeItems = rangesList.querySelectorAll('.range-item');
            const totalItems = rangeItems.length;
            const isMobile = window.innerWidth <= 768;
            const visibleCount = 3 * (isMobile ? 1 : 2);
            const rangesToggle = document.getElementById('rangesToggle');
            const rangesToggleText = document.getElementById('rangesToggleText');

            if (totalItems > visibleCount) {
                rangeItems.forEach((item, i) => {
                    if (i >= visibleCount) item.style.display = 'none';
                });
                rangesToggle.style.display = 'flex';
                rangesToggle.classList.remove('expanded');
                rangesToggleText.textContent = `Show all ${totalItems} roles`;
            } else {
                rangesToggle.style.display = 'none';
            }

            // Update URL with parameters for sharing
            const shareParams = new URLSearchParams();
            shareParams.set('from', currentCity);
            shareParams.set('to', targetCity);
            shareParams.set('salary', salary);
            if (currentNeighborhood) shareParams.set('fromN', currentNeighborhood);
            if (targetNeighborhood) shareParams.set('toN', targetNeighborhood);
            if (hasOffer) {
                if (isFamily2 && offer1 !== null && offer2 !== null) {
                    shareParams.set('offer1', offer1);
                    shareParams.set('offer2', offer2);
                } else {
                    shareParams.set('offer', targetSalaryOffer);
                }
            }
            if (household.mode === 'family') {
                shareParams.set('mode', 'family');
                shareParams.set('adults', household.adults);
                shareParams.set('children', household.children);
                if (salary2) shareParams.set('salary2', salary2);
            }
            if (household.remote) shareParams.set('remote', '1');
            history.replaceState(null, '', '?' + shareParams.toString());

            // Populate share bar
            const shareBar = document.getElementById('resultShareBar');
            const shareUrl = window.location.origin + '/?' + shareParams.toString();
            const currentLabel2 = currentNeighborhood ? currentNeighborhood + ', ' + currentCity : currentCity;
            const targetLabel2 = targetNeighborhood ? targetNeighborhood + ', ' + targetCity : targetCity;
            const shareText = household.remote
                ? 'My ' + formattedOriginalCurrent + ' salary goes ' + (targetDisposable > currentDisposable * exchangeRate ? 'further' : 'less far') + ' in ' + targetLabel2 + ' \u2014 salary:converter'
                : 'My ' + formattedOriginalCurrent + ' in ' + currentLabel2 + ' needs ' + formattedAmount + ' in ' + targetLabel2 + ' (after taxes & living costs) \u2014 salary:converter';
            shareBar.setAttribute('data-share-text', shareText);
            shareBar.setAttribute('data-share-url', shareUrl);

            // Show result and scroll into view
            const resultBox = document.getElementById('resultBox');
            resultBox.classList.add('show');
            setTimeout(() => {
                resultBox.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        });

        // Reset form
        document.getElementById('resetBtn').addEventListener('click', () => {
            document.getElementById('currentSalary').value = '';
            document.getElementById('currentCity').value = '';
            document.getElementById('currentCurrency').value = '';
            document.getElementById('targetCity').value = '';
            document.getElementById('targetCurrency').value = '';
            document.getElementById('currentNeighborhood').value = '';
            document.getElementById('targetNeighborhood').value = '';
            document.getElementById('currentNeighborhoodGroup').style.display = 'none';
            document.getElementById('targetNeighborhoodGroup').style.display = 'none';
            document.getElementById('targetSalary').value = '';
            document.getElementById('offer1Salary').value = '';
            document.getElementById('offer2Salary').value = '';
            document.getElementById('offerComparison').style.display = 'none';
            document.getElementById('resultBox').classList.remove('show');
            document.getElementById('salaryRangesSection').style.display = 'none';
            document.querySelectorAll('.quick-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('.currency-hint').forEach(h => h.classList.remove('show'));
            // Reset household state
            setHouseholdMode('single');
            householdState.adults = 2; householdState.children = 1;
            householdState.remote = false;
            document.getElementById('remoteCheckbox').checked = false;
            document.querySelectorAll('#adultsChips .chip').forEach(c => { c.classList.toggle('active', c.dataset.value === '2'); });
            document.querySelectorAll('#childrenChips .chip').forEach(c => { c.classList.toggle('active', c.dataset.value === '1'); });
            document.getElementById('adult1Salary').value = '';
            document.getElementById('adult2Salary').value = '';
            history.replaceState(null, '', window.location.pathname);
        });

        // Allow Enter key to calculate
        document.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !document.activeElement.closest('.chat-panel')) {
                document.getElementById('calculateBtn').click();
            }
        });

        // Dark mode toggle
        (function(){
            var t=document.getElementById('themeToggle');
            function g(){var s=localStorage.getItem('theme');if(s)return s;return matchMedia('(prefers-color-scheme:dark)').matches?'dark':'light'}
            function a(m){document.documentElement.setAttribute('data-theme',m);localStorage.setItem('theme',m);t.setAttribute('aria-label',m==='dark'?'Switch to light mode':'Switch to dark mode')}
            a(g());
            t.addEventListener('click',function(){a(document.documentElement.getAttribute('data-theme')==='dark'?'light':'dark')});
            matchMedia('(prefers-color-scheme:dark)').addEventListener('change',function(e){if(!localStorage.getItem('theme'))a(e.matches?'dark':'light')});
        })();

        // === NAV BURGER MENU (mobile) ===
        const navBurger = document.getElementById('navBurger');
        const navDropdown = document.getElementById('navDropdown');

        navBurger.addEventListener('click', (e) => {
            e.stopPropagation();
            navDropdown.classList.toggle('open');
        });

        document.addEventListener('click', (e) => {
            if (!navDropdown.contains(e.target) && e.target !== navBurger) {
                navDropdown.classList.remove('open');
            }
        });

        // === SIDEBAR BURGER MENU (mobile) ===
        const sidebarBurger = document.getElementById('sidebarBurger');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        const sidebar = document.querySelector('.sidebar');

        function toggleSidebar() {
            const isOpen = sidebar.classList.contains('open');
            if (isOpen) {
                sidebar.classList.remove('open');
                sidebarOverlay.classList.remove('show');
                sidebarBurger.classList.remove('active');
            } else {
                sidebar.classList.add('open');
                sidebarOverlay.classList.add('show');
                sidebarBurger.classList.add('active');
            }
        }

        sidebarBurger.addEventListener('click', toggleSidebar);
        sidebarOverlay.addEventListener('click', toggleSidebar);

        // === SIDEBAR COMPONENTS ===

        // === BLOG SIDEBAR: show 3 random articles on each page load ===
        (function() {
            const articles = Array.from(document.querySelectorAll('[data-blog-article]'));
            // Shuffle using Fisher-Yates
            for (let i = articles.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [articles[i], articles[j]] = [articles[j], articles[i]];
            }
            // Hide all, then show first 3
            articles.forEach(a => a.style.display = 'none');
            articles.slice(0, 3).forEach(a => a.style.display = '');
        })();

        // Share bar click handlers
        document.querySelectorAll('.share-bar .share-btn').forEach(function(btn){
            btn.addEventListener('click', function(){
                var bar = btn.closest('.share-bar');
                var text = bar.getAttribute('data-share-text');
                var url = bar.getAttribute('data-share-url');
                var p = btn.getAttribute('data-platform');
                var enc = encodeURIComponent(text + '\n' + url);
                if(p==='twitter') window.open('https://twitter.com/intent/tweet?text='+encodeURIComponent(text)+'&url='+encodeURIComponent(url),'_blank','width=550,height=420');
                else if(p==='linkedin') window.open('https://www.linkedin.com/sharing/share-offsite/?url='+encodeURIComponent(url),'_blank','width=550,height=420');
                else if(p==='whatsapp') window.open('https://wa.me/?text='+enc,'_blank');
                else if(p==='email') window.location.href='mailto:?subject='+encodeURIComponent(text)+'&body='+enc;
                else if(p==='copy'){navigator.clipboard.writeText(url).then(function(){btn.classList.add('copied');setTimeout(function(){btn.classList.remove('copied')},2000)})}
            });
        });

        // Initialize
        populateSelects();
        createQuickButtons();

        // Populate family city dropdown (mirrors currentCity)
        (function(){
            const fc = document.getElementById('familyCity');
            const cc = document.getElementById('currentCity');
            for (const opt of cc.options) {
                const o = document.createElement('option');
                o.value = opt.value; o.textContent = opt.textContent;
                fc.appendChild(o);
            }
            // Sync family city changes with neighborhoods
            fc.addEventListener('change', function() {
                cc.value = fc.value;
                cc.dispatchEvent(new Event('change'));
            });
            cc.addEventListener('change', function() {
                fc.value = cc.value;
            });
        })();

        // Household mode toggle listeners
        document.querySelectorAll('#householdModeToggle .mode-btn').forEach(btn => {
            btn.addEventListener('click', () => setHouseholdMode(btn.dataset.mode));
        });
        document.querySelectorAll('#adultsChips .chip').forEach(chip => {
            chip.addEventListener('click', () => {
                document.querySelectorAll('#adultsChips .chip').forEach(c => c.classList.remove('active'));
                chip.classList.add('active');
                householdState.adults = parseInt(chip.dataset.value);
                updateSalaryFields();
            });
        });
        document.querySelectorAll('#childrenChips .chip').forEach(chip => {
            chip.addEventListener('click', () => {
                document.querySelectorAll('#childrenChips .chip').forEach(c => c.classList.remove('active'));
                chip.classList.add('active');
                householdState.children = parseInt(chip.dataset.value);
            });
        });

        // Remote worker checkbox
        document.getElementById('remoteCheckbox').addEventListener('change', function() {
            householdState.remote = this.checked;
            updateSalaryFields();
        });

        // Format adult salary inputs with commas
        ['adult1Salary', 'adult2Salary'].forEach(id => {
            document.getElementById(id).addEventListener('input', (e) => {
                let value = e.target.value.replace(/,/g, '').replace(/[^\d.]/g, '');
                if (value === '') { e.target.value = ''; return; }
                const parts = value.split('.');
                let intPart = parts[0].replace(/^0+(?=\d)/, '');
                let formatted = Number(intPart).toLocaleString('en-US');
                if (parts[1] !== undefined) formatted += '.' + parts[1].slice(0, 2);
                e.target.value = formatted;
            });
        });

        // Contact modal open/close
        function openContactModal() {
            document.getElementById('contactOverlay').classList.add('open');
            document.body.style.overflow = 'hidden';
            // Close burger menu if open
            const dd = document.getElementById('navDropdown');
            if (dd) dd.classList.remove('open');
        }
        function closeContactModal() {
            document.getElementById('contactOverlay').classList.remove('open');
            document.body.style.overflow = '';
        }
        // Close on overlay background click
        document.getElementById('contactOverlay').addEventListener('click', function(e) {
            if (e.target === this) closeContactModal();
        });
        // Close on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && document.getElementById('contactOverlay').classList.contains('open')) {
                closeContactModal();
            }
        });

        // Contact form handler (Web3Forms)
        const contactForm = document.getElementById('contactForm');
        if (contactForm) {
            contactForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                const btn = contactForm.querySelector('button[type="submit"]');
                const origText = btn.textContent;
                btn.textContent = 'Sending...'; btn.disabled = true;
                try {
                    const resp = await fetch('https://api.web3forms.com/submit', {
                        method: 'POST', body: new FormData(contactForm),
                        headers: { 'Accept': 'application/json' }
                    });
                    if (resp.ok) {
                        contactForm.style.display = 'none';
                        document.getElementById('contactSuccess').style.display = '';
                    } else {
                        btn.textContent = 'Error \u2014 Try Again'; btn.disabled = false;
                        setTimeout(() => { btn.textContent = origText; }, 3000);
                    }
                } catch(err) {
                    btn.textContent = 'Error \u2014 Try Again'; btn.disabled = false;
                    setTimeout(() => { btn.textContent = origText; }, 3000);
                }
            });
        }

        // URL parameter support — auto-populate and calculate from shared links
        (function(){
            var params = new URLSearchParams(window.location.search);
            var from = params.get('from'), to = params.get('to'), sal = params.get('salary');
            // Restore household mode from URL
            var mode = params.get('mode');
            if (mode === 'family') {
                setHouseholdMode('family');
                var adults = parseInt(params.get('adults')) || 2;
                var children = parseInt(params.get('children')) || 1;
                householdState.adults = adults;
                householdState.children = children;
                document.querySelectorAll('#adultsChips .chip').forEach(c => { c.classList.toggle('active', parseInt(c.dataset.value) === adults); });
                document.querySelectorAll('#childrenChips .chip').forEach(c => { c.classList.toggle('active', parseInt(c.dataset.value) === children); });
                updateSalaryFields();
                var sal2 = params.get('salary2');
                if (adults === 2 && sal && sal2) {
                    document.getElementById('adult1Salary').value = sal;
                    document.getElementById('adult2Salary').value = sal2;
                }
            }
            // Restore remote mode from URL
            var remote = params.get('remote');
            if (remote === '1') {
                document.getElementById('remoteCheckbox').checked = true;
                householdState.remote = true;
                updateSalaryFields();
            }
            if (from && to && sal) {
                document.getElementById('currentCity').value = from;
                document.getElementById('currentCity').dispatchEvent(new Event('change'));
                document.getElementById('targetCity').value = to;
                document.getElementById('targetCity').dispatchEvent(new Event('change'));
                if (!(mode === 'family' && (parseInt(params.get('adults')) || 2) === 2)) {
                    document.getElementById('currentSalary').value = sal;
                }
                var fromN = params.get('fromN'), toN = params.get('toN');
                var offer = params.get('offer'), offer1Param = params.get('offer1'), offer2Param = params.get('offer2');
                setTimeout(function(){
                    if (fromN) document.getElementById('currentNeighborhood').value = fromN;
                    if (toN) document.getElementById('targetNeighborhood').value = toN;
                    if (offer) document.getElementById('targetSalary').value = offer;
                    if (offer1Param) document.getElementById('offer1Salary').value = offer1Param;
                    if (offer2Param) document.getElementById('offer2Salary').value = offer2Param;
                    window._fromUrlParams = true;
                    document.getElementById('calculateBtn').click();
                }, 150);
            }
        })();

    </script>
    <script src="/chat.js?v=2"></script>
</body>
</html>
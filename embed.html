<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Salary Converter Widget</title>
    <style>
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #ffffff;
            color: #1d1d1f;
            padding: 20px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .widget-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .widget-logo {
            font-size: 1.4rem;
            font-weight: 700;
            letter-spacing: -0.5px;
            color: #1d1d1f;
            text-decoration: none;
            display: inline-block;
            transition: opacity 0.2s;
        }

        .widget-logo:hover {
            opacity: 0.7;
        }

        .widget-logo span {
            color: #2563eb;
        }

        .widget-subtitle {
            font-size: 0.75rem;
            color: #86868b;
            margin-top: 4px;
        }

        .form-group {
            margin-bottom: 14px;
        }

        .form-label {
            display: block;
            font-size: 0.7rem;
            font-weight: 600;
            color: #86868b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        input, select {
            width: 100%;
            padding: 10px 12px;
            border: 1.5px solid #d2d2d7;
            border-radius: 10px;
            font-size: 0.85rem;
            font-family: inherit;
            color: #1d1d1f;
            background: #ffffff;
            transition: border-color 0.2s, box-shadow 0.2s;
            -webkit-appearance: none;
            appearance: none;
        }

        select {
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%2386868b' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 32px;
        }

        input:focus, select:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .salary-input {
            font-size: 1rem;
            font-weight: 600;
            letter-spacing: -0.3px;
        }

        .currency-hint {
            font-size: 0.7rem;
            color: #2563eb;
            margin-top: 4px;
            min-height: 16px;
        }

        .neighborhood-group {
            display: none;
            margin-top: 8px;
        }

        .neighborhood-group select {
            font-size: 0.8rem;
            padding: 8px 12px;
            border-color: #e8e8ed;
        }

        .section-divider {
            border: none;
            border-top: 1px solid #e8e8ed;
            margin: 16px 0;
        }

        .btn-calculate {
            width: 100%;
            padding: 12px;
            background: #2563eb;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: background 0.2s, transform 0.1s;
        }

        .btn-calculate:hover {
            background: #1d4ed8;
        }

        .btn-calculate:active {
            transform: scale(0.98);
        }

        .result-box {
            display: none;
            margin-top: 16px;
            padding: 16px;
            background: #f5f5f7;
            border-radius: 14px;
            text-align: center;
            animation: slideIn 0.4s ease-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(8px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-label {
            font-size: 0.7rem;
            font-weight: 600;
            color: #86868b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .result-amount {
            font-size: 1.5rem;
            font-weight: 700;
            color: #1d1d1f;
            letter-spacing: -0.5px;
        }

        .result-breakdown {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .breakdown-stat {
            text-align: center;
        }

        .breakdown-stat-value {
            font-size: 0.8rem;
            font-weight: 600;
            color: #1d1d1f;
        }

        .breakdown-stat-label {
            font-size: 0.65rem;
            color: #86868b;
        }

        .result-note {
            font-size: 0.75rem;
            color: #86868b;
            margin-top: 10px;
            line-height: 1.4;
        }

        .result-note strong {
            color: #2563eb;
            font-weight: 600;
        }

        .error-msg {
            display: none;
            background: #fef2f2;
            color: #dc2626;
            padding: 10px 14px;
            border-radius: 10px;
            font-size: 0.8rem;
            margin-bottom: 12px;
            text-align: center;
        }

        .widget-footer {
            text-align: center;
            margin-top: 18px;
            padding-top: 14px;
            border-top: 1px solid #e8e8ed;
        }

        .widget-footer a {
            font-size: 0.7rem;
            color: #86868b;
            text-decoration: none;
            transition: color 0.2s;
        }

        .widget-footer a:hover {
            color: #2563eb;
        }

        .widget-footer a strong {
            color: #1d1d1f;
            font-weight: 600;
        }

        .widget-footer a strong span {
            color: #2563eb;
        }

        .widget-footer-links {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 8px;
        }

        .widget-footer-links a {
            font-size: 0.65rem;
            color: #aeaeb2;
            text-decoration: none;
        }

        .widget-footer-links a:hover {
            color: #2563eb;
        }

        /* === TAX SECTION === */
        .tax-section {
            display: none;
            margin-top: 14px;
            padding-top: 14px;
            border-top: 1px solid #e8e8ed;
        }

        .section-title {
            font-size: 0.65rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.6px;
            color: #86868b;
            margin-bottom: 10px;
        }

        .tax-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .tax-card {
            background: #ffffff;
            border: 1px solid #e8e8ed;
            border-radius: 10px;
            padding: 10px;
            text-align: center;
        }

        .tax-card-city {
            font-size: 0.7rem;
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 4px;
        }

        .tax-card-gross, .tax-card-rate {
            font-size: 0.65rem;
            color: #86868b;
        }

        .tax-card-net {
            font-size: 1rem;
            font-weight: 700;
            color: #2563eb;
            margin-top: 4px;
        }

        .tax-card-label {
            font-size: 0.6rem;
            color: #86868b;
        }

        /* === CHART SECTION === */
        .chart-section {
            display: none;
            margin-top: 14px;
            padding-top: 14px;
            border-top: 1px solid #e8e8ed;
        }

        .chart-bar-row {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 6px;
        }

        .chart-bar-label {
            font-size: 0.65rem;
            font-weight: 500;
            color: #86868b;
            width: 70px;
            text-align: right;
            flex-shrink: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .chart-bar-track {
            flex: 1;
            height: 22px;
            background: #e8e8ed;
            border-radius: 6px;
            overflow: hidden;
        }

        .chart-bar-fill {
            height: 100%;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 6px;
            font-size: 0.6rem;
            font-weight: 600;
            color: white;
            min-width: 60px;
            transition: width 0.5s ease;
        }

        .chart-bar-fill.current {
            background: linear-gradient(90deg, #2563eb, #60a5fa);
        }

        .chart-bar-fill.target {
            background: linear-gradient(90deg, #8b5cf6, #c084fc);
        }

        .chart-bar-fill.tax-current {
            background: linear-gradient(90deg, #059669, #34d399);
        }

        .chart-bar-fill.tax-target {
            background: linear-gradient(90deg, #f59e0b, #fbbf24);
        }

        /* === EXPLANATION SECTION === */
        .explanation-section {
            display: none;
            margin-top: 14px;
            padding-top: 14px;
            border-top: 1px solid #e8e8ed;
        }

        .explanation-step {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
            font-size: 0.75rem;
            line-height: 1.4;
            color: #48484a;
        }

        .explanation-step:last-child {
            margin-bottom: 0;
        }

        .step-num {
            flex-shrink: 0;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #2563eb;
            color: white;
            font-size: 0.6rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 1px;
        }

        .step-text strong {
            color: #1d1d1f;
        }
    </style>
</head>
<body>

    <div class="widget-header">
        <a href="https://salary-converter.com" target="_blank" rel="noopener" class="widget-logo">salary<span>:</span>converter</a>
        <div class="widget-subtitle">Compare salaries across 101 cities & 2,100+ neighborhoods</div>
    </div>

    <div class="error-msg" id="errorMsg"></div>

    <!-- Current Salary -->
    <div class="form-group">
        <label class="form-label">Your Salary</label>
        <div class="form-row">
            <input type="text" id="salary" class="salary-input" placeholder="e.g. 75,000" inputmode="numeric">
            <select id="currentCurrency"></select>
        </div>
    </div>

    <!-- Current City -->
    <div class="form-group">
        <label class="form-label">Current City</label>
        <select id="currentCity">
            <option value="">Select city...</option>
        </select>
        <div class="neighborhood-group" id="currentNeighborhoodGroup">
            <label for="currentNeighborhood" style="font-size: 0.7rem; font-weight: 600; color: #86868b; text-transform: uppercase; letter-spacing: 0.5px; display: block; margin-bottom: 4px;">Neighborhood</label>
            <select id="currentNeighborhood"></select>
        </div>
        <div class="currency-hint" id="currentHint"></div>
    </div>

    <hr class="section-divider">

    <!-- Target City -->
    <div class="form-group">
        <label class="form-label">Compare To</label>
        <select id="targetCity">
            <option value="">Select city...</option>
        </select>
        <div class="neighborhood-group" id="targetNeighborhoodGroup">
            <label for="targetNeighborhood" style="font-size: 0.7rem; font-weight: 600; color: #86868b; text-transform: uppercase; letter-spacing: 0.5px; display: block; margin-bottom: 4px;">Neighborhood</label>
            <select id="targetNeighborhood"></select>
        </div>
        <div class="currency-hint" id="targetHint"></div>
    </div>

    <button class="btn-calculate" id="calcBtn">Check Equivalent Salary</button>

    <div class="result-box" id="resultBox">
        <div class="result-label">Equivalent Salary</div>
        <div class="result-amount" id="resultAmount"></div>
        <div class="result-breakdown">
            <div class="breakdown-stat">
                <div class="breakdown-stat-value" id="statRate"></div>
                <div class="breakdown-stat-label">Exchange Rate</div>
            </div>
            <div class="breakdown-stat">
                <div class="breakdown-stat-value" id="statCOL"></div>
                <div class="breakdown-stat-label">COL Adjustment</div>
            </div>
            <div class="breakdown-stat">
                <div class="breakdown-stat-value" id="statPower"></div>
                <div class="breakdown-stat-label">Buying Power</div>
            </div>
        </div>
        <div class="result-note" id="resultNote"></div>

        <!-- Tax Estimation -->
        <div class="tax-section" id="taxSection">
            <div class="section-title">Estimated Take-Home Pay</div>
            <div class="tax-grid" id="taxGrid"></div>
            <div style="font-size: 0.6rem; color: #aeaeb2; margin-top: 6px; line-height: 1.3;">Income tax only. Does not include social security, national insurance, or other mandatory contributions.</div>
        </div>

        <!-- Visual Chart -->
        <div class="chart-section" id="chartSection">
            <div class="section-title">Visual Comparison</div>
            <div id="chartBars"></div>
        </div>

        <!-- How we calculated this -->
        <div class="explanation-section" id="explanationSection">
            <div class="section-title">How we calculated this</div>
            <div id="explanationSteps"></div>
        </div>
    </div>

    <div class="widget-footer">
        <a href="https://salary-converter.com" target="_blank" rel="noopener">Powered by <strong>salary<span>:</span>converter</strong></a>
        <div class="widget-footer-links">
            <a href="https://salary-converter.com/city/" target="_blank" rel="noopener">101 Cities</a>
            <a href="https://salary-converter.com/compare/" target="_blank" rel="noopener">City Comparisons</a>
            <a href="https://salary-converter.com/blog/" target="_blank" rel="noopener">Blog</a>
        </div>
    </div>

<script>
// === DATA ===
const coliData = {
    'New York': 100, 'San Francisco': 97.6, 'Los Angeles': 76.3, 'Chicago': 73.2,
    'Miami': 80.1, 'Austin': 64.8, 'Seattle': 79.5, 'Denver': 65.7, 'Boston': 82.4,
    'Washington DC': 79.8, 'Houston': 60.2, 'Toronto': 62.3, 'Vancouver': 65.4,
    'Montreal': 52.1, 'Mexico City': 32.5, 'Cancún': 35.8, 'Panama City': 42.3,
    'London': 87.5, 'Paris': 46.9, 'Amsterdam': 82.6, 'Berlin': 51.2, 'Munich': 61.5,
    'Dublin': 72.8, 'Brussels': 50.3, 'Luxembourg City': 68.4, 'Zurich': 122.4,
    'Geneva': 118.6, 'Edinburgh': 62.1, 'Nice': 52.7, 'Madrid': 38.0, 'Barcelona': 42.1,
    'Valencia': 33.5, 'Málaga': 31.2, 'Lisbon': 34.7, 'Porto': 30.1, 'Rome': 49.3,
    'Milan': 57.8, 'Athens': 30.6, 'Split': 31.8, 'Stockholm': 64.3, 'Copenhagen': 85.7,
    'Helsinki': 58.2, 'Oslo': 78.5, 'Vienna': 48.2, 'Prague': 30.6, 'Budapest': 26.1,
    'Warsaw': 28.4, 'Krakow': 23.8, 'Bucharest': 22.5, 'Tallinn': 28.9, 'Riga': 25.3,
    'Istanbul': 23.1, 'Tokyo': 77.3, 'Osaka': 62.8, 'Fukuoka': 51.4, 'Seoul': 68.9,
    'Hong Kong': 73.6, 'Taipei': 44.8, 'Shanghai': 46.2, 'Beijing': 43.5, 'Shenzhen': 41.9,
    'Guangzhou': 38.7, 'Singapore': 87.7, 'Bangkok': 37.2, 'Chiang Mai': 22.6,
    'Phuket': 30.5, 'Kuala Lumpur': 32.8, 'Ho Chi Minh City': 26.4, 'Hanoi': 24.1,
    'Manila': 26.8, 'Jakarta': 24.5, 'Bali (Denpasar)': 25.3, 'Phnom Penh': 24.8,
    'Mumbai': 22.3, 'Bangalore': 20.8, 'Delhi': 19.5, 'Chennai': 18.9, 'Sydney': 74.5,
    'Melbourne': 68.2, 'Perth': 63.5, 'Auckland': 60.8, 'Dubai': 72.4, 'Abu Dhabi': 67.8,
    'Doha': 69.5, 'Riyadh': 42.6, 'Tel Aviv': 81.3, 'Cape Town': 28.4, 'Nairobi': 24.7,
    'Lagos': 27.3, 'Cairo': 16.8, 'Marrakech': 19.2, 'Casablanca': 22.1,
    'São Paulo': 41.8, 'Buenos Aires': 25.6, 'Bogotá': 22.9, 'Lima': 25.8,
    'Santiago': 33.2, 'Medellín': 20.4, 'Montevideo': 32.5, 'San José (CR)': 31.2,
    'Playa del Carmen': 30.8
};

const exchangeRates = {
    'GBP': 1.0, 'USD': 1.328, 'EUR': 1.126, 'SGD': 1.73, 'JPY': 205.72, 'AED': 4.811,
    'THB': 41.157, 'AUD': 1.887, 'CAD': 1.798, 'CHF': 1.076, 'CNY': 8.94, 'HKD': 10.4,
    'INR': 110.5, 'MYR': 5.4, 'NZD': 2.14, 'SEK': 12.09, 'NOK': 13.34, 'DKK': 8.43,
    'CZK': 30.6, 'HUF': 477, 'PLN': 5.2, 'TRY': 42.5, 'BRL': 6.7, 'MXN': 22.5,
    'ZAR': 24.2, 'KRW': 1686, 'TWD': 42.0, 'IDR': 20500, 'VND': 33200, 'PHP': 74.5,
    'ILS': 4.78, 'EGP': 64.8, 'KES': 171.5, 'NGN': 2100, 'MAD': 12.9, 'ARS': 1480,
    'COP': 5520, 'PEN': 4.92, 'CLP': 1245, 'UYU': 55.8, 'CRC': 672, 'QAR': 4.84,
    'SAR': 4.98, 'PAB': 1.328, 'RON': 5.62
};

const cityToCurrency = {
    'New York': 'USD', 'San Francisco': 'USD', 'Los Angeles': 'USD', 'Chicago': 'USD',
    'Miami': 'USD', 'Austin': 'USD', 'Seattle': 'USD', 'Denver': 'USD', 'Boston': 'USD',
    'Washington DC': 'USD', 'Houston': 'USD', 'Toronto': 'CAD', 'Vancouver': 'CAD',
    'Montreal': 'CAD', 'Mexico City': 'MXN', 'Cancún': 'MXN', 'Panama City': 'USD',
    'London': 'GBP', 'Edinburgh': 'GBP', 'Paris': 'EUR', 'Amsterdam': 'EUR',
    'Berlin': 'EUR', 'Munich': 'EUR', 'Dublin': 'EUR', 'Brussels': 'EUR',
    'Luxembourg City': 'EUR', 'Nice': 'EUR', 'Zurich': 'CHF', 'Geneva': 'CHF',
    'Madrid': 'EUR', 'Barcelona': 'EUR', 'Valencia': 'EUR', 'Málaga': 'EUR',
    'Lisbon': 'EUR', 'Porto': 'EUR', 'Rome': 'EUR', 'Milan': 'EUR', 'Athens': 'EUR',
    'Split': 'EUR', 'Stockholm': 'SEK', 'Copenhagen': 'DKK', 'Helsinki': 'EUR',
    'Oslo': 'NOK', 'Vienna': 'EUR', 'Prague': 'CZK', 'Budapest': 'HUF', 'Warsaw': 'PLN',
    'Krakow': 'PLN', 'Bucharest': 'RON', 'Tallinn': 'EUR', 'Riga': 'EUR',
    'Istanbul': 'TRY', 'Tokyo': 'JPY', 'Osaka': 'JPY', 'Fukuoka': 'JPY', 'Seoul': 'KRW',
    'Hong Kong': 'HKD', 'Taipei': 'TWD', 'Shanghai': 'CNY', 'Beijing': 'CNY',
    'Shenzhen': 'CNY', 'Guangzhou': 'CNY', 'Singapore': 'SGD', 'Bangkok': 'THB',
    'Chiang Mai': 'THB', 'Phuket': 'THB', 'Kuala Lumpur': 'MYR',
    'Ho Chi Minh City': 'VND', 'Hanoi': 'VND', 'Manila': 'PHP', 'Jakarta': 'IDR',
    'Bali (Denpasar)': 'IDR', 'Phnom Penh': 'USD', 'Mumbai': 'INR', 'Bangalore': 'INR',
    'Delhi': 'INR', 'Chennai': 'INR', 'Sydney': 'AUD', 'Melbourne': 'AUD', 'Perth': 'AUD',
    'Auckland': 'NZD', 'Dubai': 'AED', 'Abu Dhabi': 'AED', 'Doha': 'QAR',
    'Riyadh': 'SAR', 'Tel Aviv': 'ILS', 'Cape Town': 'ZAR', 'Nairobi': 'KES',
    'Lagos': 'NGN', 'Cairo': 'EGP', 'Marrakech': 'MAD', 'Casablanca': 'MAD',
    'São Paulo': 'BRL', 'Buenos Aires': 'ARS', 'Bogotá': 'COP', 'Medellín': 'COP',
    'Lima': 'PEN', 'Santiago': 'CLP', 'Montevideo': 'UYU', 'San José (CR)': 'CRC',
    'Playa del Carmen': 'MXN'
};

const cityNeighborhoods = {
    'New York': {
        'Manhattan (Midtown)': 1.25, 'Manhattan (Upper East Side)': 1.30, 'Manhattan (Lower East Side)': 1.10,
        'Brooklyn (Williamsburg)': 1.05, 'Brooklyn (Park Slope)': 1.08, 'Brooklyn (Bushwick)': 0.88,
        'Queens (Astoria)': 0.90, 'Queens (Long Island City)': 0.95, 'Harlem': 0.82,
        'The Bronx': 0.72, 'Staten Island': 0.75, 'SoHo / Tribeca': 1.35
    },
    'San Francisco': {
        'Financial District': 1.20, 'SoMa': 1.15, 'Mission District': 1.05,
        'Castro': 1.08, 'Sunset District': 0.92, 'Richmond District': 0.90,
        'Nob Hill': 1.18, 'Pacific Heights': 1.25, 'Tenderloin': 0.78,
        'Oakland (Downtown)': 0.80, 'Oakland (Rockridge)': 0.88, 'Berkeley': 0.90
    },
    'Los Angeles': {
        'Santa Monica': 1.25, 'Beverly Hills': 1.40, 'Hollywood': 1.10,
        'Downtown LA': 1.05, 'Silver Lake': 1.08, 'Venice': 1.20,
        'Koreatown': 0.85, 'Echo Park': 0.90, 'Pasadena': 0.92,
        'Long Beach': 0.80, 'Culver City': 1.02, 'Burbank': 0.88
    },
    'Chicago': {
        'The Loop': 1.20, 'Lincoln Park': 1.15, 'Wicker Park': 1.08,
        'River North': 1.22, 'Gold Coast': 1.25, 'Lakeview': 1.05,
        'Logan Square': 0.92, 'Pilsen': 0.82, 'Hyde Park': 0.85,
        'Bridgeport': 0.78, 'Evanston': 0.95, 'Oak Park': 0.90
    },
    'Miami': {
        'South Beach': 1.30, 'Brickell': 1.25, 'Wynwood': 1.10,
        'Coconut Grove': 1.15, 'Coral Gables': 1.20, 'Downtown Miami': 1.08,
        'Little Havana': 0.78, 'North Miami': 0.82, 'Hialeah': 0.72,
        'Miami Beach': 1.22, 'Doral': 0.88, 'Kendall': 0.80
    },
    'Austin': {
        'Downtown': 1.25, 'South Congress (SoCo)': 1.18, 'East Austin': 1.05,
        'West Lake Hills': 1.30, 'Hyde Park': 1.08, 'Mueller': 1.02,
        'North Loop': 0.95, 'Round Rock': 0.80, 'Cedar Park': 0.78,
        'Pflugerville': 0.75, 'South Lamar': 1.10
    },
    'Seattle': {
        'Capitol Hill': 1.12, 'Downtown': 1.18, 'Queen Anne': 1.10,
        'Ballard': 1.05, 'Fremont': 1.08, 'University District': 0.88,
        'Beacon Hill': 0.85, 'West Seattle': 0.92, 'Columbia City': 0.90,
        'Bellevue': 1.15, 'Redmond': 1.05, 'Kirkland': 1.02
    },
    'Denver': {
        'LoDo (Lower Downtown)': 1.22, 'Cherry Creek': 1.28, 'Capitol Hill': 1.10,
        'RiNo (River North)': 1.15, 'Highlands': 1.12, 'Washington Park': 1.08,
        'Baker': 1.02, 'Park Hill': 0.90, 'Montbello': 0.72,
        'Aurora': 0.78, 'Lakewood': 0.85, 'Englewood': 0.82
    },
    'Boston': {
        'Back Bay': 1.30, 'Beacon Hill': 1.28, 'South End': 1.18,
        'North End': 1.12, 'Seaport': 1.25, 'Cambridge (Harvard Sq)': 1.15,
        'Cambridge (Kendall Sq)': 1.20, 'Somerville': 0.95, 'Jamaica Plain': 0.90,
        'Dorchester': 0.78, 'Allston/Brighton': 0.85, 'Brookline': 1.10
    },
    'Washington DC': {
        'Georgetown': 1.30, 'Dupont Circle': 1.20, 'Capitol Hill': 1.15,
        'Adams Morgan': 1.05, 'Logan Circle': 1.18, 'Navy Yard': 1.10,
        'Columbia Heights': 0.92, 'Foggy Bottom': 1.22, 'U Street': 1.08,
        'Anacostia': 0.72, 'Arlington (VA)': 1.05, 'Bethesda (MD)': 1.12
    },
    'Houston': {
        'River Oaks': 1.35, 'The Heights': 1.15, 'Montrose': 1.12,
        'Downtown': 1.18, 'Midtown': 1.10, 'Museum District': 1.08,
        'Upper Kirby': 1.05, 'EaDo': 0.95, 'Katy': 0.82,
        'Sugar Land': 0.85, 'Spring': 0.78, 'Pearland': 0.80
    },
    'Toronto': {
        'Yorkville': 1.30, 'King West': 1.22, 'Liberty Village': 1.10,
        'Queen West': 1.08, 'The Annex': 1.12, 'Leslieville': 0.95,
        'Kensington Market': 0.92, 'Etobicoke': 0.80, 'Scarborough': 0.75,
        'North York': 0.85, 'Downtown Core': 1.18, 'Danforth': 0.90
    },
    'Vancouver': {
        'Yaletown': 1.25, 'Kitsilano': 1.15, 'Gastown': 1.12,
        'West End': 1.10, 'Commercial Drive': 0.95, 'Mount Pleasant': 1.05,
        'East Van': 0.88, 'Burnaby': 0.82, 'Richmond': 0.85,
        'North Vancouver': 0.92, 'West Vancouver': 1.30, 'Surrey': 0.72
    },
    'Montreal': {
        'Plateau Mont-Royal': 1.18, 'Old Montreal': 1.22, 'Griffintown': 1.15,
        'Mile End': 1.08, 'Outremont': 1.20, 'Westmount': 1.30,
        'Villeray': 0.92, 'Rosemont': 0.95, 'Verdun': 0.88,
        'NDG (Notre-Dame-de-Grâce)': 0.90, 'Hochelaga': 0.78, 'Laval': 0.75
    },
    'Mexico City': {
        'Polanco': 1.35, 'Condesa': 1.22, 'Roma Norte': 1.18,
        'Santa Fe': 1.15, 'Coyoacán': 1.02, 'Del Valle': 0.95,
        'Narvarte': 0.88, 'Tlalpan': 0.78, 'Iztapalapa': 0.65,
        'Centro Histórico': 0.90, 'San Ángel': 1.10
    },
    'Cancún': {
        'Zona Hotelera': 1.35, 'Puerto Cancún': 1.28, 'Centro': 0.85,
        'SM 17 (Downtown)': 0.82, 'Alfredo V. Bonfil': 0.72, 'Playa Mujeres': 1.22,
        'Puerto Juárez': 0.90, 'Isla Mujeres': 1.15
    },
    'Panama City': {
        'Punta Pacífica': 1.30, 'Costa del Este': 1.25, 'Casco Viejo': 1.12,
        'Obarrio': 1.10, 'El Cangrejo': 1.02, 'San Francisco': 1.08,
        'Calidonia': 0.78, 'Juan Díaz': 0.72, 'Clayton': 1.05, 'Balboa': 0.92
    },
    'London': {
        'Mayfair': 1.45, 'Chelsea': 1.38, 'Kensington': 1.35,
        'Notting Hill': 1.28, 'Soho': 1.22, 'Shoreditch': 1.10,
        'Camden': 1.05, 'Islington': 1.12, 'Brixton': 0.88,
        'Hackney': 0.92, 'Peckham': 0.82, 'Canary Wharf': 1.15,
        'Greenwich': 0.90, 'Clapham': 0.95, 'Stratford': 0.78,
        'Marylebone': 1.32, 'Hampstead': 1.30
    },
    'Paris': {
        'Le Marais (3rd/4th)': 1.30, 'Saint-Germain (6th)': 1.35, 'Champs-Élysées (8th)': 1.40,
        'Montmartre (18th)': 0.92, 'Bastille (11th)': 1.05, 'Oberkampf (11th)': 1.02,
        'Belleville (20th)': 0.82, 'La Défense': 1.10, 'Pigalle (9th)': 0.95,
        'Nation (12th)': 0.88, 'Batignolles (17th)': 0.98, 'Boulogne-Billancourt': 1.08
    },
    'Amsterdam': {
        'Canal Ring (Centrum)': 1.30, 'Jordaan': 1.25, 'De Pijp': 1.10,
        'Oud-West': 1.15, 'Oud-Zuid': 1.28, 'Oost': 0.95,
        'Noord': 0.82, 'Nieuw-West': 0.75, 'Amstelveen': 0.88,
        'Zuidas': 1.20, 'Westerpark': 1.05
    },
    'Berlin': {
        'Mitte': 1.22, 'Prenzlauer Berg': 1.12, 'Kreuzberg': 1.08,
        'Friedrichshain': 1.02, 'Charlottenburg': 1.15, 'Neukölln': 0.85,
        'Schöneberg': 1.05, 'Wedding': 0.78, 'Tempelhof': 0.82,
        'Spandau': 0.72, 'Steglitz': 0.88, 'Grunewald': 1.30
    },
    'Munich': {
        'Altstadt-Lehel': 1.35, 'Maxvorstadt': 1.18, 'Schwabing': 1.22,
        'Bogenhausen': 1.15, 'Haidhausen': 1.10, 'Glockenbachviertel': 1.20,
        'Sendling': 0.92, 'Moosach': 0.82, 'Pasing': 0.85,
        'Neuhausen': 1.05, 'Berg am Laim': 0.88
    },
    'Dublin': {
        'Dublin 2 (City Centre)': 1.25, 'Dublin 4 (Ballsbridge)': 1.30,
        'Dublin 6 (Ranelagh)': 1.15, 'Dublin 8 (Portobello)': 1.08,
        'Dún Laoghaire': 1.10, 'Rathmines': 1.05, 'Drumcondra': 0.92,
        'Tallaght': 0.75, 'Clontarf': 1.02, 'Howth': 1.12
    },
    'Brussels': {
        'Ixelles': 1.18, 'Saint-Gilles': 1.05, 'Uccle': 1.22,
        'Sablon': 1.28, 'Etterbeek': 1.02, 'Schaerbeek': 0.85,
        'Molenbeek': 0.72, 'Woluwe-Saint-Pierre': 1.12, 'Forest': 0.88,
        'EU Quarter': 1.15, 'Auderghem': 0.95
    },
    'Luxembourg City': {
        'Ville Haute': 1.30, 'Kirchberg': 1.22, 'Belair': 1.18,
        'Limpertsberg': 1.15, 'Grund': 1.08, 'Bonnevoie': 0.88,
        'Gasperich': 1.05, 'Eich': 0.92, 'Hollerich': 0.85, 'Cessange': 0.90
    },
    'Zurich': {
        'Bahnhofstrasse': 1.35, 'Seefeld': 1.25, 'Enge': 1.18,
        'Niederdorf': 1.15, 'Wiedikon': 1.02, 'Oerlikon': 0.88,
        'Altstetten': 0.82, 'Hottingen': 1.12, 'Wipkingen': 0.95, 'Schwamendingen': 0.78
    },
    'Geneva': {
        'Eaux-Vives': 1.20, 'Champel': 1.25, 'Carouge': 1.05,
        'Plainpalais': 1.10, 'Pâquis': 0.92, 'Nations': 1.15,
        'Servette': 0.88, 'Meyrin': 0.78, 'Vernier': 0.75, 'Cologny': 1.35
    },
    'Edinburgh': {
        'New Town': 1.25, 'Old Town': 1.18, 'Stockbridge': 1.15,
        'Morningside': 1.10, 'Marchmont': 1.02, 'Leith': 0.90,
        'Portobello': 0.88, 'Bruntsfield': 1.08, 'Gorgie': 0.78, 'Corstorphine': 0.82
    },
    'Nice': {
        'Promenade des Anglais': 1.30, 'Old Nice (Vieux Nice)': 1.18, 'Cimiez': 1.15,
        'Port': 1.05, 'Libération': 0.90, 'Riquier': 0.85,
        'Saint-Roch': 0.82, "L'Ariane": 0.70, 'Fabron': 0.95, 'Mont Boron': 1.22
    },
    'Madrid': {
        'Salamanca': 1.30, 'Chamberí': 1.18, 'Malasaña': 1.10,
        'Chueca': 1.12, 'La Latina': 1.05, 'Lavapiés': 0.90,
        'Retiro': 1.15, 'Chamartín': 1.08, 'Vallecas': 0.72, 'Tetuán': 0.82, 'Moncloa': 1.02
    },
    'Barcelona': {
        'Eixample': 1.15, 'Gràcia': 1.08, 'Born / El Born': 1.20,
        'Gothic Quarter': 1.18, 'Barceloneta': 1.10, 'Poblenou': 1.02,
        'Raval': 0.88, 'Sants': 0.85, 'Sant Andreu': 0.78,
        'Sarrià-Sant Gervasi': 1.25, 'Horta-Guinardó': 0.80
    },
    'Valencia': {
        'El Carmen': 1.18, 'Ruzafa': 1.15, 'Eixample': 1.10,
        'Ciutat Vella': 1.12, 'El Cabanyal': 0.92, 'Benimaclet': 0.88,
        'Patraix': 0.82, 'Poblats Marítims': 0.85, 'Campanar': 0.90, 'Quatre Carreres': 0.78
    },
    'Málaga': {
        'Centro Histórico': 1.22, 'Soho': 1.15, 'Pedregalejo': 1.10,
        'El Palo': 0.92, 'Huelin': 0.88, 'Teatinos': 0.85,
        'La Malagueta': 1.18, 'Puerto de la Torre': 0.75, 'Churriana': 0.78, 'El Limonar': 1.12
    },
    'Lisbon': {
        'Chiado': 1.28, 'Príncipe Real': 1.25, 'Alfama': 1.10,
        'Bairro Alto': 1.15, 'Estrela / Lapa': 1.12, 'Avenidas Novas': 1.05,
        'Alcântara': 0.95, 'Benfica': 0.82, 'Amadora': 0.72,
        'Parque das Nações': 1.08, 'Campo de Ourique': 1.02
    },
    'Porto': {
        'Ribeira': 1.22, 'Foz do Douro': 1.25, 'Cedofeita': 1.10,
        'Boavista': 1.15, 'Bonfim': 0.95, 'Campanhã': 0.78,
        'Paranhos': 0.85, 'Ramalde': 0.82, 'Matosinhos': 0.90, 'Vila Nova de Gaia': 0.88
    },
    'Rome': {
        'Centro Storico': 1.30, 'Trastevere': 1.15, 'Prati': 1.18,
        'Testaccio': 1.05, 'Monti': 1.20, 'San Giovanni': 0.92,
        'EUR': 0.88, 'Pigneto': 0.85, 'Ostiense': 0.90, 'Garbatella': 0.82, 'Flaminio': 1.08
    },
    'Milan': {
        'Brera': 1.30, 'Navigli': 1.15, 'Porta Nuova': 1.25,
        'City Centre': 1.35, 'Isola': 1.10, 'Città Studi': 0.90,
        'Lambrate': 0.85, 'Bovisa': 0.78, 'San Siro': 0.88, 'Porta Venezia': 1.12
    },
    'Athens': {
        'Kolonaki': 1.30, 'Plaka': 1.18, 'Kifissia': 1.22,
        'Glyfada': 1.15, 'Pangrati': 1.02, 'Exarchia': 0.85,
        'Koukaki': 1.05, 'Nea Smyrni': 0.90, 'Piraeus': 0.78, 'Marousi': 0.95, 'Psyrri': 1.08
    },
    'Split': {
        'Diocletian\'s Palace': 1.25, 'Bačvice': 1.15, 'Manuš': 1.05,
        'Žnjan': 1.10, 'Firule': 1.02, 'Spinut': 0.90,
        'Sućidar': 0.82, 'Trstenik': 0.88, 'Mertojak': 0.92
    },
    'Stockholm': {
        'Östermalm': 1.32, 'Södermalm': 1.15, 'Kungsholmen': 1.10,
        'Vasastan': 1.12, 'Gamla Stan': 1.20, 'Djurgården': 1.18,
        'Hammarby Sjöstad': 1.05, 'Hägersten': 0.88, 'Farsta': 0.75,
        'Solna': 0.90, 'Nacka': 0.92, 'Lidingö': 1.08
    },
    'Copenhagen': {
        'Indre By (City Centre)': 1.28, 'Frederiksberg': 1.18, 'Nørrebro': 1.02,
        'Vesterbro': 1.10, 'Østerbro': 1.15, 'Christianshavn': 1.12,
        'Amager': 0.90, 'Valby': 0.85, 'Brønshøj': 0.80, 'Hellerup': 1.22, 'Nordvest': 0.78
    },
    'Helsinki': {
        'Kruununhaka': 1.25, 'Eira': 1.22, 'Punavuori': 1.15,
        'Kallio': 1.05, 'Töölö': 1.12, 'Ullanlinna': 1.18,
        'Vallila': 0.95, 'Sörnäinen': 0.88, 'Vuosaari': 0.75,
        'Espoo (Tapiola)': 0.92, 'Kontula': 0.72
    },
    'Oslo': {
        'Frogner': 1.30, 'Majorstuen': 1.18, 'Grünerløkka': 1.12,
        'Aker Brygge': 1.25, 'Sentrum': 1.15, 'St. Hanshaugen': 1.08,
        'Tøyen': 0.88, 'Sagene': 1.02, 'Grønland': 0.82, 'Stovner': 0.72, 'Bærum': 1.10
    },
    'Vienna': {
        'Innere Stadt (1st)': 1.35, 'Josefstadt (8th)': 1.15, 'Neubau (7th)': 1.12,
        'Wieden (4th)': 1.18, 'Mariahilf (6th)': 1.08, 'Landstraße (3rd)': 1.05,
        'Leopoldstadt (2nd)': 0.95, 'Favoriten (10th)': 0.75, 'Ottakring (16th)': 0.82,
        'Döbling (19th)': 1.20, 'Hietzing (13th)': 1.10
    },
    'Prague': {
        'Prague 1 (Old Town)': 1.30, 'Prague 2 (Vinohrady)': 1.18, 'Prague 3 (Žižkov)': 0.95,
        'Prague 5 (Smíchov)': 1.05, 'Prague 6 (Dejvice)': 1.12, 'Prague 7 (Holešovice)': 1.08,
        'Prague 4 (Nusle)': 0.88, 'Prague 8 (Karlín)': 1.02, 'Prague 9': 0.78, 'Prague 10': 0.82
    },
    'Budapest': {
        'District V (Belváros)': 1.30, 'District VI (Terézváros)': 1.15, 'District VII (Jewish Quarter)': 1.12,
        'District I (Buda Castle)': 1.22, 'District II (Buda Hills)': 1.18, 'District IX (Ferencváros)': 1.02,
        'District XIII': 1.05, 'District XI (Újbuda)': 0.92, 'District VIII (Józsefváros)': 0.82,
        'District XIV (Zugló)': 0.85, 'District III (Óbuda)': 0.88
    },
    'Warsaw': {
        'Śródmieście (Centre)': 1.25, 'Mokotów': 1.12, 'Żoliborz': 1.15,
        'Wilanów': 1.18, 'Wola': 1.05, 'Praga Północ': 0.88,
        'Ursynów': 0.85, 'Ochota': 0.95, 'Bielany': 0.82, 'Bemowo': 0.78, 'Targówek': 0.72
    },
    'Krakow': {
        'Old Town (Stare Miasto)': 1.28, 'Kazimierz': 1.18, 'Podgórze': 1.05,
        'Krowodrza': 0.95, 'Dębniki': 0.90, 'Zabłocie': 1.08,
        'Nowa Huta': 0.72, 'Prądnik Biały': 0.82, 'Bronowice': 0.85, 'Ruczaj': 0.88
    },
    'Bucharest': {
        'Dorobanți': 1.28, 'Primăverii': 1.25, 'Floreasca': 1.18,
        'Herăstrău': 1.22, 'Cotroceni': 1.10, 'Aviatorilor': 1.15,
        'Pipera': 1.02, 'Militari': 0.75, 'Rahova': 0.70, 'Tineretului': 0.88, 'Berceni': 0.78
    },
    'Tallinn': {
        'Old Town (Vanalinn)': 1.28, 'Kalamaja': 1.15, 'Kadriorg': 1.18,
        'Pirita': 1.10, 'Telliskivi': 1.12, 'Rotermanni': 1.08,
        'Kristiine': 0.92, 'Mustamäe': 0.82, 'Lasnamäe': 0.72, 'Nõmme': 0.88
    },
    'Riga': {
        'Old Riga (Vecrīga)': 1.25, 'Quiet Centre': 1.18, 'Āgenskalns': 1.05,
        'Mežaparks': 1.10, 'Grīziņkalns': 0.92, 'Teika': 0.95,
        'Purvciems': 0.78, 'Imanta': 0.75, 'Ziepniekkalns': 0.72, 'Torņakalns': 0.88
    },
    'Istanbul': {
        'Beşiktaş': 1.28, 'Nişantaşı': 1.35, 'Kadıköy': 1.15,
        'Bebek': 1.30, 'Cihangir': 1.18, 'Karaköy': 1.12,
        'Şişli': 1.05, 'Üsküdar': 0.92, 'Bakırköy': 0.88,
        'Fatih': 0.82, 'Beyoğlu': 1.08, 'Esenyurt': 0.65
    },
    'Tokyo': {
        'Minato (Roppongi)': 1.30, 'Shibuya': 1.25, 'Shinjuku': 1.18,
        'Chiyoda (Marunouchi)': 1.35, 'Meguro': 1.15, 'Setagaya': 1.08,
        'Nakano': 0.92, 'Suginami': 0.88, 'Koto (Toyosu)': 1.05,
        'Adachi': 0.75, 'Edogawa': 0.78, 'Bunkyo': 1.10
    },
    'Osaka': {
        'Kita (Umeda)': 1.22, 'Chuo (Namba)': 1.18, 'Tennoji': 1.08,
        'Fukushima': 1.10, 'Nishi': 1.05, 'Shinmachi': 1.02,
        'Sumiyoshi': 0.88, 'Higashiyodogawa': 0.82, 'Ikuno': 0.78, 'Sakai': 0.75
    },
    'Fukuoka': {
        'Tenjin': 1.20, 'Hakata': 1.15, 'Daimyo': 1.12,
        'Yakuin': 1.08, 'Ohori': 1.10, 'Nishijin': 0.92,
        'Hakozaki': 0.85, 'Kashii': 0.80, 'Noke': 0.78, 'Momochi': 1.05
    },
    'Seoul': {
        'Gangnam': 1.30, 'Itaewon': 1.15, 'Myeongdong': 1.20,
        'Hongdae': 1.08, 'Bukchon': 1.18, 'Yeouido': 1.12,
        'Sinchon': 0.92, 'Gwangjin': 0.88, 'Nowon': 0.75, 'Mapo': 1.02
    },
    'Hong Kong': {
        'Central': 1.40, 'The Peak': 1.50, 'Mid-Levels': 1.30,
        'Causeway Bay': 1.25, 'Tsim Sha Tsui': 1.15, 'Wan Chai': 1.18,
        'Mong Kok': 0.92, 'Sham Shui Po': 0.78, 'Tai Po': 0.72,
        'Sai Kung': 0.85, 'Discovery Bay': 1.10
    },
    'Taipei': {
        'Da\'an': 1.25, 'Xinyi': 1.30, 'Zhongshan': 1.12,
        'Songshan': 1.08, 'Zhongzheng': 1.10, 'Shilin': 0.92,
        'Beitou': 0.88, 'Neihu': 1.02, 'Wanhua': 0.82, 'Banqiao (New Taipei)': 0.78
    },
    'Shanghai': {
        'Jing\'an': 1.30, 'Xuhui (French Concession)': 1.28, 'Lujiazui (Pudong)': 1.25,
        'Huangpu (The Bund)': 1.22, 'Changning': 1.10, 'Hongkou': 0.92,
        'Yangpu': 0.88, 'Minhang': 0.82, 'Baoshan': 0.75, 'Putuo': 0.90
    },
    'Beijing': {
        'Chaoyang (CBD)': 1.28, 'Dongcheng': 1.22, 'Xicheng': 1.18,
        'Haidian (Zhongguancun)': 1.15, 'Shunyi': 1.08, 'Chaoyang (Sanlitun)': 1.25,
        'Fengtai': 0.82, 'Tongzhou': 0.75, 'Daxing': 0.72, 'Changping': 0.78
    },
    'Shenzhen': {
        'Nanshan (Shekou)': 1.25, 'Futian (CBD)': 1.22, 'Luohu': 1.05,
        'Nanshan (Tech Park)': 1.18, 'Bao\'an': 0.82, 'Longhua': 0.78,
        'Longgang': 0.72, 'Yantian': 0.85, 'Guangming': 0.75, 'Qianhai': 1.12
    },
    'Guangzhou': {
        'Tianhe': 1.22, 'Yuexiu': 1.10, 'Haizhu': 1.02,
        'Liwan': 0.92, 'Panyu': 0.82, 'Baiyun': 0.78,
        'Huangpu': 1.05, 'Nansha': 0.75, 'Zhujiang New Town': 1.18, 'Huadu': 0.72
    },
    'Singapore': {
        'Orchard Road': 1.30, 'Marina Bay': 1.35, 'Raffles Place': 1.25,
        'Holland Village': 1.12, 'Tiong Bahru': 1.10, 'Tanjong Pagar': 1.15,
        'Bukit Timah': 1.18, 'Clementi': 0.88, 'Woodlands': 0.75,
        'Tampines': 0.78, 'Jurong East': 0.80, 'Sentosa': 1.40
    },
    'Bangkok': {
        'Sukhumvit (Asoke)': 1.25, 'Silom / Sathorn': 1.22, 'Siam': 1.18,
        'Thonglor': 1.28, 'Ekkamai': 1.15, 'Ari': 1.10,
        'Khao San': 0.85, 'On Nut': 0.88, 'Phra Khanong': 0.92,
        'Bang Na': 0.78, 'Chatuchak': 0.90, 'Ladprao': 0.82
    },
    'Chiang Mai': {
        'Old City': 1.15, 'Nimmanhaemin': 1.22, 'Santitham': 1.05,
        'Chang Khlan (Night Bazaar)': 1.08, 'Hang Dong': 0.82, 'San Sai': 0.78,
        'Mae Rim': 0.85, 'Suthep': 1.02, 'Wualai': 0.92, 'San Kamphaeng': 0.75
    },
    'Phuket': {
        'Patong': 1.22, 'Kata': 1.12, 'Karon': 1.08,
        'Kamala': 1.15, 'Surin': 1.20, 'Bang Tao': 1.18,
        'Phuket Town': 0.85, 'Rawai': 0.92, 'Chalong': 0.88, 'Cherng Talay': 1.05
    },
    'Kuala Lumpur': {
        'KLCC': 1.30, 'Bukit Bintang': 1.22, 'Bangsar': 1.18,
        'Mont Kiara': 1.15, 'Damansara Heights': 1.20, 'Sri Hartamas': 1.08,
        'Petaling Jaya': 0.90, 'Cheras': 0.78, 'Sentul': 0.82,
        'Kepong': 0.75, 'Desa ParkCity': 1.10
    },
    'Ho Chi Minh City': {
        'District 1': 1.30, 'District 2 (Thao Dien)': 1.22, 'District 3': 1.15,
        'District 7 (Phu My Hung)': 1.12, 'Binh Thanh': 1.02, 'District 4': 0.90,
        'Go Vap': 0.82, 'Tan Binh': 0.85, 'Thu Duc': 0.88, 'Binh Tan': 0.72
    },
    'Hanoi': {
        'Hoan Kiem (Old Quarter)': 1.25, 'Ba Dinh': 1.18, 'Tay Ho (West Lake)': 1.22,
        'Hai Ba Trung': 1.08, 'Dong Da': 1.02, 'Cau Giay': 1.05,
        'Thanh Xuan': 0.88, 'Ha Dong': 0.78, 'Long Bien': 0.82, 'Hoang Mai': 0.85
    },
    'Manila': {
        'Makati (CBD)': 1.28, 'BGC (Taguig)': 1.25, 'Rockwell': 1.22,
        'Alabang': 1.10, 'Ortigas': 1.08, 'Eastwood (Quezon City)': 1.02,
        'Pasig': 0.92, 'Mandaluyong': 0.95, 'Quezon City (Cubao)': 0.82,
        'Manila (Ermita)': 0.78, 'Las Piñas': 0.75
    },
    'Jakarta': {
        'Menteng': 1.30, 'Sudirman (SCBD)': 1.25, 'Kemang': 1.18,
        'Kuningan': 1.15, 'Senopati': 1.20, 'Pondok Indah': 1.12,
        'Kelapa Gading': 1.02, 'Pluit': 0.90, 'Cempaka Putih': 0.82,
        'Bekasi': 0.72, 'Tangerang': 0.75
    },
    'Bali (Denpasar)': {
        'Seminyak': 1.28, 'Canggu': 1.22, 'Ubud': 1.10,
        'Sanur': 1.05, 'Kuta': 0.92, 'Nusa Dua': 1.18,
        'Jimbaran': 1.12, 'Denpasar Centre': 0.82, 'Uluwatu': 1.15, 'Legian': 0.88
    },
    'Phnom Penh': {
        'BKK1': 1.30, 'BKK2': 1.10, 'Tonle Bassac': 1.22,
        'Daun Penh (Riverside)': 1.15, 'Toul Tom Poung (Russian Market)': 1.05,
        'Chroy Changvar': 0.90, 'Toul Kork': 0.95, 'Sen Sok': 0.78,
        'Meanchey': 0.72, 'Chamkarmon': 1.02
    },
    'Mumbai': {
        'South Mumbai (Colaba)': 1.35, 'Bandra West': 1.28, 'Juhu': 1.22,
        'Worli': 1.25, 'Lower Parel': 1.18, 'Andheri West': 1.05,
        'Powai': 1.08, 'Dadar': 0.95, 'Andheri East': 0.88,
        'Borivali': 0.78, 'Thane': 0.72, 'Navi Mumbai': 0.75
    },
    'Bangalore': {
        'Indiranagar': 1.25, 'Koramangala': 1.22, 'Whitefield': 1.08,
        'MG Road': 1.18, 'HSR Layout': 1.05, 'Jayanagar': 1.02,
        'Electronic City': 0.85, 'Marathahalli': 0.92, 'Yelahanka': 0.78,
        'Bannerghatta Road': 0.88, 'Hebbal': 0.95
    },
    'Delhi': {
        'South Delhi (GK)': 1.30, 'Lutyens Delhi': 1.40, 'Hauz Khas': 1.18,
        'Defence Colony': 1.22, 'Vasant Kunj': 1.08, 'Dwarka': 0.85,
        'Rohini': 0.78, 'Gurugram (DLF)': 1.12, 'Noida (Sector 18)': 0.82,
        'Saket': 1.05, 'Karol Bagh': 0.88
    },
    'Chennai': {
        'Adyar': 1.18, 'Nungambakkam': 1.22, 'T. Nagar': 1.10,
        'Anna Nagar': 1.05, 'Mylapore': 1.08, 'OMR (Sholinganallur)': 0.92,
        'Velachery': 0.88, 'Tambaram': 0.75, 'Porur': 0.82, 'Besant Nagar': 1.15
    },
    'Sydney': {
        'CBD': 1.25, 'Bondi': 1.22, 'Surry Hills': 1.15,
        'Darlinghurst': 1.12, 'Newtown': 1.05, 'Manly': 1.10,
        'Parramatta': 0.82, 'Bankstown': 0.72, 'Chatswood': 0.95,
        'Pyrmont': 1.18, 'Mosman': 1.28, 'Marrickville': 0.90
    },
    'Melbourne': {
        'CBD': 1.20, 'South Yarra': 1.22, 'Fitzroy': 1.10,
        'Carlton': 1.05, 'St Kilda': 1.08, 'Collingwood': 1.02,
        'Richmond': 0.98, 'Brunswick': 0.92, 'Footscray': 0.78,
        'Docklands': 1.12, 'Toorak': 1.30, 'Prahran': 1.08
    },
    'Perth': {
        'CBD': 1.18, 'Subiaco': 1.15, 'Cottesloe': 1.22,
        'Claremont': 1.12, 'Fremantle': 1.05, 'Leederville': 1.08,
        'Mount Lawley': 1.02, 'Northbridge': 0.95, 'Scarborough': 0.90,
        'Rockingham': 0.78, 'Joondalup': 0.82, 'Nedlands': 1.10
    },
    'Auckland': {
        'Ponsonby': 1.25, 'Parnell': 1.22, 'Herne Bay': 1.30,
        'Grey Lynn': 1.15, 'CBD': 1.12, 'Newmarket': 1.08,
        'Mt Eden': 1.05, 'Kingsland': 1.02, 'Devonport': 1.10,
        'Henderson': 0.78, 'Manukau': 0.72, 'Takapuna': 0.95
    },
    'Dubai': {
        'Downtown Dubai': 1.35, 'Dubai Marina': 1.28, 'Palm Jumeirah': 1.40,
        'JBR': 1.22, 'Business Bay': 1.18, 'DIFC': 1.30,
        'JLT': 1.05, 'Deira': 0.78, 'Al Barsha': 0.88,
        'Jumeirah': 1.15, 'Silicon Oasis': 0.72, 'Sports City': 0.80
    },
    'Abu Dhabi': {
        'Al Reem Island': 1.22, 'Saadiyat Island': 1.30, 'Corniche': 1.25,
        'Al Raha Beach': 1.15, 'Yas Island': 1.12, 'Khalifa City': 0.88,
        'Mussafah': 0.72, 'Al Khalidiya': 1.08, 'Tourist Club Area': 0.92, 'Al Ain': 0.78
    },
    'Doha': {
        'The Pearl': 1.35, 'West Bay': 1.28, 'Katara': 1.22,
        'Al Sadd': 1.05, 'Souq Waqif': 1.10, 'Lusail': 1.18,
        'Al Rayyan': 0.85, 'Al Wakrah': 0.78, 'Al Gharrafa': 0.82, 'Industrial Area': 0.65
    },
    'Riyadh': {
        'Al Olaya': 1.28, 'King Abdullah Financial District': 1.30, 'Al Nakheel': 1.18,
        'Diplomatic Quarter': 1.22, 'Al Malqa': 1.12, 'Al Yasmin': 1.05,
        'Al Sulimaniyah': 0.95, 'Al Batha': 0.72, 'Al Khaleej': 0.82, 'Al Thumama': 0.88
    },
    'Tel Aviv': {
        'Rothschild Blvd': 1.35, 'Neve Tzedek': 1.30, 'Florentin': 1.10,
        'Old North': 1.20, 'Sarona': 1.18, 'Jaffa': 0.95,
        'Ramat Aviv': 1.12, 'Bat Yam': 0.78, 'Holon': 0.75, 'Givatayim': 0.92
    },
    'Cape Town': {
        'Camps Bay': 1.35, 'Clifton': 1.40, 'Sea Point': 1.18,
        'City Bowl': 1.15, 'Green Point': 1.12, 'Woodstock': 0.92,
        'Observatory': 0.88, 'Rondebosch': 0.95, 'Claremont': 1.02,
        'Khayelitsha': 0.55, 'Mitchell\'s Plain': 0.60
    },
    'Nairobi': {
        'Westlands': 1.25, 'Karen': 1.22, 'Kilimani': 1.18,
        'Lavington': 1.15, 'Runda': 1.28, 'Kileleshwa': 1.10,
        'Upper Hill': 1.08, 'South B': 0.88, 'Eastleigh': 0.72,
        'Kibera': 0.55, 'Lang\'ata': 0.95
    },
    'Lagos': {
        'Victoria Island': 1.35, 'Ikoyi': 1.30, 'Lekki Phase 1': 1.22,
        'Banana Island': 1.45, 'Yaba': 0.88, 'Surulere': 0.82,
        'Ikeja': 0.90, 'Ajah': 0.78, 'Oshodi': 0.68, 'Maryland': 0.85, 'Gbagada': 0.92
    },
    'Cairo': {
        'Zamalek': 1.35, 'Garden City': 1.28, 'Maadi': 1.18,
        'Heliopolis': 1.08, 'New Cairo (5th Settlement)': 1.15, '6th of October City': 0.85,
        'Dokki': 1.02, 'Mohandessin': 0.95, 'Nasr City': 0.82, 'Shubra': 0.72, 'Downtown': 0.90
    },
    'Marrakech': {
        'Gueliz': 1.18, 'Hivernage': 1.25, 'Medina (Riads)': 1.15,
        'Palmeraie': 1.30, 'Agdal': 1.08, 'Targa': 1.02,
        'Massira': 0.78, 'Sidi Youssef Ben Ali': 0.72, 'Menara': 0.88, 'Amelkis': 1.12
    },
    'Casablanca': {
        'Corniche (Ain Diab)': 1.25, 'Maarif': 1.15, 'Anfa': 1.22,
        'Gauthier': 1.12, 'Bourgogne': 1.08, 'Racine': 1.05,
        'Sidi Moumen': 0.68, 'Hay Hassani': 0.78, 'Derb Sultan': 0.82, 'CIL': 0.88
    },
    'São Paulo': {
        'Jardins': 1.30, 'Vila Madalena': 1.15, 'Pinheiros': 1.18,
        'Itaim Bibi': 1.25, 'Vila Olímpia': 1.20, 'Moema': 1.12,
        'Centro': 0.78, 'Liberdade': 0.85, 'Bela Vista': 0.92,
        'Santana': 0.82, 'Tatuapé': 0.80
    },
    'Buenos Aires': {
        'Palermo (Soho)': 1.25, 'Recoleta': 1.28, 'Puerto Madero': 1.35,
        'San Telmo': 1.02, 'Belgrano': 1.10, 'Núñez': 1.05,
        'Caballito': 0.88, 'Almagro': 0.85, 'Flores': 0.75,
        'Villa Crespo': 0.92, 'Colegiales': 1.02
    },
    'Bogotá': {
        'Zona T (Zona Rosa)': 1.25, 'Usaquén': 1.22, 'Chicó': 1.20,
        'Chapinero Alto': 1.12, 'La Candelaria': 0.88, 'Cedritos': 1.02,
        'Suba': 0.82, 'Kennedy': 0.72, 'Teusaquillo': 0.95, 'Santa Bárbara': 1.15
    },
    'Lima': {
        'Miraflores': 1.28, 'San Isidro': 1.30, 'Barranco': 1.15,
        'Surco': 1.08, 'La Molina': 1.05, 'San Borja': 1.02,
        'Jesús María': 0.90, 'Lince': 0.85, 'San Juan de Lurigancho': 0.68, 'Callao': 0.72
    },
    'Santiago': {
        'Providencia': 1.22, 'Las Condes': 1.25, 'Vitacura': 1.35,
        'Ñuñoa': 1.08, 'La Reina': 1.05, 'Santiago Centro': 0.92,
        'Lo Barnechea': 1.18, 'Macul': 0.82, 'La Florida': 0.78, 'Puente Alto': 0.70
    },
    'Medellín': {
        'El Poblado': 1.30, 'Laureles': 1.12, 'Envigado': 1.08,
        'Sabaneta': 0.95, 'Belén': 0.88, 'La Floresta': 1.02,
        'Centro': 0.78, 'Robledo': 0.75, 'Aranjuez': 0.72, 'Estadio': 0.85
    },
    'Montevideo': {
        'Pocitos': 1.22, 'Punta Carretas': 1.25, 'Carrasco': 1.30,
        'Ciudad Vieja': 1.08, 'Parque Rodó': 1.05, 'Buceo': 1.02,
        'Cordón': 0.92, 'Tres Cruces': 0.88, 'La Blanqueada': 0.85, 'Cerro': 0.70
    },
    'San José (CR)': {
        'Escazú': 1.28, 'Santa Ana': 1.22, 'Rohrmoser': 1.12,
        'Los Yoses': 1.08, 'Barrio Escalante': 1.10, 'San Pedro': 0.92,
        'Sabana': 1.05, 'Heredia': 0.85, 'Alajuela': 0.78, 'Cartago': 0.75
    },
    'Playa del Carmen': {
        'Playacar': 1.30, 'Centro (5th Avenue)': 1.18, 'Gonzalo Guerrero': 1.05,
        'Ejidal': 0.82, 'Colosio': 0.78, 'Playa Mamitas': 1.22,
        'Zazil Ha': 0.88, 'Luis Donaldo Colosio': 0.75, 'Villas del Sol': 0.72
    }
};

const cityToCountry = {
    'New York': 'US', 'San Francisco': 'US', 'Los Angeles': 'US',
    'Chicago': 'US', 'Miami': 'US', 'Austin': 'US', 'Seattle': 'US',
    'Denver': 'US', 'Boston': 'US', 'Washington DC': 'US', 'Houston': 'US',
    'Toronto': 'CA', 'Vancouver': 'CA', 'Montreal': 'CA',
    'Mexico City': 'MX', 'Cancún': 'MX', 'Panama City': 'PA',
    'London': 'GB', 'Edinburgh': 'GB',
    'Paris': 'FR', 'Nice': 'FR',
    'Amsterdam': 'NL', 'Berlin': 'DE', 'Munich': 'DE',
    'Dublin': 'IE', 'Brussels': 'BE', 'Luxembourg City': 'LU',
    'Zurich': 'CH', 'Geneva': 'CH',
    'Madrid': 'ES', 'Barcelona': 'ES', 'Valencia': 'ES', 'Málaga': 'ES',
    'Lisbon': 'PT', 'Porto': 'PT', 'Rome': 'IT', 'Milan': 'IT',
    'Athens': 'GR', 'Split': 'HR',
    'Stockholm': 'SE', 'Copenhagen': 'DK', 'Helsinki': 'FI', 'Oslo': 'NO', 'Vienna': 'AT',
    'Prague': 'CZ', 'Budapest': 'HU', 'Warsaw': 'PL', 'Krakow': 'PL',
    'Bucharest': 'RO', 'Tallinn': 'EE', 'Riga': 'LV', 'Istanbul': 'TR',
    'Tokyo': 'JP', 'Osaka': 'JP', 'Fukuoka': 'JP',
    'Seoul': 'KR', 'Hong Kong': 'HK', 'Taipei': 'TW',
    'Shanghai': 'CN', 'Beijing': 'CN', 'Shenzhen': 'CN', 'Guangzhou': 'CN',
    'Singapore': 'SG', 'Bangkok': 'TH', 'Chiang Mai': 'TH', 'Phuket': 'TH',
    'Kuala Lumpur': 'MY', 'Ho Chi Minh City': 'VN', 'Hanoi': 'VN',
    'Manila': 'PH', 'Jakarta': 'ID', 'Bali (Denpasar)': 'ID', 'Phnom Penh': 'KH',
    'Mumbai': 'IN', 'Bangalore': 'IN', 'Delhi': 'IN', 'Chennai': 'IN',
    'Sydney': 'AU', 'Melbourne': 'AU', 'Perth': 'AU', 'Auckland': 'NZ',
    'Dubai': 'AE', 'Abu Dhabi': 'AE', 'Doha': 'QA', 'Riyadh': 'SA', 'Tel Aviv': 'IL',
    'Cape Town': 'ZA', 'Nairobi': 'KE', 'Lagos': 'NG', 'Cairo': 'EG',
    'Marrakech': 'MA', 'Casablanca': 'MA',
    'São Paulo': 'BR', 'Buenos Aires': 'AR', 'Bogotá': 'CO', 'Medellín': 'CO',
    'Lima': 'PE', 'Santiago': 'CL', 'Montevideo': 'UY',
    'San José (CR)': 'CR', 'Playa del Carmen': 'MX'
};

// Progressive income tax brackets by country [[upperBound, marginalRate%], ...]
const taxBrackets = {
    'AE': [], 'QA': [], 'SA': [], 'KH': [],
    'US': [[11600,10],[47150,12],[100525,22],[191950,24],[243725,32],[609350,35],[Infinity,37]],
    'CA': [[55867,15],[111733,20.5],[154906,26],[220000,29],[Infinity,33]],
    'MX': [[8952,1.92],[75985,6.4],[133536,10.88],[155230,16],[185853,17.92],[374838,21.36],[590797,23.52],[1127927,30],[1503902,32],[4511707,34],[Infinity,35]],
    'PA': [[11000,0],[50000,15],[Infinity,25]],
    'BR': [[24512,0],[33920,7.5],[45013,15],[55976,22.5],[Infinity,27.5]],
    'AR': [[419254,5],[838508,9],[1257762,12],[1677016,15],[2516524,19],[3356032,23],[5034048,27],[6712063,31],[Infinity,35]],
    'CO': [[46229000,0],[72066000,19],[163386000,28],[368076000,33],[624096000,35],[969456000,37],[Infinity,39]],
    'PE': [[29050,0],[54250,8],[81375,14],[116250,17],[232500,20],[Infinity,30]],
    'CL': [[8775702,0],[19501560,4],[32502600,8],[45503640,13.5],[58504680,23],[78006240,30.4],[101508120,35],[Infinity,40]],
    'UY': [[468720,0],[670320,10],[1005480,15],[1536000,24],[2421600,25],[3643200,27],[5685600,31],[Infinity,36]],
    'CR': [[11160000,0],[16380000,10],[Infinity,15]],
    'GB': [[12570,0],[50270,20],[125140,40],[Infinity,45]],
    'FR': [[11294,0],[28797,11],[82341,30],[177106,41],[Infinity,45]],
    'NL': [[38098,9.32],[75518,36.97],[Infinity,49.50]],
    'DE': [[11604,0],[17005,14],[66760,24],[277826,42],[Infinity,45]],
    'IE': [[42000,20],[Infinity,40]],
    'BE': [[15200,0],[28730,25],[40580,40],[Infinity,50]],
    'LU': [[11265,0],[25000,14],[50000,30],[100000,38],[200000,41],[Infinity,42]],
    'CH': [[14500,0],[50000,10],[100000,16],[200000,22],[Infinity,22]],
    'ES': [[12450,19],[20200,24],[35200,30],[60000,37],[300000,45],[Infinity,47]],
    'PT': [[7703,13.25],[11623,18],[16472,23],[21321,26],[27146,32.75],[39791,37],[51997,43.5],[81199,45],[Infinity,48]],
    'IT': [[15000,23],[28000,25],[50000,35],[Infinity,43]],
    'GR': [[10000,9],[20000,22],[30000,28],[40000,36],[Infinity,44]],
    'HR': [[50400,20],[Infinity,30]],
    'SE': [[614942,32],[Infinity,52]],
    'DK': [[46700,0],[588900,37],[Infinity,52]],
    'FI': [[19900,0],[29700,32.64],[49000,37.4],[85800,41.25],[Infinity,51.25]],
    'NO': [[198350,22],[279150,23.7],[642950,26],[926800,35.4],[1500000,38.4],[Infinity,39.4]],
    'AT': [[12816,0],[21816,20],[35016,30],[68016,40],[103816,48],[1000000,50],[Infinity,55]],
    'CZ': [[1935552,15],[Infinity,23]],
    'HU': [[Infinity,15]],
    'PL': [[30000,0],[120000,12],[Infinity,32]],
    'RO': [[Infinity,10]],
    'EE': [[7848,0],[Infinity,20]],
    'LV': [[20004,20],[78100,23],[Infinity,31]],
    'TR': [[110000,15],[230000,20],[580000,27],[3000000,35],[Infinity,40]],
    'JP': [[1950000,5],[3300000,10],[6950000,20],[9000000,23],[18000000,33],[40000000,40],[Infinity,45]],
    'KR': [[14000000,6],[50000000,15],[88000000,24],[150000000,35],[300000000,38],[500000000,40],[1000000000,42],[Infinity,45]],
    'HK': [[50000,2],[100000,6],[150000,10],[200000,14],[Infinity,17]],
    'TW': [[560000,5],[1260000,12],[2520000,20],[4720000,30],[Infinity,40]],
    'CN': [[36000,3],[144000,10],[300000,20],[420000,25],[660000,30],[960000,35],[Infinity,45]],
    'SG': [[20000,0],[30000,2],[40000,3.5],[80000,7],[120000,11.5],[160000,15],[200000,18],[240000,19],[280000,19.5],[320000,20],[500000,22],[1000000,23],[Infinity,24]],
    'TH': [[150000,0],[300000,5],[500000,10],[750000,15],[1000000,20],[2000000,25],[5000000,30],[Infinity,35]],
    'MY': [[5000,0],[20000,1],[35000,3],[50000,6],[70000,11],[100000,19],[400000,25],[600000,26],[2000000,28],[Infinity,30]],
    'VN': [[60000000,5],[120000000,10],[216000000,15],[384000000,20],[624000000,25],[960000000,30],[Infinity,35]],
    'PH': [[250000,0],[400000,15],[800000,20],[2000000,25],[8000000,30],[Infinity,35]],
    'ID': [[60000000,5],[250000000,15],[500000000,25],[5000000000,30],[Infinity,35]],
    'IN': [[300000,0],[700000,5],[1000000,10],[1200000,15],[1500000,20],[Infinity,30]],
    'AU': [[18200,0],[45000,16],[135000,30],[190000,37],[Infinity,45]],
    'NZ': [[14000,10.5],[48000,17.5],[70000,30],[180000,33],[Infinity,39]],
    'IL': [[84120,10],[120720,14],[193800,20],[269280,31],[560280,35],[721560,47],[Infinity,50]],
    'ZA': [[237100,18],[370500,26],[512800,31],[673000,36],[857900,39],[1817000,41],[Infinity,45]],
    'KE': [[288000,10],[388000,25],[6000000,30],[9600000,32.5],[Infinity,35]],
    'NG': [[300000,7],[600000,11],[1100000,15],[1600000,19],[3200000,21],[Infinity,24]],
    'EG': [[40000,0],[55000,10],[70000,15],[200000,20],[400000,22.5],[Infinity,25]],
    'MA': [[30000,0],[50000,10],[60000,20],[80000,30],[180000,34],[Infinity,38]]
};

function calculateTax(income, countryCode) {
    const brackets = taxBrackets[countryCode];
    if (!brackets || brackets.length === 0) return { tax: 0, effectiveRate: 0, net: income };
    let tax = 0, prev = 0;
    for (const [limit, rate] of brackets) {
        if (income <= prev) break;
        tax += (Math.min(income, limit) - prev) * (rate / 100);
        prev = limit;
    }
    const effectiveRate = income > 0 ? Math.round((tax / income) * 100) : 0;
    return { tax, effectiveRate, net: income - tax };
}

// === DOM REFS ===
const salaryInput = document.getElementById('salary');
const currentCity = document.getElementById('currentCity');
const targetCity = document.getElementById('targetCity');
const currentCurrency = document.getElementById('currentCurrency');
const currentHint = document.getElementById('currentHint');
const targetHint = document.getElementById('targetHint');
const currentNeighborhood = document.getElementById('currentNeighborhood');
const targetNeighborhood = document.getElementById('targetNeighborhood');
const calcBtn = document.getElementById('calcBtn');
const resultBox = document.getElementById('resultBox');
const resultAmount = document.getElementById('resultAmount');
const errorMsg = document.getElementById('errorMsg');

// === INIT ===
function init() {
    const cities = Object.keys(coliData).sort();
    [currentCity, targetCity].forEach(sel => {
        cities.forEach(city => {
            const opt = document.createElement('option');
            opt.value = city;
            opt.textContent = city;
            sel.appendChild(opt);
        });
    });

    Object.keys(exchangeRates).sort().forEach(code => {
        const opt = document.createElement('option');
        opt.value = code;
        opt.textContent = code;
        currentCurrency.appendChild(opt);
    });
    currentCurrency.value = 'GBP';
}

// Populate neighborhood dropdown
function populateNeighborhoods(city, selectEl, groupEl) {
    selectEl.innerHTML = '<option value="">City average (no adjustment)</option>';
    const neighborhoods = cityNeighborhoods[city];
    if (neighborhoods) {
        const sorted = Object.entries(neighborhoods).sort((a, b) => b[1] - a[1]);
        sorted.forEach(([name, multiplier]) => {
            const opt = document.createElement('option');
            opt.value = name;
            const pct = ((multiplier - 1) * 100);
            const sign = pct >= 0 ? '+' : '';
            opt.textContent = `${name} (${sign}${pct.toFixed(0)}% vs avg)`;
            selectEl.appendChild(opt);
        });
        groupEl.style.display = 'block';
    } else {
        groupEl.style.display = 'none';
    }
}

// Auto-suggest currency on city change
currentCity.addEventListener('change', () => {
    const city = currentCity.value;
    const currency = cityToCurrency[city];
    if (currency) {
        currentCurrency.value = currency;
        currentHint.textContent = `Currency set to ${currency}`;
    } else {
        currentHint.textContent = '';
    }
    populateNeighborhoods(city, currentNeighborhood, document.getElementById('currentNeighborhoodGroup'));
    targetHint.textContent = '';
});

targetCity.addEventListener('change', () => {
    const city = targetCity.value;
    const currency = cityToCurrency[city];
    if (currency) {
        targetHint.textContent = `Will show result in ${currency}`;
    } else {
        targetHint.textContent = '';
    }
    populateNeighborhoods(city, targetNeighborhood, document.getElementById('targetNeighborhoodGroup'));
});

// Salary formatting
salaryInput.addEventListener('input', () => {
    let val = salaryInput.value.replace(/[^0-9]/g, '');
    if (val) {
        salaryInput.value = parseInt(val).toLocaleString('en-US');
    }
});

// Error display with scroll-to and field highlight
function showError(msg, field) {
    errorMsg.textContent = msg;
    errorMsg.style.display = 'block';
    resultBox.style.display = 'none';
    if (field) {
        field.scrollIntoView({ behavior: 'smooth', block: 'center' });
        field.style.borderColor = '#dc2626';
        field.style.boxShadow = '0 0 0 3px rgba(220, 38, 38, 0.15)';
        field.focus();
        setTimeout(() => {
            field.style.borderColor = '';
            field.style.boxShadow = '';
        }, 3000);
    }
    setTimeout(() => errorMsg.style.display = 'none', 4000);
}

// === CALCULATE ===
calcBtn.addEventListener('click', calculate);
salaryInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') calculate(); });

function calculate() {
    errorMsg.style.display = 'none';

    const salary = parseFloat(salaryInput.value.replace(/,/g, ''));
    const fromCity = currentCity.value;
    const toCity = targetCity.value;
    const fromCurrency = currentCurrency.value;

    if (!salary || salary <= 0) return showError('Please enter your salary', salaryInput);
    if (!fromCity) return showError('Please select your current city', currentCity);
    if (!toCity) return showError('Please select a city to compare', targetCity);
    if (fromCity === toCity && currentNeighborhood.value === targetNeighborhood.value) return showError('Please select two different locations', targetCity);

    let fromCOLI = coliData[fromCity];
    let toCOLI = coliData[toCity];

    // Apply neighborhood multipliers
    const fromNhood = currentNeighborhood.value;
    const toNhood = targetNeighborhood.value;
    if (fromNhood && cityNeighborhoods[fromCity] && cityNeighborhoods[fromCity][fromNhood]) {
        fromCOLI *= cityNeighborhoods[fromCity][fromNhood];
    }
    if (toNhood && cityNeighborhoods[toCity] && cityNeighborhoods[toCity][toNhood]) {
        toCOLI *= cityNeighborhoods[toCity][toNhood];
    }

    const toCurrency = cityToCurrency[toCity] || fromCurrency;

    // Exchange rate: from → GBP → to
    const fromRate = exchangeRates[fromCurrency];
    const toRate = exchangeRates[toCurrency];
    const xRate = toRate / fromRate;

    // Equivalent salary
    const equivalent = salary * (toCOLI / fromCOLI) * xRate;

    // Buying power
    const converted = salary * xRate;
    const buyingPower = ((converted / equivalent) * 100).toFixed(0);

    // Format result
    const formatter = new Intl.NumberFormat('en-US', {
        minimumFractionDigits: 0,
        maximumFractionDigits: 0
    });

    resultAmount.textContent = `${toCurrency} ${formatter.format(Math.round(equivalent))}`;

    // Breakdown
    document.getElementById('statRate').textContent = `1 ${fromCurrency} = ${xRate < 10 ? xRate.toFixed(3) : xRate.toFixed(1)} ${toCurrency}`;
    const colRatio = ((toCOLI / fromCOLI) * 100).toFixed(0);
    document.getElementById('statCOL').textContent = colRatio >= 100 ? `+${colRatio - 100}% higher` : `${100 - colRatio}% lower`;
    document.getElementById('statPower').textContent = `${buyingPower}%`;

    // Note
    const fromLabel = fromNhood ? `${fromNhood}, ${fromCity}` : fromCity;
    const toLabel = toNhood ? `${toNhood}, ${toCity}` : toCity;
    const note = toCOLI > fromCOLI
        ? `${toLabel} costs <strong>${Math.abs(colRatio - 100)}% more</strong> to live in than ${fromLabel}`
        : `${toLabel} costs <strong>${Math.abs(colRatio - 100)}% less</strong> to live in than ${fromLabel}`;
    document.getElementById('resultNote').innerHTML = note;

    // Currency formatter helper
    const fmtCur = (amount, cur) => new Intl.NumberFormat('en-US', {
        style: 'currency', currency: cur,
        minimumFractionDigits: 0, maximumFractionDigits: 0
    }).format(amount);

    const fmtSalaryFrom = fmtCur(salary, fromCurrency);
    const fmtSalaryTo = fmtCur(Math.round(equivalent), toCurrency);

    // === TAX ESTIMATION (Progressive Brackets) ===
    const fromCountry = cityToCountry[fromCity];
    const toCountry = cityToCountry[toCity];
    const fromTaxResult = calculateTax(salary, fromCountry);
    const toTaxResult = calculateTax(equivalent, toCountry);
    const taxSection = document.getElementById('taxSection');

    if (fromCountry && toCountry) {
        const fmtNetFrom = fmtCur(fromTaxResult.net, fromCurrency);
        const fmtNetTo = fmtCur(toTaxResult.net, toCurrency);

        document.getElementById('taxGrid').innerHTML = `
            <div class="tax-card">
                <div class="tax-card-city">${fromLabel}</div>
                <div class="tax-card-gross">Gross: ${fmtSalaryFrom}</div>
                <div class="tax-card-rate">Tax: ~${fromTaxResult.effectiveRate}% effective${fromTaxResult.effectiveRate === 0 ? ' (Tax-Free)' : ''}</div>
                <div class="tax-card-net">${fmtNetFrom}</div>
                <div class="tax-card-label">Est. Take-Home</div>
            </div>
            <div class="tax-card">
                <div class="tax-card-city">${toLabel}</div>
                <div class="tax-card-gross">Gross: ${fmtSalaryTo}</div>
                <div class="tax-card-rate">Tax: ~${toTaxResult.effectiveRate}% effective${toTaxResult.effectiveRate === 0 ? ' (Tax-Free)' : ''}</div>
                <div class="tax-card-net">${fmtNetTo}</div>
                <div class="tax-card-label">Est. Take-Home</div>
            </div>
        `;
        taxSection.style.display = 'block';
    } else {
        taxSection.style.display = 'none';
    }

    // === VISUAL CHART ===
    const chartSection = document.getElementById('chartSection');
    const maxSal = Math.max(salary, equivalent);
    const fromPct = (salary / maxSal) * 100;
    const toPct = (equivalent / maxSal) * 100;

    let chartHTML = `
        <div class="chart-bar-row">
            <div class="chart-bar-label">${fromCity}</div>
            <div class="chart-bar-track">
                <div class="chart-bar-fill current" style="width: ${fromPct}%">${fmtSalaryFrom}</div>
            </div>
        </div>
        <div class="chart-bar-row">
            <div class="chart-bar-label">${toCity}</div>
            <div class="chart-bar-track">
                <div class="chart-bar-fill target" style="width: ${toPct}%">${fmtSalaryTo}</div>
            </div>
        </div>
    `;

    if (fromCountry && toCountry) {
        const netFromVal = fromTaxResult.net;
        const netToVal = toTaxResult.net;
        const maxNet = Math.max(netFromVal, netToVal);
        const netFromPct = (netFromVal / maxNet) * 100;
        const netToPct = (netToVal / maxNet) * 100;
        chartHTML += `
            <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #e8e8ed;">
                <div style="font-size: 0.6rem; color: #86868b; margin-bottom: 6px; font-weight: 500;">AFTER TAX (ESTIMATED)</div>
            </div>
            <div class="chart-bar-row">
                <div class="chart-bar-label">${fromCity}</div>
                <div class="chart-bar-track">
                    <div class="chart-bar-fill tax-current" style="width: ${netFromPct}%">${fmtCur(netFromVal, fromCurrency)}</div>
                </div>
            </div>
            <div class="chart-bar-row">
                <div class="chart-bar-label">${toCity}</div>
                <div class="chart-bar-track">
                    <div class="chart-bar-fill tax-target" style="width: ${netToPct}%">${fmtCur(netToVal, toCurrency)}</div>
                </div>
            </div>
        `;
    }

    document.getElementById('chartBars').innerHTML = chartHTML;
    chartSection.style.display = 'block';

    // === HOW WE CALCULATED THIS ===
    const baseCOLIFrom = coliData[fromCity];
    const baseCOLITo = coliData[toCity];
    const fmtConverted = fmtCur(salary * xRate, toCurrency);
    const colRatioVal = toCOLI / fromCOLI;

    let stepNum = 1;
    let stepsHTML = '';

    // Step 1: Your salary
    stepsHTML += `<div class="explanation-step"><div class="step-num">${stepNum++}</div><div class="step-text"><strong>Your salary:</strong> ${fmtSalaryFrom} in ${fromLabel} (${fromCurrency})</div></div>`;

    // Step 2: Currency conversion
    stepsHTML += `<div class="explanation-step"><div class="step-num">${stepNum++}</div><div class="step-text"><strong>Currency conversion:</strong> ${fmtSalaryFrom} → ${fmtConverted} at a rate of 1 ${fromCurrency} = ${xRate.toFixed(4)} ${toCurrency}</div></div>`;

    // Step 3: City cost of living
    const colRatioText = (!fromNhood && !toNhood) ? ` The ratio is <strong>${colRatioVal.toFixed(2)}x</strong>.` : '';
    stepsHTML += `<div class="explanation-step"><div class="step-num">${stepNum++}</div><div class="step-text"><strong>City cost of living:</strong> ${fromCity} has a base cost index of <strong>${baseCOLIFrom}</strong> and ${toCity} has <strong>${baseCOLITo}</strong> (New York = 100 baseline).${colRatioText}</div></div>`;

    // Step 4: Neighborhood adjustments (if applicable)
    if (fromNhood || toNhood) {
        let nhoodText = '<strong>Neighborhood adjustment:</strong> ';
        const parts = [];
        if (fromNhood && cityNeighborhoods[fromCity] && cityNeighborhoods[fromCity][fromNhood]) {
            const m = cityNeighborhoods[fromCity][fromNhood];
            const pct = ((m - 1) * 100).toFixed(0);
            const sign = pct >= 0 ? '+' : '';
            parts.push(`${fromNhood} in ${fromCity} is ${sign}${pct}% vs the city average (adjusted COLI: ${(baseCOLIFrom * m).toFixed(1)})`);
        }
        if (toNhood && cityNeighborhoods[toCity] && cityNeighborhoods[toCity][toNhood]) {
            const m = cityNeighborhoods[toCity][toNhood];
            const pct = ((m - 1) * 100).toFixed(0);
            const sign = pct >= 0 ? '+' : '';
            parts.push(`${toNhood} in ${toCity} is ${sign}${pct}% vs the city average (adjusted COLI: ${(baseCOLITo * m).toFixed(1)})`);
        }
        nhoodText += parts.join('. ') + '.';
        stepsHTML += `<div class="explanation-step"><div class="step-num">${stepNum++}</div><div class="step-text">${nhoodText}</div></div>`;
    }

    // Step N: Final formula
    let formulaText = `${fmtSalaryFrom} × ${colRatioVal.toFixed(2)} (cost of living`;
    if (fromNhood || toNhood) formulaText += ', incl. neighborhood';
    formulaText += `) × ${xRate.toFixed(2)} (exchange rate) = <strong>${fmtSalaryTo}</strong>`;
    stepsHTML += `<div class="explanation-step"><div class="step-num">${stepNum++}</div><div class="step-text"><strong>Final formula:</strong> ${formulaText}</div></div>`;

    // Step N+1: What this means
    stepsHTML += `<div class="explanation-step"><div class="step-num">${stepNum++}</div><div class="step-text"><strong>What this means:</strong> To maintain the same purchasing power you have with ${fmtSalaryFrom} in ${fromLabel}, you would need ${fmtSalaryTo} in ${toLabel}.</div></div>`;

    document.getElementById('explanationSteps').innerHTML = stepsHTML;
    document.getElementById('explanationSection').style.display = 'block';

    resultBox.style.display = 'block';
    resultBox.style.animation = 'none';
    resultBox.offsetHeight;
    resultBox.style.animation = 'slideIn 0.4s ease-out';
}

init();
</script>

</body>
</html>
